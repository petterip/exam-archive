<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>exam_archive API documentation</title>
    <meta name="description" content="" />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">
    <li class="set"><h3><a href="#header-variables">Module variables</a></h3>
      
  <ul>
    <li class="mono"><a href="#exam_archive.DEFAULT_DATA_DUMP">DEFAULT_DATA_DUMP</a></li>
    <li class="mono"><a href="#exam_archive.DEFAULT_DB_PATH">DEFAULT_DB_PATH</a></li>
    <li class="mono"><a href="#exam_archive.DEFAULT_SCHEMA">DEFAULT_SCHEMA</a></li>
  </ul>

    </li>


    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#exam_archive.ExamArchiveDatabase">ExamArchiveDatabase</a></span>
        
          
  <ul>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.__init__">__init__</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.authorize_user">authorize_user</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.browse_archives">browse_archives</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.browse_courses">browse_courses</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.browse_exams">browse_exams</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.browse_teachers">browse_teachers</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.browse_users">browse_users</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.clean">clean</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.create_archive">create_archive</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.create_course">create_course</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.create_exam">create_exam</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.create_tables_from_schema">create_tables_from_schema</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.create_teacher">create_teacher</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.create_user">create_user</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.edit_archive">edit_archive</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.edit_course">edit_course</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.edit_exam">edit_exam</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.edit_exam_file">edit_exam_file</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.edit_teacher">edit_teacher</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.edit_user">edit_user</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.get_archive">get_archive</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.get_archive_by_name">get_archive_by_name</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.get_course">get_course</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.get_course_by_name">get_course_by_name</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.get_exam">get_exam</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.get_teacher">get_teacher</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.get_teacher_by_name">get_teacher_by_name</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.get_user">get_user</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.get_user_by_name">get_user_by_name</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.load_init_values">load_init_values</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.load_table_values_from_dump">load_table_values_from_dump</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.remove_archive">remove_archive</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.remove_course">remove_course</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.remove_exam">remove_exam</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.remove_teacher">remove_teacher</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.remove_user">remove_user</a></li>
    <li class="mono"><a href="#exam_archive.ExamArchiveDatabase.user_has_access">user_has_access</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#exam_archive.ExamDatabaseError">ExamDatabaseError</a></span>
        
        </li>
        <li class="mono">
        <span class="class_name"><a href="#exam_archive.ExamDatabaseErrorExists">ExamDatabaseErrorExists</a></span>
        
        </li>
        <li class="mono">
        <span class="class_name"><a href="#exam_archive.ExamDatabaseErrorNotFound">ExamDatabaseErrorNotFound</a></span>
        
        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">exam_archive</span> module</h1>
  
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive" class="source">
    <div class="codehilite"><pre><span class="c"># coding=UTF-8</span>
<span class="c">#</span>
<span class="c"># Provides the database API to access and modify persistent data</span>
<span class="c"># in the Exam Archive.</span>
<span class="c">#</span>
<span class="c"># @authors: Ari Kairala, Petteri Ponsimaa</span>
<span class="c"># The class is based on code made by Ivan Sanchez (from exercise 2 code of database.py).</span>

<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">from</span> <span class="nn">sqlite3</span> <span class="kn">import</span> <span class="n">IntegrityError</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">arrow</span>

<span class="c"># Default paths for .db and .sql files to create and populate the database.</span>
<span class="n">DEFAULT_DB_PATH</span> <span class="o">=</span> <span class="s">&#39;db/exam_archive.db&#39;</span>
<span class="sd">&#39;&#39;&#39; Default path for exam archive SQLite database. &#39;&#39;&#39;</span>
<span class="n">DEFAULT_SCHEMA</span> <span class="o">=</span> <span class="s">&quot;db/exam_archive_schema_dump.sql&quot;</span>
<span class="sd">&#39;&#39;&#39; SQL create clauses for creating the database. &#39;&#39;&#39;</span>
<span class="n">DEFAULT_DATA_DUMP</span> <span class="o">=</span> <span class="s">&quot;db/exam_archive_data_dump.sql&quot;</span>
<span class="sd">&#39;&#39;&#39; SQL create and insert clauses for testing. &#39;&#39;&#39;</span>

<span class="k">class</span> <span class="nc">ExamArchiveDatabase</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    API to access the exam archive database.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        db_path is the address of the path with respect to the calling script.</span>
<span class="sd">        If db_path is None, DEFAULT_DB_PATH is used instead.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ExamArchiveDatabase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">db_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db_path</span> <span class="o">=</span> <span class="n">db_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db_path</span> <span class="o">=</span> <span class="n">DEFAULT_DB_PATH</span>

    <span class="c"># Setting up the database. Used for the tests. Setup, populate and delete the database</span>
    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Purge the database removing old values.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_init_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Populate the database with initial values. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_tables_from_schema</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_table_values_from_dump</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">create_tables_from_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create programmatically the tables from a schema file.</span>
<span class="sd">        schema contains the path to the .sql schema file. If it is None,  </span>
<span class="sd">        DEFAULT_SCHEMA is used instead. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">schema</span> <span class="o">=</span> <span class="n">DEFAULT_SCHEMA</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_table_values_from_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dump</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Populate programmatically the tables from a dump file.</span>
<span class="sd">        dump is the path to the .sql dump file. If it is None,  </span>
<span class="sd">        DEFAULT_DATA_DUMP is used instead.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dump</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">dump</span> <span class="o">=</span> <span class="n">DEFAULT_DATA_DUMP</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dump</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>

    <span class="c"># Helper functions for public database API functions.</span>

    <span class="k">def</span> <span class="nf">_create_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a dictionary object from a table row.</span>

<span class="sd">        Source: A simple REST server for Sailors,</span>
<span class="sd">        http://www.cs.unc.edu/Courses/comp521-f13/media/L9-InternetApplications2.html</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">row</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_scrub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; </span>
<span class="sd">        Sanitize a table name that can not be replaced with sqlite3&#39;s substitaion.</span>
<span class="sd">        E.g. _scrub(&#39;); drop tables --&#39;) returns &#39;droptables&#39;</span>
<span class="sd">        </span>
<span class="sd">        Code snippet by Donald Miner, source: http://stackoverflow.com/questions/3247183/variable-table-name-in-sqlite</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span> <span class="k">for</span> <span class="nb">chr</span> <span class="ow">in</span> <span class="n">table_name</span> <span class="k">if</span> <span class="nb">chr</span><span class="o">.</span><span class="n">isalnum</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_valid_foreign_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_connection</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check if a foreign key is valid and can be found from referencing table.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="c"># Sanitize the table name before using it</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scrub</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>

        <span class="c"># SQL Statement for checking that the user does not yet exist</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from </span><span class="si">%s</span><span class="s"> WHERE </span><span class="si">%s</span><span class="s">_id = ?&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,)</span>
        <span class="n">db_connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">db_connection</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="c"># Database API - functions to handle database</span>

    <span class="k">def</span> <span class="nf">create_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_name</span><span class="p">,</span> <span class="n">organisation_name</span><span class="p">,</span> <span class="n">identification_needed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create new exam archive to database. An archive is specific to certain </span>
<span class="sd">        faculty or department, for example &quot;Blanko&quot; for Information Processing</span>
<span class="sd">        Science faculty of Oulu University.</span>
<span class="sd">        </span>
<span class="sd">        INPUT:</span>

<span class="sd">        * `archive_name`: The name of the archive to be created.</span>
<span class="sd">        * `organisation_name`: The name of the organisation, such as faculty, department or school, owning the archive.</span>
<span class="sd">        * `identification_needed`:  Whether authorization is required from basic users to view exams.</span>
<span class="sd">        * `modifier_id`: The creator or last modifier of the archive or None if not specified.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * ID of the new archive, if the archive was created successfully, None otherwise.</span>

<span class="sd">        Raises exception ExamDatabaseErrorExists, if the an archive already exists with the given name.</span>
<span class="sd">        Raises exception ExamDatabaseErrorNotFound, if given modifier was not found.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the archive does not yet exist</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from archive WHERE archive_name = ? AND organisation_name = ?&#39;</span>

        <span class="c"># SQL Statement to create the row in archive table</span>
        <span class="n">sql_insert</span> <span class="o">=</span> <span class="s">&#39;INSERT INTO archive (archive_name, organisation_name, identification_needed, modifier_id, last_modified) </span><span class="se">\</span>
<span class="s">        VALUES (?,?,?,?,?)&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Check that the modifier_id is present in user table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Execute the statement to find out the archive does not yet exist</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_name</span><span class="p">,</span> <span class="n">organisation_name</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span>
                    <span class="s">&quot;Archive already has an entry with the same organisation and archive name&quot;</span><span class="p">)</span>

            <span class="c"># Add the row to archive table by executing the statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_name</span><span class="p">,</span> <span class="n">organisation_name</span><span class="p">,</span> <span class="n">identification_needed</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_insert</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">lid</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span>

            <span class="c"># Return the last row&#39;s ID</span>
            <span class="k">return</span> <span class="n">lid</span>


    <span class="k">def</span> <span class="nf">create_course</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">,</span> <span class="n">course_code</span><span class="p">,</span> <span class="n">course_name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">credit_points</span><span class="p">,</span>
                      <span class="n">language_id</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create an course to the archive. Archive can include multiple courses under same name and other information,</span>
<span class="sd">        but there can&#39;t be be two courses with same name and language.</span>

<span class="sd">        INPUT:</span>
<span class="sd">        </span>
<span class="sd">        * `archive_id`: ID of the archive where the course belongs to.</span>
<span class="sd">        * `course_code`: Code of the course, which is used to identify course for in curriculum.</span>
<span class="sd">        * `course_name`: Textual name of the course to be created.</span>
<span class="sd">        * `description`: Description of the course.</span>
<span class="sd">        * `teacher_id`: ID of the teacher, lecturer or other responsible person of the course.</span>
<span class="sd">        * `url`: Course home page URL.</span>
<span class="sd">        * `credit_points`: Amount of credit points, that can be earned from the course.</span>
<span class="sd">        * `language_id`: Language identifier of the language used in the course.</span>
<span class="sd">        * `modifier_id`: The creator or last modifier of the course or None if not specified.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * ID of the new course entity, if the course was created successfully, None otherwise.</span>

<span class="sd">        Raises exception ExamDatabaseErrorExists, if course with given course_name and language_id combination already exists.</span>
<span class="sd">        Raises ExamDatabaseErrorNotFound if given archive, teacher, language or modifier were not found in the database.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the course does not yet exist</span>
        <span class="n">sql_course_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from course WHERE course_name = ? AND language_id = ?&#39;</span>

        <span class="c"># SQL Statement to create the row in archive table</span>
        <span class="n">sql_insert</span> <span class="o">=</span> <span class="s">&#39;INSERT INTO course (archive_id, course_code, course_name, description, teacher_id, url, &#39;</span> \
                     <span class="s">&#39;credit_points, language_id, modifier_id, last_modified) &#39;</span> \
                     <span class="s">&#39;VALUES (?,?,?,?,?,?,?,?,?,?)&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Check that the given user_id exists in the user table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Check that the given teacher_id exists in the teacher table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;teacher&quot;</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Teacher does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Check that the given archive_id exists in the archive table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;archive&quot;</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Archive does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Check that the given language_id exists in the language table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;language&quot;</span><span class="p">,</span> <span class="n">language_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Language does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Execute the statement to find out the archive does not yet exist</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_name</span><span class="p">,</span> <span class="n">language_id</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_course_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span><span class="s">&quot;Course already exists with the same name and language&quot;</span><span class="p">)</span>

            <span class="c"># Add the row to archive table by executing the statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">archive_id</span><span class="p">,</span> <span class="n">course_code</span><span class="p">,</span> <span class="n">course_name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">credit_points</span><span class="p">,</span> <span class="n">language_id</span><span class="p">,</span>
                <span class="n">modifier_id</span><span class="p">,</span>
                <span class="n">last_modified</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_insert</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">lid</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span>
            <span class="c"># Return the last row&#39;s ID</span>
            <span class="k">return</span> <span class="n">lid</span>


    <span class="k">def</span> <span class="nf">create_exam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">course_id</span><span class="p">,</span> <span class="n">examiner_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">file_attachment</span><span class="p">,</span> <span class="n">language_id</span><span class="o">=</span><span class="s">&#39;fi&#39;</span><span class="p">,</span>
                    <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create an exam and attach it to the given course. A course can be specified by giving either course name or</span>
<span class="sd">        course code.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `course_id`: The idenfier of the course, where the exam belongs to</span>
<span class="sd">        * `examiner_id`: ID of the teacher, lecturer or other person responsible of overseeing the exam.</span>
<span class="sd">        * `date`: Date of the exam given in format of YYYY-MM-DD.</span>
<span class="sd">        * `file_attachment`: Identifier for the file attachment.</span>
<span class="sd">        * `language_id`: Language identifier for the exam.</span>
<span class="sd">        * `modifier_id`: The creator or last modifier of the exam or None if not specified.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * ID of the new exam entity, if the exam was created successfully, None otherwise.</span>

<span class="sd">        Raises exception ExamDatabaseErrorExists, if the an exam already exists with the given date and course,</span>
<span class="sd">        Raises exception ExamDatabaseErrorNotFound if course, examiner, language or modifier does not exist.</span>
<span class="sd">        Raises exception ValueError if the date is not given in format of YYYY-MM-DD.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Check that the given date string is in valid date format</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="s">&#39;YYYY-MM-DD&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;YYYY-MM-DD&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Date must be in format &quot;YYYY-MM-DD&quot;&#39;</span><span class="p">)</span>

        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the exam does not yet exist</span>
        <span class="n">sql_course_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from exam WHERE course_id = ? AND date = ?&#39;</span>

        <span class="c"># SQL Statement to create the row in archive table</span>
        <span class="n">sql_insert</span> <span class="o">=</span> <span class="s">&#39;INSERT INTO exam (course_id, examiner_id, date, file_attachment, language_id, &#39;</span> \
                     <span class="s">&#39;modifier_id, last_modified)&#39;</span> \
                     <span class="s">&#39;VALUES (?,?,?,?,?,?,?)&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Check that the given course_id exists in the course table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;course&quot;</span><span class="p">,</span> <span class="n">course_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Course does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Check that the given user_id exists in the user table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Check that the given examiner_id exists in the teacher table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;teacher&quot;</span><span class="p">,</span> <span class="n">examiner_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Examiner does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Check that the given language_id exists in the language table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;language&quot;</span><span class="p">,</span> <span class="n">language_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Language does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Execute the statement to find out the archive does not yet exist</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_id</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_course_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span><span class="s">&quot;Exam already exists within the same course and date&quot;</span><span class="p">)</span>

            <span class="c"># Add the row to archive table by executing the statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_id</span><span class="p">,</span> <span class="n">examiner_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">file_attachment</span><span class="p">,</span> <span class="n">language_id</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_insert</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">lid</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span>

            <span class="c"># Return the last row&#39;s ID</span>
            <span class="k">return</span> <span class="n">lid</span>


    <span class="k">def</span> <span class="nf">edit_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">,</span> <span class="n">archive_name</span><span class="p">,</span> <span class="n">organisation_name</span><span class="p">,</span> <span class="n">identification_needed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update an archive in the database. An archive can be specified by giving archive id.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `archive_id`: ID of the archive to be updated</span>
<span class="sd">        * `archive_name`: The name of the archive to be edited.</span>
<span class="sd">        * `organisation_name`: The name of the organisation, such as faculty, department or school, owning the archive.</span>
<span class="sd">        * `identification_needed`:  Whether authorization is required from basic users to view archive.</span>
<span class="sd">        * `modifier_id`: The creator or last modifier of the archive or None if not specified.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * ID of the archive, if the archive was edited successfully and None if the archive did not exist or there was</span>
<span class="sd">        an error updating the database.</span>

<span class="sd">        Raises exception ExamDatabaseErrorExists, if the an archive already exists with the given name.</span>
<span class="sd">        Raises exception ExamDatabaseErrorNotFound, if given modifier does not exist.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Create the SQL Statements</span>
        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the archive does exist</span>
        <span class="n">sql_query1</span> <span class="o">=</span> <span class="s">&quot;SELECT archive_id FROM archive WHERE archive_id = ?&quot;</span>

        <span class="c"># SQL Statement for checking that another archive does not yet exist with the same name and organisation</span>
        <span class="n">sql_query2</span> <span class="o">=</span> <span class="s">&#39;SELECT * from archive WHERE archive_id &lt;&gt; ? AND archive_name = ? AND organisation_name = ?&#39;</span>

        <span class="n">sql_update</span> <span class="o">=</span> <span class="s">&#39;UPDATE archive SET archive_name = ?, organisation_name = ?, identification_needed = ?, &#39;</span> \
                     <span class="s">&#39;modifier_id = ?, last_modified = ? &#39;</span> \
                     <span class="s">&#39;WHERE archive_id = ?&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute a query statement to find out whether the archive exists in the database</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_id</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query1</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c"># Only one value expected</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="c"># If the archive does not exist, return None</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Execute a query statement to check that another archive does not yet exist with the same name and organisation</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_id</span><span class="p">,</span> <span class="n">archive_name</span><span class="p">,</span> <span class="n">organisation_name</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query2</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
                <span class="c"># Only one value expected</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

                <span class="c"># If the archive exists, raise an exception</span>
                <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span>
                        <span class="s">&quot;Another archive already exists with the same archive and organisation name&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Check that the given modifier_id exists in the user table</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

                    <span class="c"># Execute the main update statement</span>
                    <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_name</span><span class="p">,</span> <span class="n">organisation_name</span><span class="p">,</span> <span class="n">identification_needed</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">,</span>
                              <span class="n">archive_id</span><span class="p">)</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_update</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>

                    <span class="c"># Check to see that the database was successfully modified</span>
                    <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">None</span>
                    <span class="c"># Return message id with &#39;msg-&#39; in the beginning</span>
                    <span class="k">return</span> <span class="n">archive_id</span>


    <span class="k">def</span> <span class="nf">edit_course</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">course_id</span><span class="p">,</span> <span class="n">course_code</span><span class="p">,</span> <span class="n">course_name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">credit_points</span><span class="p">,</span> <span class="n">language_id</span><span class="p">,</span>
                    <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update an course in the archive identified by a course ID. Archive can include multiple courses under same name </span>
<span class="sd">        and other information, but there cannot be be two courses with same name and language.</span>
<span class="sd">        </span>
<span class="sd">        INPUT:</span>

<span class="sd">        * `course_id`: ID of the course to be updated</span>
<span class="sd">        * `course_code`: Code of the course, what is used to identify course for in curriculum.</span>
<span class="sd">        * `course_name`: Textual name of the course to be created.</span>
<span class="sd">        * `description`: Description of the course.</span>
<span class="sd">        * `teacher_id`: Name of the teacher, lecturer or other responsible person of the course.</span>
<span class="sd">        * `url`: Course home page URL.</span>
<span class="sd">        * `credit_points`: Amount of credit points, that can be earned from the course.</span>
<span class="sd">        * `language_id`: Language identifier of the language used in the course.</span>
<span class="sd">        * `modifier_id`: The creator or last modifier of the course or None if not specified.</span>
<span class="sd">        </span>
<span class="sd">        OUTPUT:</span>

<span class="sd">        * ID of the course, if the course was updated successfully and None if the course did not exist or there was</span>
<span class="sd">        an error updating the database.</span>
<span class="sd">        </span>
<span class="sd">        Raises exception ExamDatabaseErrorExists, if course with given course_name and language_id combination already </span>
<span class="sd">        exists. Raises ExamDatabaseErrorNotFound, if given teacher, language or modifier does not exist.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Create the SQL Statements</span>
        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the course does exist and also for fetching the archive_id</span>
        <span class="n">sql_query1</span> <span class="o">=</span> <span class="s">&quot;SELECT archive_id FROM course WHERE course_id = ?&quot;</span>

        <span class="c"># SQL Statement for checking that another course does not yet exist with the same name and language,</span>
        <span class="c"># within the same archive.</span>
        <span class="n">sql_query2</span> <span class="o">=</span> <span class="s">&#39;SELECT * from course WHERE course_id &lt;&gt; ? AND archive_id = ? AND course_name = ? AND &#39;</span> \
                     <span class="s">&#39;language_id = ?&#39;</span>

        <span class="n">sql_update</span> <span class="o">=</span> <span class="s">&#39;UPDATE course SET course_code = ?, course_name = ?, description = ?, &#39;</span> \
                     <span class="s">&#39;teacher_id = ?, url = ?, credit_points = ?, language_id = ?, modifier_id = ?, &#39;</span> \
                     <span class="s">&#39;last_modified = ? WHERE course_id = ?&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute a query statement to find out whether the course exists in the database</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_id</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query1</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c"># Only one value expected</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="c"># If the course does not exist, return None</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Get the course&#39;s archive id from the previous query response</span>
                <span class="n">archive_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;archive_id&#39;</span><span class="p">]</span>
                <span class="c"># Execute a query statement to check that another course does not yet exist with the same name and language</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_id</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">,</span> <span class="n">course_name</span><span class="p">,</span> <span class="n">language_id</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query2</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
                <span class="c"># Only one value expected</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

                <span class="c"># If the archive exists, raise an exception</span>
                <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span>
                        <span class="s">&quot;Another course already exists with the same name and language combination&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Check that the given examiner_id exists in the teacher table</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;teacher&quot;</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Teacher does not exist&quot;</span><span class="p">)</span>

                    <span class="c"># Check that the given modifier_id exists in the user table</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;language&quot;</span><span class="p">,</span> <span class="n">language_id</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Language does not exist&quot;</span><span class="p">)</span>

                    <span class="c"># Check that the given modifier_id exists in the user table</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

                    <span class="c"># Execute the main update statement</span>
                    <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_code</span><span class="p">,</span> <span class="n">course_name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">credit_points</span><span class="p">,</span>
                              <span class="n">language_id</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">,</span> <span class="n">course_id</span><span class="p">)</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_update</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>

                    <span class="c"># Check to see that the database was successfully modified</span>
                    <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">None</span>

                    <span class="c"># Everything succeeded * return the course id</span>
                    <span class="k">return</span> <span class="n">course_id</span>


    <span class="k">def</span> <span class="nf">edit_exam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exam_id</span><span class="p">,</span> <span class="n">course_id</span><span class="p">,</span> <span class="n">examiner_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">file_attachment</span><span class="p">,</span> <span class="n">language_id</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update an exam in the archive.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `exam_id`: The ID of the exam to be updated</span>
<span class="sd">        * `course_id`: The ID of the course where the exam belongs to</span>
<span class="sd">        * `examiner_id`: ID of the teacher, lecturer or other person responsible of overseeing the exam.</span>
<span class="sd">        * `date`: Date of the exam given in format of YYYY-MM-DD.</span>
<span class="sd">        * `file_attachment`: Identifier for the file attachment.</span>
<span class="sd">        * `language_id`: Language identifier for the exam.</span>
<span class="sd">        * `modifier_id`: The creator or last modifier of the exam or None if not specified.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * True, if the exam was created successfully, False otherwise.</span>

<span class="sd">        Raises exception ExamDatabaseErrorExists, if the an exam already exists with the given course, date and language.</span>
<span class="sd">        Raises exception ValueError if the date was not given in format YYYY-MM-DD. Raises ExamDatabaseErrorNotFound if</span>
<span class="sd">        course, modifier, language or examiner do not exist.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Check that the given date string is in valid date format</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="s">&#39;YYYY-MM-DD&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;YYYY-MM-DD&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Date must be in format &quot;YYYY-MM-DD&quot;&#39;</span><span class="p">)</span>

        <span class="c"># Create the SQL Statements</span>
        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the exam does exist</span>
        <span class="n">sql_query1</span> <span class="o">=</span> <span class="s">&quot;SELECT exam_id FROM exam WHERE exam_id = ?&quot;</span>

        <span class="c"># SQL Statement for checking that another exam does not yet exist with the same course, date and language.</span>
        <span class="n">sql_query2</span> <span class="o">=</span> <span class="s">&#39;SELECT * from exam WHERE exam_id &lt;&gt; ? AND course_id = ? AND date = ? AND language_id = ?&#39;</span>

        <span class="n">sql_update</span> <span class="o">=</span> <span class="s">&#39;UPDATE exam SET course_id = ?, examiner_id = ?, date = ?, file_attachment = ?, language_id = ?, &#39;</span> \
                     <span class="s">&#39;modifier_id = ?, last_modified = ? &#39;</span> \
                     <span class="s">&#39;WHERE exam_id = ?&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute a query statement to find out whether the exam exists in the database</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">exam_id</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query1</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c"># Only one value expected</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="c"># If the course does not exist, return None</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Execute a query statement to check that another exam does not yet exist within the same course</span>
                <span class="c"># and with the same language</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">exam_id</span><span class="p">,</span> <span class="n">course_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">language_id</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query2</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
                <span class="c"># Only one value expected</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

                <span class="c"># If the archive exists, raise an exception</span>
                <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span>
                        <span class="s">&quot;Another exam already exists with the same course, date and language&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Check that the given course_id exists in the course table</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;course&quot;</span><span class="p">,</span> <span class="n">course_id</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Course does not exist&quot;</span><span class="p">)</span>

                    <span class="c"># Check that the given examiner_id exists in the teacher table</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;teacher&quot;</span><span class="p">,</span> <span class="n">examiner_id</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Examiner does not exist&quot;</span><span class="p">)</span>

                    <span class="c"># Check that the given modifier_id exists in the user table</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;language&quot;</span><span class="p">,</span> <span class="n">language_id</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Language does not exist&quot;</span><span class="p">)</span>

                    <span class="c"># Check that the given modifier_id exists in the user table</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

                    <span class="c"># Execute the main update statement</span>
                    <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_id</span><span class="p">,</span> <span class="n">examiner_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">file_attachment</span><span class="p">,</span> <span class="n">language_id</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span>
                              <span class="n">last_modified</span><span class="p">,</span> <span class="n">exam_id</span><span class="p">)</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_update</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>

                    <span class="c"># Check to see that the database was successfully modified</span>
                    <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">None</span>

                    <span class="c"># Everything succeeded - return the exam id</span>
                    <span class="k">return</span> <span class="n">exam_id</span>


    <span class="k">def</span> <span class="nf">edit_exam_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exam_id</span><span class="p">,</span> <span class="n">file_attachment</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update an exam file attachment.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `exam_id`: The ID of the exam to be updated</span>
<span class="sd">        * `file_attachment`: Identifier for the file attachment.</span>
<span class="sd">        * `modifier_id`: The creator or last modifier of the exam or None if not specified.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * True, if the exam was updated successfully, False otherwise.</span>

<span class="sd">        Raises ExamDatabaseErrorNotFound if course, modifier, language or examiner do not exist.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Create the SQL Statements</span>
        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the exam does exist</span>
        <span class="n">sql_query1</span> <span class="o">=</span> <span class="s">&quot;SELECT exam_id FROM exam WHERE exam_id = ?&quot;</span>

        <span class="n">sql_update</span> <span class="o">=</span> <span class="s">&#39;UPDATE exam SET file_attachment = ?, &#39;</span> \
                     <span class="s">&#39;modifier_id = ?, last_modified = ? &#39;</span> \
                     <span class="s">&#39;WHERE exam_id = ?&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute a query statement to find out whether the exam exists in the database</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">exam_id</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query1</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c"># Only one value expected</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="c"># If the course does not exist, return None</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Check that the given modifier_id exists in the user table</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

                <span class="c"># Execute the main update statement</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">file_attachment</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">,</span> <span class="n">exam_id</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_update</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>

                <span class="c"># Check to see that the database was successfully modified</span>
                <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">None</span>

                <span class="c"># Everything succeeded - return the exam id</span>
                <span class="k">return</span> <span class="n">exam_id</span>


    <span class="c"># Browsing functions of database API</span>

    <span class="k">def</span> <span class="nf">_browse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">parent_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        List all rows in a table, or only the first rows specified by the parameter limit starting from offset.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `table`: table is either &#39;archive&#39;, &#39;course&#39;, &#39;exam&#39;, &#39;teacher&#39; or &#39;user&#39;</span>
<span class="sd">        * `parent_id`: if table is &#39;course&#39;, parent_id specifies the ID of an archive,</span>
<span class="sd">        if table is &#39;exam&#39;, parent_id specified the ID of an course. For archive, the paramenter has not effect</span>
<span class="sd">        * `limit`: the maximum length of the list (-1 means no limit)</span>
<span class="sd">        * `offset`: skip the amount of offset rows from the beginning, offset being the first returned row</span>
<span class="sd">        (zero means to start from the beginning)</span>
<span class="sd">        * `offset_represents_ids`: if false, the amount of rows specified by the `offset` parameter are skipped (e.g. for paging). If true, only the XXX are returned having XXX_id greater or equal than `offset`.  the table id (the primary key of the table)</span>
<span class="sd">        * `parent_id`: if</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * A list of rows, if one or more rows were found, empty list otherwise. Each row in the list is a</span>
<span class="sd">        dictionary containing the same structure as returned by _create_object.</span>

<span class="sd">        Raises exception ExamDatabaseError if there was an error accessing the database. Raises exception ValueError</span>
<span class="sd">        if table is not archive, course or exam.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Sanitize the table name and based on it, formulate the primary key attribute</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scrub</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
        <span class="n">table_id</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">_id&quot;</span> <span class="o">%</span> <span class="n">table</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">()</span>

        <span class="k">if</span> <span class="n">table</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;archive&#39;</span><span class="p">,</span> <span class="s">&#39;course&#39;</span><span class="p">,</span> <span class="s">&#39;exam&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">,</span> <span class="s">&#39;teacher&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Given table is not archive, course, exam, user nor teacher&quot;</span><span class="p">)</span>

        <span class="c"># Create the SQL Statement</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * FROM </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">table</span>
        <span class="n">sql_limit</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">sql_where</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># If parent_id is speficied, limit the id accordingly:</span>
        <span class="c"># - if table == &#39;course&#39;, add where clause &#39;WHERE archive_id = &lt;parent_id&gt;&#39;</span>
        <span class="c"># - if table == &#39;exam&#39;, add where clause &#39;WHERE course_id = &lt;parent_id&gt;&#39;</span>
        <span class="k">if</span> <span class="n">table</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;course&#39;</span><span class="p">,</span> <span class="s">&#39;exam&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">parent_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">table</span> <span class="o">==</span> <span class="s">&#39;course&#39;</span><span class="p">:</span>
                <span class="n">sql_where</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;archive_id = ?&#39;</span><span class="p">)</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">parent_id</span><span class="p">,)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># table is &#39;exam&#39;</span>
                <span class="n">sql_where</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;course_id = ?&#39;</span><span class="p">)</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">parent_id</span><span class="p">,)</span>

        <span class="c"># If limit or offset were defined and add WHERE or LIMIT clauses to the query</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">offset</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">offset_represents_ids</span><span class="p">:</span>
                <span class="n">sql_where</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> &gt;= ?&#39;</span> <span class="o">%</span> <span class="n">table_id</span><span class="p">)</span>
                <span class="n">sql_limit</span> <span class="o">=</span> <span class="s">&#39; LIMIT ?&#39;</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="n">pvalue</span> <span class="o">+</span> <span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># In SQLite, &#39;LIMIT -1 OFFSET 0&#39; is allowed so we do not need to check</span>
                <span class="c"># whether limit or offset or both of them were defined</span>
                <span class="n">sql_limit</span> <span class="o">=</span> <span class="s">&#39; LIMIT ? OFFSET ?&#39;</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="n">pvalue</span> <span class="o">+</span> <span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>

        <span class="c"># According to PEP 8, empty strings are false</span>
        <span class="k">if</span> <span class="n">sql_where</span><span class="p">:</span>
            <span class="n">sql_query</span> <span class="o">+=</span> <span class="s">&#39; WHERE &#39;</span> <span class="o">+</span> <span class="s">&#39; AND &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sql_where</span><span class="p">)</span>

        <span class="c"># For the time being, sort by primary key (more complex functionality implemented later)</span>
        <span class="n">sql_query</span> <span class="o">+=</span> <span class="s">&#39; ORDER BY </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">table_id</span>

        <span class="k">if</span> <span class="n">sql_limit</span><span class="p">:</span>
            <span class="n">sql_query</span> <span class="o">+=</span> <span class="n">sql_limit</span>

        <span class="c"># Connect to the database</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c">#Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

            <span class="c">#Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c">#Execute main SQL Statement</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>

            <span class="c">#Get results</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

            <span class="c"># Build a list of objects containing the table rows</span>
            <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_object</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">list</span>

    <span class="k">def</span> <span class="nf">browse_archives</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        List all the archives in the database, or only the first archives specified by the parameters limit and offset.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `limit`: the maximum length of the list (-1 means no limit)</span>
<span class="sd">        * `offset`: skip the amount of offset archives from the beginning, offset being the first returned archive</span>
<span class="sd">        (zero means to start from the beginning)</span>
<span class="sd">        * `offset_represents_ids`: if false, the amount of rows specified by the `offset` parameter are skipped</span>
<span class="sd">        (e.g. for paging). If true, only the archives are returned having archive_id greater or equal than `offset`.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * A list of archives, if one or more archives were found, empty list otherwise. Each archive in the list is a</span>
<span class="sd">        dictionary containing the same structure as returned by get_archive.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_browse</span><span class="p">(</span><span class="s">&quot;archive&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">browse_courses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        List all the course in an archive, or only the first courses specified by the parameters limit and offset.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `archive_id`: The ID of an archive</span>
<span class="sd">        * `limit`: the maximum length of the list (-1 means no limit)</span>
<span class="sd">        * `offset`: skip the amount of offset courses from the beginning, offset being the first returned course</span>
<span class="sd">        (zero means to start from the beginning)</span>
<span class="sd">        * `offset_represents_ids`: if false, the amount of rows specified by the `offset` parameter are skipped</span>
<span class="sd">        (e.g. for paging). If true, only the courses are returned having course_id greater or equal than `offset`.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * A list of courses, if one or more archives were found, empty list otherwise. Each course in the list is a</span>
<span class="sd">        dictionary containing the same structure as returned by get_course.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_browse</span><span class="p">(</span><span class="s">&quot;course&quot;</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">browse_exams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">course_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        List all the exams of a course, or only the first exams specified by the parameters limit and offset.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `course_id`: the ID of the course</span>
<span class="sd">        * `limit`: the maximum length of the list (-1 means no limit)</span>
<span class="sd">        * `offset`: skip the amount of offset exams from the beginning, offset being the first returned exam</span>
<span class="sd">        (zero means to start from the beginning)</span>
<span class="sd">        * `offset_represents_ids`: if false, the amount of rows specified by the `offset` parameter are skipped</span>
<span class="sd">        (e.g. for paging). If true, only the exams are returned having exam_id greater or equal than `offset`.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * A list of exams, if one or more archives were found, empty list otherwise. Each exam in the list is a</span>
<span class="sd">        dictionary containing the same structure as returned by get_exam.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_browse</span><span class="p">(</span><span class="s">&quot;exam&quot;</span><span class="p">,</span> <span class="n">course_id</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="p">)</span>

    <span class="c"># Get functions of database API</span>

    <span class="k">def</span> <span class="nf">_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">key_value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get a sigle row from a table.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `table`: table is either &#39;archive&#39;, &#39;course&#39;, &#39;exam&#39;, &#39;teacher&#39; or &#39;user&#39;</span>
<span class="sd">        * `key_value`: the row where primary key has the value of key_value</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * One rows, if it was found, None otherwise.</span>

<span class="sd">        Raises exception ExamDatabaseError if there was an error accessing the database. Raises exception ValueError</span>
<span class="sd">        if table is not archive, course or exam.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Sanitize the table name and based on it, formulate the primary key attribute</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scrub</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
        <span class="n">table_id</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">_id&quot;</span> <span class="o">%</span> <span class="n">table</span>

        <span class="k">if</span> <span class="n">table</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;archive&#39;</span><span class="p">,</span> <span class="s">&#39;course&#39;</span><span class="p">,</span> <span class="s">&#39;exam&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">,</span> <span class="s">&#39;teacher&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Given table is not archive, course, exam, user nor teacher&quot;</span><span class="p">)</span>

        <span class="c"># Create the SQL Statement</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * FROM </span><span class="si">%s</span><span class="s"> WHERE </span><span class="si">%s</span><span class="s"> = ?&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">table_id</span><span class="p">)</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">key_value</span><span class="p">,)</span>

        <span class="c"># Connect to the database</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c">#Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

            <span class="c">#Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c">#Execute main SQL Statement</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>

            <span class="c">#Get results</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

            <span class="c"># Return the first row found</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_object</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">obj</span>

            <span class="c"># Otherwise return None</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">get_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get archive details from the database. An archive can be specified by giving archive id.</span>

<span class="sd">        INPUT:</span>
<span class="sd">        </span>
<span class="sd">        * `archive_id`: ID of the archive</span>

<span class="sd">        OUTPUT is a dictionary containing the following keys:</span>

<span class="sd">        * `archive_name`: The name of the archive</span>
<span class="sd">        * `organisation_name`: The name of the organisation, such as faculty, department or school, owning the archive.</span>
<span class="sd">        * `identification_needed`:  Whether authorization is required from basic users to view exams.</span>
<span class="sd">        * `modifier_id`: The creator or last modifier of the archive or None if not specified.</span>
<span class="sd">        * `last_modified`: The date archive was last modified</span>

<span class="sd">        If archive was not found, None is returned.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="s">&quot;archive&quot;</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_archive_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Find an archive by name. An archive can be specified by giving the full name.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `archive_name`: Name of the archive.</span>

<span class="sd">        OUTPUT is a dictionary containing the following keys:</span>

<span class="sd">        * `archive_id`: The name of the archive</span>
<span class="sd">        * `archive_name`: The name of the archive</span>
<span class="sd">        * `organisation_name`: The name of the organisation, such as faculty, department or school, owning the archive.</span>
<span class="sd">        * `identification_needed`:  Whether authorization is required from basic users to view exams.</span>
<span class="sd">        * `modifier_id`: The creator or last modifier of the archive or None if not specified.</span>
<span class="sd">        * `last_modified`: The date archive was last modified</span>

<span class="sd">        If archive was not found, None is returned.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the user does not yet exist</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from archive WHERE archive_name = ?&#39;</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute the SQL query statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_name</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_object</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">get_course</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">course_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get course details from the database. A course is specified by giving course id.</span>

<span class="sd">        INPUT:</span>
<span class="sd">        </span>
<span class="sd">        * `course_id`: ID of the course</span>

<span class="sd">        OUTPUT is a dictionary containing the following keys:</span>

<span class="sd">        * `archive_id`: The ID of an archive where the course belongs to</span>
<span class="sd">        * `course_code`: Code of course, which used to to identify course in curriculum</span>
<span class="sd">        * `course_name`: Textual name of the course</span>
<span class="sd">        * `description`: Description of course</span>
<span class="sd">        * `teacher_id`: Responsible teacher of the course</span>
<span class="sd">        * `url`: URL address to the course webpage</span>
<span class="sd">        * `credit_points`: Number of total credit points earned from course</span>
<span class="sd">        * `language_id`: Identifies language used in course</span>
<span class="sd">        * `modifier_id`: Creator or last modifie</span>
<span class="sd">        * `last_modified`: Last modified date.</span>

<span class="sd">        If course was not found, None is returned.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="s">&quot;course&quot;</span><span class="p">,</span> <span class="n">course_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_course_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">course_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Find course details by course name. A course is specified by giving its full name.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `course_id`: ID of the course</span>

<span class="sd">        OUTPUT is a dictionary containing the following keys:</span>

<span class="sd">        * `course_id`: The ID of the course</span>
<span class="sd">        * `archive_id`: The ID of an archive where the course belongs to</span>
<span class="sd">        * `course_code`: Code of course, which used to to identify course in curriculum</span>
<span class="sd">        * `course_name`: Textual name of the course</span>
<span class="sd">        * `description`: Description of course</span>
<span class="sd">        * `teacher_id`: Responsible teacher of the course</span>
<span class="sd">        * `url`: URL address to the course webpage</span>
<span class="sd">        * `credit_points`: Number of total credit points earned from course</span>
<span class="sd">        * `language_id`: Identifies language used in course</span>
<span class="sd">        * `modifier_id`: Creator or last modifie</span>
<span class="sd">        * `last_modified`: Last modified date.</span>

<span class="sd">        If course was not found, None is returned.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the user does not yet exist</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from course WHERE course_name = ?&#39;</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute the SQL query statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_name</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_object</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">get_exam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exam_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get exam details from the database. An exam is specified by giving exam id.</span>

<span class="sd">        INPUT:</span>
<span class="sd">        </span>
<span class="sd">        * `exam_id`: ID of the exam</span>

<span class="sd">        OUTPUT is dictionary containing the following keys:</span>

<span class="sd">        * `course_id`: Course ID of the exam</span>
<span class="sd">        * `examiner_id`: Responsible teacher of the exam</span>
<span class="sd">        * `date`: Date of the exam</span>
<span class="sd">        * `file_attachment`: File attachment id of the PDF file</span>
<span class="sd">        * `language_id`: Language of the course</span>
<span class="sd">        * `modifier_id`: Creator or last modifier</span>
<span class="sd">        * `last_modified`: Last modified date</span>

<span class="sd">        If exam was not found, None is returned.</span>

<span class="sd">        Raises exception ExamDatabaseError if there was an error accessing the database.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="s">&quot;exam&quot;</span><span class="p">,</span> <span class="n">exam_id</span><span class="p">)</span>

    <span class="c"># Remove functions of the database API</span>

    <span class="k">def</span> <span class="nf">remove_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Remove an archive from the database. An archive can be specified by giving archive id. Note: Removing an archive deletes all the courses and all the exams attached to it!</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `archive_id`: ID of the archive to be removed</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * If the archive was successfully deleted True is returned, otherwise False.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
        <span class="n">delete_query</span> <span class="o">=</span> <span class="s">&#39;DELETE FROM archive WHERE archive_id = ?&#39;</span>

        <span class="c"># Connect to the database</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c">#Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
            <span class="c">#Execute the statement to delete</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_id</span><span class="p">,)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">delete_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c">#Check that it has been deleted</span>
            <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">True</span>


    <span class="k">def</span> <span class="nf">remove_course</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">course_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Remove a course from the database. A course is specified by giving course id. Note: Removing a course deletes all the exams attached to it!</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `course_id`: ID of the course</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * If the course successfully deleted True is returned, otherwise False.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
        <span class="n">delete_query</span> <span class="o">=</span> <span class="s">&#39;DELETE FROM course WHERE course_id = ?&#39;</span>

        <span class="c"># Connect to the database</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c">#Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
            <span class="c">#Execute the statement to delete</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_id</span><span class="p">,)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">delete_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c">#Check that it has been deleted</span>
            <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">True</span>


    <span class="k">def</span> <span class="nf">remove_exam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exam_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Remove exam details from the database. An exam is specified by giving exam id. File attachments do not get deleted automatically as they are not part of the database.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `exam_id`: ID of the exam</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * If the exam successfully deleted True is returned, otherwise False.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
        <span class="n">delete_query</span> <span class="o">=</span> <span class="s">&#39;DELETE FROM exam WHERE exam_id = ?&#39;</span>

        <span class="c"># Connect to the database</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c">#Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
            <span class="c">#Execute the statement to delete</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">exam_id</span><span class="p">,)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">delete_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c">#Check that it has been deleted</span>
            <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">True</span>

    <span class="c"># Teacher related functions of database API</span>

    <span class="k">def</span> <span class="nf">create_teacher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">office</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">street_address</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">postal_code</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">city</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">phone</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                       <span class="n">email</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">other_info</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create new teacher entity to the database.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `first_name`: First name (cannot be blank)</span>
<span class="sd">        * `last_name`: Last name (cannot be blank)</span>
<span class="sd">        * `office`: Office information</span>
<span class="sd">        * `street_address`: Street address or P.O.Box</span>
<span class="sd">        * `postal_code`: Postal code</span>
<span class="sd">        * `city`: City</span>
<span class="sd">        * `phone`: Phone number</span>
<span class="sd">        * `email`: Email address</span>
<span class="sd">        * `other_info`: Other contact information</span>
<span class="sd">        * `modifier_id`: Creator or last modifier</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * ID of the new user or None, if there was an error creating new teacher.</span>

<span class="sd">        Raises exception ValueError if first_name or last_name were not given, or if email address was malformed.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Validate the parameters</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">first_name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">last_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;First and last name must be specified for a teacher&quot;</span><span class="p">)</span>

        <span class="c"># Validate the parameters</span>
        <span class="k">if</span> <span class="n">email</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;[^@]+@[^@]+\.[^@]+&quot;</span><span class="p">,</span> <span class="n">email</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Teacher&#39;s email address is malformed&quot;</span><span class="p">)</span>

        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement to create the row in archive table</span>
        <span class="n">sql_insert</span> <span class="o">=</span> <span class="s">&#39;INSERT INTO teacher (first_name, last_name, office, street_address, postal_code, city, phone, &#39;</span> \
                     <span class="s">&#39;email, other_info, modifier_id, last_modified) &#39;</span> \
                     <span class="s">&#39;VALUES (?,?,?,?,?,?,?,?,?,?,?)&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Check that the modifier_id is present in user table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Add the row to archive table by executing the statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">street_address</span><span class="p">,</span> <span class="n">postal_code</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">phone</span><span class="p">,</span>
                      <span class="n">email</span><span class="p">,</span> <span class="n">other_info</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_insert</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">lid</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span>

            <span class="c"># Return the last row&#39;s ID</span>
            <span class="k">return</span> <span class="n">lid</span>

    <span class="k">def</span> <span class="nf">edit_teacher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">office</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">street_address</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">postal_code</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">city</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                     <span class="n">phone</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">other_info</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update teacher details. The teacher is identified by the given teacher ID.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `teacher_id`: The ID of the teacher to be modified.</span>
<span class="sd">        * `first_name`: First name (cannot be blank)</span>
<span class="sd">        * `last_name`: Last name (cannot be blank)</span>
<span class="sd">        * `office`: Office information</span>
<span class="sd">        * `street_address`: Street address or P.O.Box</span>
<span class="sd">        * `postal_code`: Postal code</span>
<span class="sd">        * `city`: City</span>
<span class="sd">        * `phone`: Phone number</span>
<span class="sd">        * `email`: Email address</span>
<span class="sd">        * `other_info`: Other contact information</span>
<span class="sd">        * `modifier_id`: Creator or last modifier</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * ID of the updated message, if the user details were modified successfully or None, if not.</span>

<span class="sd">        Raises exception ExamDatabaseError if there was an error updating the teacher details.</span>
<span class="sd">        Raises exception ValueError if first_name or last_name were not given.</span>
<span class="sd">        ExamDatabaseErrorNotFound if modifier does not exist.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Validate the parameters</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">first_name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">last_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;First and last name must be specified for a teacher&quot;</span><span class="p">)</span>

        <span class="c"># Validate the parameters</span>
        <span class="k">if</span> <span class="n">email</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;[^@]+@[^@]+\.[^@]+&quot;</span><span class="p">,</span> <span class="n">email</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Teacher&#39;s email address is malformed&quot;</span><span class="p">)</span>

        <span class="c"># Create the SQL Statements</span>
        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the archive does exist</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&quot;SELECT teacher_id FROM teacher WHERE teacher_id = ?&quot;</span>

        <span class="n">sql_update</span> <span class="o">=</span> <span class="s">&#39;UPDATE teacher SET first_name = ?, last_name = ?, office = ?, street_address = ?, &#39;</span> \
                     <span class="s">&#39;postal_code = ?, city = ?, phone = ?, email = ?, other_info = ?, modifier_id = ? &#39;</span> \
                     <span class="s">&#39;WHERE teacher_id = ?&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute a query statement to check that the teacher id exists in the database, if not return None</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">teacher_id</span><span class="p">,)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c"># Only one value expected</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="c"># If the teacher row does not exist, return None</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Check that the given modifier_id exists in the user table</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

                <span class="c"># Execute the main update statement</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">street_address</span><span class="p">,</span> <span class="n">postal_code</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">phone</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span>
                          <span class="n">other_info</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_update</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>

                <span class="c"># Check to see that the database was successfully modified, otherwise return None</span>
                <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">None</span>

                <span class="c"># Return taecher id of the updated message</span>
                <span class="k">return</span> <span class="n">teacher_id</span>

    <span class="k">def</span> <span class="nf">browse_teachers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        List all the teachers in the database, or only the first teachers specified by the parameters limit and offset.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `course_id`: the ID of the course</span>
<span class="sd">        * `limit`: the maximum length of the list (-1 means no limit)</span>
<span class="sd">        * `offset`: skip the amount of offset exams from the beginning, offset being the first returned exam</span>
<span class="sd">        (zero means to start from the beginning)</span>
<span class="sd">        * `offset_represents_ids`: if false, the amount of rows specified by the `offset` parameter are skipped</span>
<span class="sd">        (e.g. for paging). If true, only the teachers are returned having teacher_id greater or equal than `offset`.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * A list of exams, if one or more archives were found, empty list otherwise. Each exam in the list is a</span>
<span class="sd">        dictionary containing the same structure as returned by _create_object.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_browse</span><span class="p">(</span><span class="s">&quot;teacher&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_teacher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get teacher details. The teacher is identified by the given teacher ID.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `teacher_id`: The ID of the teacher.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * `teacher_id`: The ID of the teacher to be modified.</span>
<span class="sd">        * `first_name`: First name</span>
<span class="sd">        * `last_name`: Last name</span>
<span class="sd">        * `office`: Office information</span>
<span class="sd">        * `street_address`: Street address or P.O.Box</span>
<span class="sd">        * `postal_code`: Postal code</span>
<span class="sd">        * `city`: City</span>
<span class="sd">        * `phone`: Phone number</span>
<span class="sd">        * `email`: Email address</span>
<span class="sd">        * `other_info`: Other contact information</span>
<span class="sd">        * `modifier_id`: Creator or last modifier</span>
<span class="sd">        * `last_modified`: Date when the teacher entity was last modified.</span>

<span class="sd">        If the teacher was not found with the given ID, None is returned.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="s">&quot;teacher&quot;</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_teacher_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Find teacher details by teacher name. A teacher is specified by giving its full name.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `teacher_id`: ID of the teacher</span>

<span class="sd">        OUTPUT is a dictionary containing the following keys:</span>

<span class="sd">        * `teacher_id`: The ID of the teacher to be modified.</span>
<span class="sd">        * `first_name`: First name</span>
<span class="sd">        * `last_name`: Last name</span>
<span class="sd">        * `office`: Office information</span>
<span class="sd">        * `street_address`: Street address or P.O.Box</span>
<span class="sd">        * `postal_code`: Postal code</span>
<span class="sd">        * `city`: City</span>
<span class="sd">        * `phone`: Phone number</span>
<span class="sd">        * `email`: Email address</span>
<span class="sd">        * `other_info`: Other contact information</span>
<span class="sd">        * `modifier_id`: Creator or last modifier</span>
<span class="sd">        * `last_modified`: Date when the teacher entity was last modified.</span>

<span class="sd">        If teacher was not found, None is returned.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the user does not yet exist</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from teacher WHERE first_name = ? AND last_name = ?&#39;</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute the SQL query statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_object</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">remove_teacher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Remove a teacher from the database.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `teacher_id`: ID of the teacher to be deleted.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * True, if a teacher with the given user_id was found, False otherwise.</span>

<span class="sd">        Returns true, if the delete succeeded, otherwise false if there was an error deleting the teacher from the database.</span>
<span class="sd">        &#39;&#39;&#39;</span>


        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
        <span class="n">delete_query</span> <span class="o">=</span> <span class="s">&#39;DELETE FROM teacher WHERE teacher_id = ?&#39;</span>

        <span class="c"># Connect to the database</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c">#Execute the statement to delete</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">teacher_id</span><span class="p">,)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">delete_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>

            <span class="c">#Check that it has been deleted</span>
            <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">True</span>


    <span class="c"># User handling functions of database API</span>
    <span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">user_type</span><span class="o">=</span><span class="s">&#39;basic&#39;</span><span class="p">,</span> <span class="n">archive_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create new user to database. The user_type can be one of the following:</span>

<span class="sd">        * &#39;basic&#39;: The user has only view access to archive specified by archive_id</span>
<span class="sd">        * &#39;admin&#39;: The user has read-write access to archive specified by archive_id</span>
<span class="sd">        * &#39;super&#39;: The user has read-write access to all the archives in the database.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `username`: Visible username.</span>
<span class="sd">        * `password`: Hashed password of the user.</span>
<span class="sd">        * `user_type`: User type identifies whether the user is superuser, admin or regular view-only user. The user_type must be one of the values &#39;super&#39;, &#39;admin&#39; or &#39;basic&#39;.</span>
<span class="sd">        * `archive_id`: The ID of an archive where the user has access to.</span>
<span class="sd">        * `modifier_id`: The creator or of the user or None if not specified.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * ID of the new user.</span>

<span class="sd">        Raises exception ExamDatabaseErrorExists, if user with the same username already exists, given archive or modifier does not exist.</span>
<span class="sd">        ExamDatabaseErrorNotFound if archive or modifier do not exist.</span>
<span class="sd">        Raises exception ValueError if the user_type was not one of the defined values.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Validation of user type</span>
        <span class="k">if</span> <span class="n">user_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;basic&#39;</span><span class="p">,</span> <span class="s">&#39;admin&#39;</span><span class="p">,</span> <span class="s">&#39;super&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;User type is not basic, admin or super&quot;</span><span class="p">)</span>

        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the user does not yet exist</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from user WHERE username = ?&#39;</span>

        <span class="c"># SQL Statement to create the row in archive table</span>
        <span class="n">sql_insert</span> <span class="o">=</span> <span class="s">&#39;INSERT INTO user (username, password, user_type, archive_id, modifier_id, last_modified) </span><span class="se">\</span>
<span class="s">        VALUES (?,?,?,?,?,?)&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Check that the given archive_id exists in the archive table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;archive&quot;</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Archive does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Check that modifier_id exists in the user table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Execute the statement to find out the username does not exists yet</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">username</span><span class="p">,)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span><span class="s">&quot;The given username already exists&quot;</span><span class="p">)</span>

            <span class="c"># Add the row to archive table by executing the statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">user_type</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_insert</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">lid</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span>
            <span class="c"># Return the last row&#39;s ID</span>
            <span class="k">return</span> <span class="n">lid</span>

    <span class="k">def</span> <span class="nf">edit_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">user_type</span><span class="o">=</span><span class="s">&#39;basic&#39;</span><span class="p">,</span> <span class="n">archive_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update user details. The user is identified by the given user ID.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `user_id`: The ID of the user to be modified.</span>
<span class="sd">        * `username`: Visible username.</span>
<span class="sd">        * `password`: Hashed password of the user.</span>
<span class="sd">        * `user_type`: User type identifies whether the user in superuser, admin or regular view-only user. The user_type must be one of the values &#39;super&#39;, &#39;admin&#39; or &#39;basic&#39;.</span>
<span class="sd">        * `archive_id`: The ID of an archive where the user has access to.</span>
<span class="sd">        * `modifier_id`: The creator or of the user or None if not specified.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * True, if the user details were modified successfully or False, if not.</span>

<span class="sd">        Raises exception ExamDatabaseErrorExists, if user with the same username already exists. Raises exception ExamDatabaseError if there was an error creating new user.</span>
<span class="sd">        ExamDatabaseErrorNotFound if modifier does not exist.</span>
<span class="sd">        Raises exception ValueError if the user_type was not one of the defined values.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Create the SQL Statements</span>
        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the user does exist</span>
        <span class="n">sql_query1</span> <span class="o">=</span> <span class="s">&quot;SELECT user_id FROM user WHERE user_id = ?&quot;</span>

        <span class="c"># SQL Statement for checking that another user does not yet exist with the same username</span>
        <span class="n">sql_query2</span> <span class="o">=</span> <span class="s">&#39;SELECT * from user WHERE user_id &lt;&gt; ? AND username = ?&#39;</span>

        <span class="c"># Validation of user type</span>
        <span class="k">if</span> <span class="n">user_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;basic&#39;</span><span class="p">,</span><span class="s">&#39;admin&#39;</span><span class="p">,</span><span class="s">&#39;super&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;User type is not basic, admin or super&quot;</span><span class="p">)</span>

        <span class="n">sql_update</span> <span class="o">=</span> <span class="s">&#39;UPDATE user SET user_type = ?, username = ?, password = ?, &#39;</span> \
                     <span class="s">&#39;modifier_id = ?, last_modified = ?, archive_id = ? &#39;</span> \
                     <span class="s">&#39;WHERE user_id = ?&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute a query statement to find out whether the user exists in the database</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query1</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c"># Only one value expected</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="c"># If the user does not exist, return None</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Check that the given modifier_id exists in the user table</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="c"># Execute the main update statement</span>
                    <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">user_type</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_update</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">IntegrityError</span><span class="p">:</span>
                    <span class="c"># Expect IntegrityError risen when new username already exists in the database</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span><span class="s">&quot;The given username already exists&quot;</span><span class="p">)</span>

                <span class="c"># Check to see that the database was successfully modified</span>
                <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">None</span>

                <span class="k">return</span> <span class="n">user_id</span>

    <span class="k">def</span> <span class="nf">browse_users</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        List all the users in the database, or only the first users specified by the parameters limit and offset.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `limit`: the maximum length of the list (-1 means no limit)</span>
<span class="sd">        * `offset`: skip the amount of offset users from the beginning, offset being the first returned user</span>
<span class="sd">        (zero means to start from the beginning)</span>
<span class="sd">        * `offset_represents_ids`: if false, the amount of rows specified by the `offset` parameter are skipped</span>
<span class="sd">        (e.g. for paging). If true, only the users are returned having user_id greater or equal than `offset`.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * A list of users, if one or more users were found, empty list otherwise. Each user in the list is a</span>
<span class="sd">        dictionary containing the same structure as returned by get_user.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_browse</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get user details. The user is identified by the given user ID.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `user_id`: The ID of the user.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * `username`: Visible username.</span>
<span class="sd">        * `password`: Hashed password of the user.</span>
<span class="sd">        * `user_type`: User type identifies whether the user in superuser, admin or regular view-only user. The user_type is one of values &#39;super&#39;, &#39;admin&#39; or &#39;basic&#39;.</span>
<span class="sd">        * `archive_id`: The ID of an archive where the user has access to.</span>
<span class="sd">        * `modifier_id`: The creator or of the user or None if not specified.</span>

<span class="sd">        If the user was not found with the given ID, None is returned.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_user_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Find user details by user name.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `user_name`: Visible username</span>

<span class="sd">        OUTPUT is a dictionary containing the following keys:</span>

<span class="sd">        * `user_id`: ID of the user.</span>
<span class="sd">        * `username`: Visible username.</span>
<span class="sd">        * `password`: Hashed password of the user.</span>
<span class="sd">        * `user_type`: User type identifies whether the user in superuser, admin or regular view-only user. The user_type is one of values &#39;super&#39;, &#39;admin&#39; or &#39;basic&#39;.</span>
<span class="sd">        * `archive_id`: The ID of an archive where the user has access to.</span>
<span class="sd">        * `modifier_id`: The creator or of the user or None if not specified.</span>

<span class="sd">        If user was not found, None is returned.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the user does not yet exist</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from user WHERE username = ?&#39;</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute the SQL query statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_object</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">authorize_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check if a user can be authorized with a given username and password.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `username`: Visible username.</span>
<span class="sd">        * `password`: Hashed password of the user.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * If the username and password were correct, user ID is returned, otherwise None.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the user does not yet exist</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT user_id from user WHERE username = ? AND password = ?&#39;</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute the SQL query statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;user_id&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">user_has_access</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check whether a user has access to a specified archive. The user is identified by the given user ID and archive by the given archive ID.</span>

<span class="sd">        INPUT:</span>
<span class="sd">        * `user_id`: The ID of the user.</span>
<span class="sd">        * `archive_id`: The ID of the archive.</span>
<span class="sd">        * `identification_needed`: Identification to the archive needed, true or false</span>

<span class="sd">        OUTPUT:</span>
<span class="sd">        * If the user is authorized to access the given archive, True is returned, otherwise False is returned. False is returned also, if the given user_id or archive_id does not exist. If the user is a superuser and an archive exists, True is always returned.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement fr checking that is the user an superuser</span>
        <span class="n">sql_query1</span> <span class="o">=</span> <span class="s">&#39;SELECT user_type FROM user WHERE user_id = ?&#39;</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute the SQL query statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query1</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="c"># If user is an superuser, just continue</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;user_type&#39;</span><span class="p">]</span>  <span class="o">==</span> <span class="s">&#39;super&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="c"># If user is not an superuser, continue with identification</span>
            <span class="k">else</span><span class="p">:</span>
                 <span class="c"># SQL Statement for checking that is identification to the archive needed</span>
                <span class="n">sql_query2</span> <span class="o">=</span> <span class="s">&#39;SELECT identification_needed FROM archive WHERE archive_id = ?&#39;</span>

                <span class="c"># Connect to the database and get a connection object</span>
                <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
                <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
                    <span class="c"># Cursor and row initialization</span>
                    <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
                    <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
                    <span class="c"># Provide support for foreign keys</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

                    <span class="c"># Execute the SQL query statement</span>
                    <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_id</span><span class="p">,)</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query2</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

                    <span class="c"># If user has access, continue with True</span>
                    <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">False</span>

                    <span class="c"># If identification to the archive is needed, identify the user</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;identification_needed&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>

                        <span class="c"># SQL Statement for checking user&#39;s access to the archive</span>
                        <span class="n">sql_query3</span> <span class="o">=</span> <span class="s">&#39;SELECT user_id, archive_id FROM user WHERE user_id = ? AND archive_id = ?&#39;</span>

                        <span class="c"># Connect to the database and get a connection object</span>
                        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
                        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
                            <span class="c"># Cursor and row initialization</span>
                            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
                            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
                            <span class="c"># Provide support for foreign keys</span>
                            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

                            <span class="c"># Execute the SQL query statement</span>
                            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">)</span>
                            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query3</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
                            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

                            <span class="c"># If user has access, continue with True</span>
                            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                                <span class="k">return</span> <span class="bp">True</span>
                            <span class="c"># Else False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">return</span> <span class="bp">False</span>

                    <span class="c"># If identification is not needed, just continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">remove_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Remove user from the database.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `user_id`: ID of the user to be deleted.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * True, if a user with the given user_id was removed, False otherwise.</span>

<span class="sd">        Returns true, if the delete succeeded, otherwise false if there was an error deleting the user from the database.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
        <span class="n">delete_query</span> <span class="o">=</span> <span class="s">&#39;DELETE FROM user WHERE user_id = ?&#39;</span>

        <span class="c"># Connect to the database</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c">#Execute the statement to delete</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">delete_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>

            <span class="c">#Check that it has been deleted</span>
            <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">True</span>

<span class="k">class</span> <span class="nc">ExamDatabaseError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Exception for general exam archive database error.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">ExamDatabaseErrorExists</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Exception for an error, when an entity already exists in the database.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Exception for an error, when a given entity was not found from the database.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">pass</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="exam_archive.DEFAULT_DATA_DUMP" class="name">var <span class="ident">DEFAULT_DATA_DUMP</span></p>
      
  
    <div class="desc"><p>SQL create and insert clauses for testing.</p></div>
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="exam_archive.DEFAULT_DB_PATH" class="name">var <span class="ident">DEFAULT_DB_PATH</span></p>
      
  
    <div class="desc"><p>Default path for exam archive SQLite database.</p></div>
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="exam_archive.DEFAULT_SCHEMA" class="name">var <span class="ident">DEFAULT_SCHEMA</span></p>
      
  
    <div class="desc"><p>SQL create clauses for creating the database.</p></div>
  <div class="source_cont">
</div>

      </div>


    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="exam_archive.ExamArchiveDatabase" class="name">class <span class="ident">ExamArchiveDatabase</span></p>
      
  
    <div class="desc"><p>API to access the exam archive database.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">ExamArchiveDatabase</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    API to access the exam archive database.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        db_path is the address of the path with respect to the calling script.</span>
<span class="sd">        If db_path is None, DEFAULT_DB_PATH is used instead.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ExamArchiveDatabase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">db_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db_path</span> <span class="o">=</span> <span class="n">db_path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db_path</span> <span class="o">=</span> <span class="n">DEFAULT_DB_PATH</span>

    <span class="c"># Setting up the database. Used for the tests. Setup, populate and delete the database</span>
    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Purge the database removing old values.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_init_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Populate the database with initial values. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_tables_from_schema</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_table_values_from_dump</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">create_tables_from_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create programmatically the tables from a schema file.</span>
<span class="sd">        schema contains the path to the .sql schema file. If it is None,  </span>
<span class="sd">        DEFAULT_SCHEMA is used instead. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">schema</span> <span class="o">=</span> <span class="n">DEFAULT_SCHEMA</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_table_values_from_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dump</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Populate programmatically the tables from a dump file.</span>
<span class="sd">        dump is the path to the .sql dump file. If it is None,  </span>
<span class="sd">        DEFAULT_DATA_DUMP is used instead.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dump</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">dump</span> <span class="o">=</span> <span class="n">DEFAULT_DATA_DUMP</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dump</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>

    <span class="c"># Helper functions for public database API functions.</span>

    <span class="k">def</span> <span class="nf">_create_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a dictionary object from a table row.</span>

<span class="sd">        Source: A simple REST server for Sailors,</span>
<span class="sd">        http://www.cs.unc.edu/Courses/comp521-f13/media/L9-InternetApplications2.html</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">row</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_scrub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; </span>
<span class="sd">        Sanitize a table name that can not be replaced with sqlite3&#39;s substitaion.</span>
<span class="sd">        E.g. _scrub(&#39;); drop tables --&#39;) returns &#39;droptables&#39;</span>
<span class="sd">        </span>
<span class="sd">        Code snippet by Donald Miner, source: http://stackoverflow.com/questions/3247183/variable-table-name-in-sqlite</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span> <span class="k">for</span> <span class="nb">chr</span> <span class="ow">in</span> <span class="n">table_name</span> <span class="k">if</span> <span class="nb">chr</span><span class="o">.</span><span class="n">isalnum</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_valid_foreign_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_connection</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check if a foreign key is valid and can be found from referencing table.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="c"># Sanitize the table name before using it</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scrub</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>

        <span class="c"># SQL Statement for checking that the user does not yet exist</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from </span><span class="si">%s</span><span class="s"> WHERE </span><span class="si">%s</span><span class="s">_id = ?&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,)</span>
        <span class="n">db_connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">db_connection</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="c"># Database API - functions to handle database</span>

    <span class="k">def</span> <span class="nf">create_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_name</span><span class="p">,</span> <span class="n">organisation_name</span><span class="p">,</span> <span class="n">identification_needed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create new exam archive to database. An archive is specific to certain </span>
<span class="sd">        faculty or department, for example &quot;Blanko&quot; for Information Processing</span>
<span class="sd">        Science faculty of Oulu University.</span>
<span class="sd">        </span>
<span class="sd">        INPUT:</span>

<span class="sd">        * `archive_name`: The name of the archive to be created.</span>
<span class="sd">        * `organisation_name`: The name of the organisation, such as faculty, department or school, owning the archive.</span>
<span class="sd">        * `identification_needed`:  Whether authorization is required from basic users to view exams.</span>
<span class="sd">        * `modifier_id`: The creator or last modifier of the archive or None if not specified.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * ID of the new archive, if the archive was created successfully, None otherwise.</span>

<span class="sd">        Raises exception ExamDatabaseErrorExists, if the an archive already exists with the given name.</span>
<span class="sd">        Raises exception ExamDatabaseErrorNotFound, if given modifier was not found.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the archive does not yet exist</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from archive WHERE archive_name = ? AND organisation_name = ?&#39;</span>

        <span class="c"># SQL Statement to create the row in archive table</span>
        <span class="n">sql_insert</span> <span class="o">=</span> <span class="s">&#39;INSERT INTO archive (archive_name, organisation_name, identification_needed, modifier_id, last_modified) </span><span class="se">\</span>
<span class="s">        VALUES (?,?,?,?,?)&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Check that the modifier_id is present in user table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Execute the statement to find out the archive does not yet exist</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_name</span><span class="p">,</span> <span class="n">organisation_name</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span>
                    <span class="s">&quot;Archive already has an entry with the same organisation and archive name&quot;</span><span class="p">)</span>

            <span class="c"># Add the row to archive table by executing the statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_name</span><span class="p">,</span> <span class="n">organisation_name</span><span class="p">,</span> <span class="n">identification_needed</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_insert</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">lid</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span>

            <span class="c"># Return the last row&#39;s ID</span>
            <span class="k">return</span> <span class="n">lid</span>


    <span class="k">def</span> <span class="nf">create_course</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">,</span> <span class="n">course_code</span><span class="p">,</span> <span class="n">course_name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">credit_points</span><span class="p">,</span>
                      <span class="n">language_id</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create an course to the archive. Archive can include multiple courses under same name and other information,</span>
<span class="sd">        but there can&#39;t be be two courses with same name and language.</span>

<span class="sd">        INPUT:</span>
<span class="sd">        </span>
<span class="sd">        * `archive_id`: ID of the archive where the course belongs to.</span>
<span class="sd">        * `course_code`: Code of the course, which is used to identify course for in curriculum.</span>
<span class="sd">        * `course_name`: Textual name of the course to be created.</span>
<span class="sd">        * `description`: Description of the course.</span>
<span class="sd">        * `teacher_id`: ID of the teacher, lecturer or other responsible person of the course.</span>
<span class="sd">        * `url`: Course home page URL.</span>
<span class="sd">        * `credit_points`: Amount of credit points, that can be earned from the course.</span>
<span class="sd">        * `language_id`: Language identifier of the language used in the course.</span>
<span class="sd">        * `modifier_id`: The creator or last modifier of the course or None if not specified.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * ID of the new course entity, if the course was created successfully, None otherwise.</span>

<span class="sd">        Raises exception ExamDatabaseErrorExists, if course with given course_name and language_id combination already exists.</span>
<span class="sd">        Raises ExamDatabaseErrorNotFound if given archive, teacher, language or modifier were not found in the database.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the course does not yet exist</span>
        <span class="n">sql_course_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from course WHERE course_name = ? AND language_id = ?&#39;</span>

        <span class="c"># SQL Statement to create the row in archive table</span>
        <span class="n">sql_insert</span> <span class="o">=</span> <span class="s">&#39;INSERT INTO course (archive_id, course_code, course_name, description, teacher_id, url, &#39;</span> \
                     <span class="s">&#39;credit_points, language_id, modifier_id, last_modified) &#39;</span> \
                     <span class="s">&#39;VALUES (?,?,?,?,?,?,?,?,?,?)&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Check that the given user_id exists in the user table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Check that the given teacher_id exists in the teacher table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;teacher&quot;</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Teacher does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Check that the given archive_id exists in the archive table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;archive&quot;</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Archive does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Check that the given language_id exists in the language table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;language&quot;</span><span class="p">,</span> <span class="n">language_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Language does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Execute the statement to find out the archive does not yet exist</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_name</span><span class="p">,</span> <span class="n">language_id</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_course_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span><span class="s">&quot;Course already exists with the same name and language&quot;</span><span class="p">)</span>

            <span class="c"># Add the row to archive table by executing the statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">archive_id</span><span class="p">,</span> <span class="n">course_code</span><span class="p">,</span> <span class="n">course_name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">credit_points</span><span class="p">,</span> <span class="n">language_id</span><span class="p">,</span>
                <span class="n">modifier_id</span><span class="p">,</span>
                <span class="n">last_modified</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_insert</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">lid</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span>
            <span class="c"># Return the last row&#39;s ID</span>
            <span class="k">return</span> <span class="n">lid</span>


    <span class="k">def</span> <span class="nf">create_exam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">course_id</span><span class="p">,</span> <span class="n">examiner_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">file_attachment</span><span class="p">,</span> <span class="n">language_id</span><span class="o">=</span><span class="s">&#39;fi&#39;</span><span class="p">,</span>
                    <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create an exam and attach it to the given course. A course can be specified by giving either course name or</span>
<span class="sd">        course code.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `course_id`: The idenfier of the course, where the exam belongs to</span>
<span class="sd">        * `examiner_id`: ID of the teacher, lecturer or other person responsible of overseeing the exam.</span>
<span class="sd">        * `date`: Date of the exam given in format of YYYY-MM-DD.</span>
<span class="sd">        * `file_attachment`: Identifier for the file attachment.</span>
<span class="sd">        * `language_id`: Language identifier for the exam.</span>
<span class="sd">        * `modifier_id`: The creator or last modifier of the exam or None if not specified.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * ID of the new exam entity, if the exam was created successfully, None otherwise.</span>

<span class="sd">        Raises exception ExamDatabaseErrorExists, if the an exam already exists with the given date and course,</span>
<span class="sd">        Raises exception ExamDatabaseErrorNotFound if course, examiner, language or modifier does not exist.</span>
<span class="sd">        Raises exception ValueError if the date is not given in format of YYYY-MM-DD.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Check that the given date string is in valid date format</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="s">&#39;YYYY-MM-DD&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;YYYY-MM-DD&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Date must be in format &quot;YYYY-MM-DD&quot;&#39;</span><span class="p">)</span>

        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the exam does not yet exist</span>
        <span class="n">sql_course_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from exam WHERE course_id = ? AND date = ?&#39;</span>

        <span class="c"># SQL Statement to create the row in archive table</span>
        <span class="n">sql_insert</span> <span class="o">=</span> <span class="s">&#39;INSERT INTO exam (course_id, examiner_id, date, file_attachment, language_id, &#39;</span> \
                     <span class="s">&#39;modifier_id, last_modified)&#39;</span> \
                     <span class="s">&#39;VALUES (?,?,?,?,?,?,?)&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Check that the given course_id exists in the course table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;course&quot;</span><span class="p">,</span> <span class="n">course_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Course does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Check that the given user_id exists in the user table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Check that the given examiner_id exists in the teacher table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;teacher&quot;</span><span class="p">,</span> <span class="n">examiner_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Examiner does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Check that the given language_id exists in the language table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;language&quot;</span><span class="p">,</span> <span class="n">language_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Language does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Execute the statement to find out the archive does not yet exist</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_id</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_course_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span><span class="s">&quot;Exam already exists within the same course and date&quot;</span><span class="p">)</span>

            <span class="c"># Add the row to archive table by executing the statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_id</span><span class="p">,</span> <span class="n">examiner_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">file_attachment</span><span class="p">,</span> <span class="n">language_id</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_insert</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">lid</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span>

            <span class="c"># Return the last row&#39;s ID</span>
            <span class="k">return</span> <span class="n">lid</span>


    <span class="k">def</span> <span class="nf">edit_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">,</span> <span class="n">archive_name</span><span class="p">,</span> <span class="n">organisation_name</span><span class="p">,</span> <span class="n">identification_needed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update an archive in the database. An archive can be specified by giving archive id.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `archive_id`: ID of the archive to be updated</span>
<span class="sd">        * `archive_name`: The name of the archive to be edited.</span>
<span class="sd">        * `organisation_name`: The name of the organisation, such as faculty, department or school, owning the archive.</span>
<span class="sd">        * `identification_needed`:  Whether authorization is required from basic users to view archive.</span>
<span class="sd">        * `modifier_id`: The creator or last modifier of the archive or None if not specified.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * ID of the archive, if the archive was edited successfully and None if the archive did not exist or there was</span>
<span class="sd">        an error updating the database.</span>

<span class="sd">        Raises exception ExamDatabaseErrorExists, if the an archive already exists with the given name.</span>
<span class="sd">        Raises exception ExamDatabaseErrorNotFound, if given modifier does not exist.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Create the SQL Statements</span>
        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the archive does exist</span>
        <span class="n">sql_query1</span> <span class="o">=</span> <span class="s">&quot;SELECT archive_id FROM archive WHERE archive_id = ?&quot;</span>

        <span class="c"># SQL Statement for checking that another archive does not yet exist with the same name and organisation</span>
        <span class="n">sql_query2</span> <span class="o">=</span> <span class="s">&#39;SELECT * from archive WHERE archive_id &lt;&gt; ? AND archive_name = ? AND organisation_name = ?&#39;</span>

        <span class="n">sql_update</span> <span class="o">=</span> <span class="s">&#39;UPDATE archive SET archive_name = ?, organisation_name = ?, identification_needed = ?, &#39;</span> \
                     <span class="s">&#39;modifier_id = ?, last_modified = ? &#39;</span> \
                     <span class="s">&#39;WHERE archive_id = ?&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute a query statement to find out whether the archive exists in the database</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_id</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query1</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c"># Only one value expected</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="c"># If the archive does not exist, return None</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Execute a query statement to check that another archive does not yet exist with the same name and organisation</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_id</span><span class="p">,</span> <span class="n">archive_name</span><span class="p">,</span> <span class="n">organisation_name</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query2</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
                <span class="c"># Only one value expected</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

                <span class="c"># If the archive exists, raise an exception</span>
                <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span>
                        <span class="s">&quot;Another archive already exists with the same archive and organisation name&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Check that the given modifier_id exists in the user table</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

                    <span class="c"># Execute the main update statement</span>
                    <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_name</span><span class="p">,</span> <span class="n">organisation_name</span><span class="p">,</span> <span class="n">identification_needed</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">,</span>
                              <span class="n">archive_id</span><span class="p">)</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_update</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>

                    <span class="c"># Check to see that the database was successfully modified</span>
                    <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">None</span>
                    <span class="c"># Return message id with &#39;msg-&#39; in the beginning</span>
                    <span class="k">return</span> <span class="n">archive_id</span>


    <span class="k">def</span> <span class="nf">edit_course</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">course_id</span><span class="p">,</span> <span class="n">course_code</span><span class="p">,</span> <span class="n">course_name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">credit_points</span><span class="p">,</span> <span class="n">language_id</span><span class="p">,</span>
                    <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update an course in the archive identified by a course ID. Archive can include multiple courses under same name </span>
<span class="sd">        and other information, but there cannot be be two courses with same name and language.</span>
<span class="sd">        </span>
<span class="sd">        INPUT:</span>

<span class="sd">        * `course_id`: ID of the course to be updated</span>
<span class="sd">        * `course_code`: Code of the course, what is used to identify course for in curriculum.</span>
<span class="sd">        * `course_name`: Textual name of the course to be created.</span>
<span class="sd">        * `description`: Description of the course.</span>
<span class="sd">        * `teacher_id`: Name of the teacher, lecturer or other responsible person of the course.</span>
<span class="sd">        * `url`: Course home page URL.</span>
<span class="sd">        * `credit_points`: Amount of credit points, that can be earned from the course.</span>
<span class="sd">        * `language_id`: Language identifier of the language used in the course.</span>
<span class="sd">        * `modifier_id`: The creator or last modifier of the course or None if not specified.</span>
<span class="sd">        </span>
<span class="sd">        OUTPUT:</span>

<span class="sd">        * ID of the course, if the course was updated successfully and None if the course did not exist or there was</span>
<span class="sd">        an error updating the database.</span>
<span class="sd">        </span>
<span class="sd">        Raises exception ExamDatabaseErrorExists, if course with given course_name and language_id combination already </span>
<span class="sd">        exists. Raises ExamDatabaseErrorNotFound, if given teacher, language or modifier does not exist.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Create the SQL Statements</span>
        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the course does exist and also for fetching the archive_id</span>
        <span class="n">sql_query1</span> <span class="o">=</span> <span class="s">&quot;SELECT archive_id FROM course WHERE course_id = ?&quot;</span>

        <span class="c"># SQL Statement for checking that another course does not yet exist with the same name and language,</span>
        <span class="c"># within the same archive.</span>
        <span class="n">sql_query2</span> <span class="o">=</span> <span class="s">&#39;SELECT * from course WHERE course_id &lt;&gt; ? AND archive_id = ? AND course_name = ? AND &#39;</span> \
                     <span class="s">&#39;language_id = ?&#39;</span>

        <span class="n">sql_update</span> <span class="o">=</span> <span class="s">&#39;UPDATE course SET course_code = ?, course_name = ?, description = ?, &#39;</span> \
                     <span class="s">&#39;teacher_id = ?, url = ?, credit_points = ?, language_id = ?, modifier_id = ?, &#39;</span> \
                     <span class="s">&#39;last_modified = ? WHERE course_id = ?&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute a query statement to find out whether the course exists in the database</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_id</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query1</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c"># Only one value expected</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="c"># If the course does not exist, return None</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Get the course&#39;s archive id from the previous query response</span>
                <span class="n">archive_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;archive_id&#39;</span><span class="p">]</span>
                <span class="c"># Execute a query statement to check that another course does not yet exist with the same name and language</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_id</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">,</span> <span class="n">course_name</span><span class="p">,</span> <span class="n">language_id</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query2</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
                <span class="c"># Only one value expected</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

                <span class="c"># If the archive exists, raise an exception</span>
                <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span>
                        <span class="s">&quot;Another course already exists with the same name and language combination&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Check that the given examiner_id exists in the teacher table</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;teacher&quot;</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Teacher does not exist&quot;</span><span class="p">)</span>

                    <span class="c"># Check that the given modifier_id exists in the user table</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;language&quot;</span><span class="p">,</span> <span class="n">language_id</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Language does not exist&quot;</span><span class="p">)</span>

                    <span class="c"># Check that the given modifier_id exists in the user table</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

                    <span class="c"># Execute the main update statement</span>
                    <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_code</span><span class="p">,</span> <span class="n">course_name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">credit_points</span><span class="p">,</span>
                              <span class="n">language_id</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">,</span> <span class="n">course_id</span><span class="p">)</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_update</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>

                    <span class="c"># Check to see that the database was successfully modified</span>
                    <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">None</span>

                    <span class="c"># Everything succeeded * return the course id</span>
                    <span class="k">return</span> <span class="n">course_id</span>


    <span class="k">def</span> <span class="nf">edit_exam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exam_id</span><span class="p">,</span> <span class="n">course_id</span><span class="p">,</span> <span class="n">examiner_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">file_attachment</span><span class="p">,</span> <span class="n">language_id</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update an exam in the archive.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `exam_id`: The ID of the exam to be updated</span>
<span class="sd">        * `course_id`: The ID of the course where the exam belongs to</span>
<span class="sd">        * `examiner_id`: ID of the teacher, lecturer or other person responsible of overseeing the exam.</span>
<span class="sd">        * `date`: Date of the exam given in format of YYYY-MM-DD.</span>
<span class="sd">        * `file_attachment`: Identifier for the file attachment.</span>
<span class="sd">        * `language_id`: Language identifier for the exam.</span>
<span class="sd">        * `modifier_id`: The creator or last modifier of the exam or None if not specified.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * True, if the exam was created successfully, False otherwise.</span>

<span class="sd">        Raises exception ExamDatabaseErrorExists, if the an exam already exists with the given course, date and language.</span>
<span class="sd">        Raises exception ValueError if the date was not given in format YYYY-MM-DD. Raises ExamDatabaseErrorNotFound if</span>
<span class="sd">        course, modifier, language or examiner do not exist.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Check that the given date string is in valid date format</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="s">&#39;YYYY-MM-DD&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;YYYY-MM-DD&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Date must be in format &quot;YYYY-MM-DD&quot;&#39;</span><span class="p">)</span>

        <span class="c"># Create the SQL Statements</span>
        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the exam does exist</span>
        <span class="n">sql_query1</span> <span class="o">=</span> <span class="s">&quot;SELECT exam_id FROM exam WHERE exam_id = ?&quot;</span>

        <span class="c"># SQL Statement for checking that another exam does not yet exist with the same course, date and language.</span>
        <span class="n">sql_query2</span> <span class="o">=</span> <span class="s">&#39;SELECT * from exam WHERE exam_id &lt;&gt; ? AND course_id = ? AND date = ? AND language_id = ?&#39;</span>

        <span class="n">sql_update</span> <span class="o">=</span> <span class="s">&#39;UPDATE exam SET course_id = ?, examiner_id = ?, date = ?, file_attachment = ?, language_id = ?, &#39;</span> \
                     <span class="s">&#39;modifier_id = ?, last_modified = ? &#39;</span> \
                     <span class="s">&#39;WHERE exam_id = ?&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute a query statement to find out whether the exam exists in the database</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">exam_id</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query1</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c"># Only one value expected</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="c"># If the course does not exist, return None</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Execute a query statement to check that another exam does not yet exist within the same course</span>
                <span class="c"># and with the same language</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">exam_id</span><span class="p">,</span> <span class="n">course_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">language_id</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query2</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
                <span class="c"># Only one value expected</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

                <span class="c"># If the archive exists, raise an exception</span>
                <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span>
                        <span class="s">&quot;Another exam already exists with the same course, date and language&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Check that the given course_id exists in the course table</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;course&quot;</span><span class="p">,</span> <span class="n">course_id</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Course does not exist&quot;</span><span class="p">)</span>

                    <span class="c"># Check that the given examiner_id exists in the teacher table</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;teacher&quot;</span><span class="p">,</span> <span class="n">examiner_id</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Examiner does not exist&quot;</span><span class="p">)</span>

                    <span class="c"># Check that the given modifier_id exists in the user table</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;language&quot;</span><span class="p">,</span> <span class="n">language_id</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Language does not exist&quot;</span><span class="p">)</span>

                    <span class="c"># Check that the given modifier_id exists in the user table</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

                    <span class="c"># Execute the main update statement</span>
                    <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_id</span><span class="p">,</span> <span class="n">examiner_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">file_attachment</span><span class="p">,</span> <span class="n">language_id</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span>
                              <span class="n">last_modified</span><span class="p">,</span> <span class="n">exam_id</span><span class="p">)</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_update</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>

                    <span class="c"># Check to see that the database was successfully modified</span>
                    <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">None</span>

                    <span class="c"># Everything succeeded - return the exam id</span>
                    <span class="k">return</span> <span class="n">exam_id</span>


    <span class="k">def</span> <span class="nf">edit_exam_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exam_id</span><span class="p">,</span> <span class="n">file_attachment</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update an exam file attachment.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `exam_id`: The ID of the exam to be updated</span>
<span class="sd">        * `file_attachment`: Identifier for the file attachment.</span>
<span class="sd">        * `modifier_id`: The creator or last modifier of the exam or None if not specified.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * True, if the exam was updated successfully, False otherwise.</span>

<span class="sd">        Raises ExamDatabaseErrorNotFound if course, modifier, language or examiner do not exist.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Create the SQL Statements</span>
        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the exam does exist</span>
        <span class="n">sql_query1</span> <span class="o">=</span> <span class="s">&quot;SELECT exam_id FROM exam WHERE exam_id = ?&quot;</span>

        <span class="n">sql_update</span> <span class="o">=</span> <span class="s">&#39;UPDATE exam SET file_attachment = ?, &#39;</span> \
                     <span class="s">&#39;modifier_id = ?, last_modified = ? &#39;</span> \
                     <span class="s">&#39;WHERE exam_id = ?&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute a query statement to find out whether the exam exists in the database</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">exam_id</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query1</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c"># Only one value expected</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="c"># If the course does not exist, return None</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Check that the given modifier_id exists in the user table</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

                <span class="c"># Execute the main update statement</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">file_attachment</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">,</span> <span class="n">exam_id</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_update</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>

                <span class="c"># Check to see that the database was successfully modified</span>
                <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">None</span>

                <span class="c"># Everything succeeded - return the exam id</span>
                <span class="k">return</span> <span class="n">exam_id</span>


    <span class="c"># Browsing functions of database API</span>

    <span class="k">def</span> <span class="nf">_browse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">parent_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        List all rows in a table, or only the first rows specified by the parameter limit starting from offset.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `table`: table is either &#39;archive&#39;, &#39;course&#39;, &#39;exam&#39;, &#39;teacher&#39; or &#39;user&#39;</span>
<span class="sd">        * `parent_id`: if table is &#39;course&#39;, parent_id specifies the ID of an archive,</span>
<span class="sd">        if table is &#39;exam&#39;, parent_id specified the ID of an course. For archive, the paramenter has not effect</span>
<span class="sd">        * `limit`: the maximum length of the list (-1 means no limit)</span>
<span class="sd">        * `offset`: skip the amount of offset rows from the beginning, offset being the first returned row</span>
<span class="sd">        (zero means to start from the beginning)</span>
<span class="sd">        * `offset_represents_ids`: if false, the amount of rows specified by the `offset` parameter are skipped (e.g. for paging). If true, only the XXX are returned having XXX_id greater or equal than `offset`.  the table id (the primary key of the table)</span>
<span class="sd">        * `parent_id`: if</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * A list of rows, if one or more rows were found, empty list otherwise. Each row in the list is a</span>
<span class="sd">        dictionary containing the same structure as returned by _create_object.</span>

<span class="sd">        Raises exception ExamDatabaseError if there was an error accessing the database. Raises exception ValueError</span>
<span class="sd">        if table is not archive, course or exam.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Sanitize the table name and based on it, formulate the primary key attribute</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scrub</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
        <span class="n">table_id</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">_id&quot;</span> <span class="o">%</span> <span class="n">table</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">()</span>

        <span class="k">if</span> <span class="n">table</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;archive&#39;</span><span class="p">,</span> <span class="s">&#39;course&#39;</span><span class="p">,</span> <span class="s">&#39;exam&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">,</span> <span class="s">&#39;teacher&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Given table is not archive, course, exam, user nor teacher&quot;</span><span class="p">)</span>

        <span class="c"># Create the SQL Statement</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * FROM </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">table</span>
        <span class="n">sql_limit</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">sql_where</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># If parent_id is speficied, limit the id accordingly:</span>
        <span class="c"># - if table == &#39;course&#39;, add where clause &#39;WHERE archive_id = &lt;parent_id&gt;&#39;</span>
        <span class="c"># - if table == &#39;exam&#39;, add where clause &#39;WHERE course_id = &lt;parent_id&gt;&#39;</span>
        <span class="k">if</span> <span class="n">table</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;course&#39;</span><span class="p">,</span> <span class="s">&#39;exam&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">parent_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">table</span> <span class="o">==</span> <span class="s">&#39;course&#39;</span><span class="p">:</span>
                <span class="n">sql_where</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;archive_id = ?&#39;</span><span class="p">)</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">parent_id</span><span class="p">,)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># table is &#39;exam&#39;</span>
                <span class="n">sql_where</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;course_id = ?&#39;</span><span class="p">)</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">parent_id</span><span class="p">,)</span>

        <span class="c"># If limit or offset were defined and add WHERE or LIMIT clauses to the query</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">offset</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">offset_represents_ids</span><span class="p">:</span>
                <span class="n">sql_where</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> &gt;= ?&#39;</span> <span class="o">%</span> <span class="n">table_id</span><span class="p">)</span>
                <span class="n">sql_limit</span> <span class="o">=</span> <span class="s">&#39; LIMIT ?&#39;</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="n">pvalue</span> <span class="o">+</span> <span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># In SQLite, &#39;LIMIT -1 OFFSET 0&#39; is allowed so we do not need to check</span>
                <span class="c"># whether limit or offset or both of them were defined</span>
                <span class="n">sql_limit</span> <span class="o">=</span> <span class="s">&#39; LIMIT ? OFFSET ?&#39;</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="n">pvalue</span> <span class="o">+</span> <span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>

        <span class="c"># According to PEP 8, empty strings are false</span>
        <span class="k">if</span> <span class="n">sql_where</span><span class="p">:</span>
            <span class="n">sql_query</span> <span class="o">+=</span> <span class="s">&#39; WHERE &#39;</span> <span class="o">+</span> <span class="s">&#39; AND &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sql_where</span><span class="p">)</span>

        <span class="c"># For the time being, sort by primary key (more complex functionality implemented later)</span>
        <span class="n">sql_query</span> <span class="o">+=</span> <span class="s">&#39; ORDER BY </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">table_id</span>

        <span class="k">if</span> <span class="n">sql_limit</span><span class="p">:</span>
            <span class="n">sql_query</span> <span class="o">+=</span> <span class="n">sql_limit</span>

        <span class="c"># Connect to the database</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c">#Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

            <span class="c">#Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c">#Execute main SQL Statement</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>

            <span class="c">#Get results</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

            <span class="c"># Build a list of objects containing the table rows</span>
            <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_object</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">list</span>

    <span class="k">def</span> <span class="nf">browse_archives</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        List all the archives in the database, or only the first archives specified by the parameters limit and offset.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `limit`: the maximum length of the list (-1 means no limit)</span>
<span class="sd">        * `offset`: skip the amount of offset archives from the beginning, offset being the first returned archive</span>
<span class="sd">        (zero means to start from the beginning)</span>
<span class="sd">        * `offset_represents_ids`: if false, the amount of rows specified by the `offset` parameter are skipped</span>
<span class="sd">        (e.g. for paging). If true, only the archives are returned having archive_id greater or equal than `offset`.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * A list of archives, if one or more archives were found, empty list otherwise. Each archive in the list is a</span>
<span class="sd">        dictionary containing the same structure as returned by get_archive.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_browse</span><span class="p">(</span><span class="s">&quot;archive&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">browse_courses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        List all the course in an archive, or only the first courses specified by the parameters limit and offset.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `archive_id`: The ID of an archive</span>
<span class="sd">        * `limit`: the maximum length of the list (-1 means no limit)</span>
<span class="sd">        * `offset`: skip the amount of offset courses from the beginning, offset being the first returned course</span>
<span class="sd">        (zero means to start from the beginning)</span>
<span class="sd">        * `offset_represents_ids`: if false, the amount of rows specified by the `offset` parameter are skipped</span>
<span class="sd">        (e.g. for paging). If true, only the courses are returned having course_id greater or equal than `offset`.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * A list of courses, if one or more archives were found, empty list otherwise. Each course in the list is a</span>
<span class="sd">        dictionary containing the same structure as returned by get_course.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_browse</span><span class="p">(</span><span class="s">&quot;course&quot;</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">browse_exams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">course_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        List all the exams of a course, or only the first exams specified by the parameters limit and offset.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `course_id`: the ID of the course</span>
<span class="sd">        * `limit`: the maximum length of the list (-1 means no limit)</span>
<span class="sd">        * `offset`: skip the amount of offset exams from the beginning, offset being the first returned exam</span>
<span class="sd">        (zero means to start from the beginning)</span>
<span class="sd">        * `offset_represents_ids`: if false, the amount of rows specified by the `offset` parameter are skipped</span>
<span class="sd">        (e.g. for paging). If true, only the exams are returned having exam_id greater or equal than `offset`.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * A list of exams, if one or more archives were found, empty list otherwise. Each exam in the list is a</span>
<span class="sd">        dictionary containing the same structure as returned by get_exam.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_browse</span><span class="p">(</span><span class="s">&quot;exam&quot;</span><span class="p">,</span> <span class="n">course_id</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="p">)</span>

    <span class="c"># Get functions of database API</span>

    <span class="k">def</span> <span class="nf">_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">key_value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get a sigle row from a table.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `table`: table is either &#39;archive&#39;, &#39;course&#39;, &#39;exam&#39;, &#39;teacher&#39; or &#39;user&#39;</span>
<span class="sd">        * `key_value`: the row where primary key has the value of key_value</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * One rows, if it was found, None otherwise.</span>

<span class="sd">        Raises exception ExamDatabaseError if there was an error accessing the database. Raises exception ValueError</span>
<span class="sd">        if table is not archive, course or exam.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Sanitize the table name and based on it, formulate the primary key attribute</span>
        <span class="n">table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scrub</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
        <span class="n">table_id</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">_id&quot;</span> <span class="o">%</span> <span class="n">table</span>

        <span class="k">if</span> <span class="n">table</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;archive&#39;</span><span class="p">,</span> <span class="s">&#39;course&#39;</span><span class="p">,</span> <span class="s">&#39;exam&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">,</span> <span class="s">&#39;teacher&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Given table is not archive, course, exam, user nor teacher&quot;</span><span class="p">)</span>

        <span class="c"># Create the SQL Statement</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * FROM </span><span class="si">%s</span><span class="s"> WHERE </span><span class="si">%s</span><span class="s"> = ?&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">table_id</span><span class="p">)</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">key_value</span><span class="p">,)</span>

        <span class="c"># Connect to the database</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c">#Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

            <span class="c">#Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c">#Execute main SQL Statement</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>

            <span class="c">#Get results</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

            <span class="c"># Return the first row found</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_object</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">obj</span>

            <span class="c"># Otherwise return None</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">get_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get archive details from the database. An archive can be specified by giving archive id.</span>

<span class="sd">        INPUT:</span>
<span class="sd">        </span>
<span class="sd">        * `archive_id`: ID of the archive</span>

<span class="sd">        OUTPUT is a dictionary containing the following keys:</span>

<span class="sd">        * `archive_name`: The name of the archive</span>
<span class="sd">        * `organisation_name`: The name of the organisation, such as faculty, department or school, owning the archive.</span>
<span class="sd">        * `identification_needed`:  Whether authorization is required from basic users to view exams.</span>
<span class="sd">        * `modifier_id`: The creator or last modifier of the archive or None if not specified.</span>
<span class="sd">        * `last_modified`: The date archive was last modified</span>

<span class="sd">        If archive was not found, None is returned.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="s">&quot;archive&quot;</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_archive_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Find an archive by name. An archive can be specified by giving the full name.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `archive_name`: Name of the archive.</span>

<span class="sd">        OUTPUT is a dictionary containing the following keys:</span>

<span class="sd">        * `archive_id`: The name of the archive</span>
<span class="sd">        * `archive_name`: The name of the archive</span>
<span class="sd">        * `organisation_name`: The name of the organisation, such as faculty, department or school, owning the archive.</span>
<span class="sd">        * `identification_needed`:  Whether authorization is required from basic users to view exams.</span>
<span class="sd">        * `modifier_id`: The creator or last modifier of the archive or None if not specified.</span>
<span class="sd">        * `last_modified`: The date archive was last modified</span>

<span class="sd">        If archive was not found, None is returned.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the user does not yet exist</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from archive WHERE archive_name = ?&#39;</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute the SQL query statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_name</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_object</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">get_course</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">course_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get course details from the database. A course is specified by giving course id.</span>

<span class="sd">        INPUT:</span>
<span class="sd">        </span>
<span class="sd">        * `course_id`: ID of the course</span>

<span class="sd">        OUTPUT is a dictionary containing the following keys:</span>

<span class="sd">        * `archive_id`: The ID of an archive where the course belongs to</span>
<span class="sd">        * `course_code`: Code of course, which used to to identify course in curriculum</span>
<span class="sd">        * `course_name`: Textual name of the course</span>
<span class="sd">        * `description`: Description of course</span>
<span class="sd">        * `teacher_id`: Responsible teacher of the course</span>
<span class="sd">        * `url`: URL address to the course webpage</span>
<span class="sd">        * `credit_points`: Number of total credit points earned from course</span>
<span class="sd">        * `language_id`: Identifies language used in course</span>
<span class="sd">        * `modifier_id`: Creator or last modifie</span>
<span class="sd">        * `last_modified`: Last modified date.</span>

<span class="sd">        If course was not found, None is returned.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="s">&quot;course&quot;</span><span class="p">,</span> <span class="n">course_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_course_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">course_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Find course details by course name. A course is specified by giving its full name.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `course_id`: ID of the course</span>

<span class="sd">        OUTPUT is a dictionary containing the following keys:</span>

<span class="sd">        * `course_id`: The ID of the course</span>
<span class="sd">        * `archive_id`: The ID of an archive where the course belongs to</span>
<span class="sd">        * `course_code`: Code of course, which used to to identify course in curriculum</span>
<span class="sd">        * `course_name`: Textual name of the course</span>
<span class="sd">        * `description`: Description of course</span>
<span class="sd">        * `teacher_id`: Responsible teacher of the course</span>
<span class="sd">        * `url`: URL address to the course webpage</span>
<span class="sd">        * `credit_points`: Number of total credit points earned from course</span>
<span class="sd">        * `language_id`: Identifies language used in course</span>
<span class="sd">        * `modifier_id`: Creator or last modifie</span>
<span class="sd">        * `last_modified`: Last modified date.</span>

<span class="sd">        If course was not found, None is returned.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the user does not yet exist</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from course WHERE course_name = ?&#39;</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute the SQL query statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_name</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_object</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">get_exam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exam_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get exam details from the database. An exam is specified by giving exam id.</span>

<span class="sd">        INPUT:</span>
<span class="sd">        </span>
<span class="sd">        * `exam_id`: ID of the exam</span>

<span class="sd">        OUTPUT is dictionary containing the following keys:</span>

<span class="sd">        * `course_id`: Course ID of the exam</span>
<span class="sd">        * `examiner_id`: Responsible teacher of the exam</span>
<span class="sd">        * `date`: Date of the exam</span>
<span class="sd">        * `file_attachment`: File attachment id of the PDF file</span>
<span class="sd">        * `language_id`: Language of the course</span>
<span class="sd">        * `modifier_id`: Creator or last modifier</span>
<span class="sd">        * `last_modified`: Last modified date</span>

<span class="sd">        If exam was not found, None is returned.</span>

<span class="sd">        Raises exception ExamDatabaseError if there was an error accessing the database.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="s">&quot;exam&quot;</span><span class="p">,</span> <span class="n">exam_id</span><span class="p">)</span>

    <span class="c"># Remove functions of the database API</span>

    <span class="k">def</span> <span class="nf">remove_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Remove an archive from the database. An archive can be specified by giving archive id. Note: Removing an archive deletes all the courses and all the exams attached to it!</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `archive_id`: ID of the archive to be removed</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * If the archive was successfully deleted True is returned, otherwise False.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
        <span class="n">delete_query</span> <span class="o">=</span> <span class="s">&#39;DELETE FROM archive WHERE archive_id = ?&#39;</span>

        <span class="c"># Connect to the database</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c">#Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
            <span class="c">#Execute the statement to delete</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_id</span><span class="p">,)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">delete_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c">#Check that it has been deleted</span>
            <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">True</span>


    <span class="k">def</span> <span class="nf">remove_course</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">course_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Remove a course from the database. A course is specified by giving course id. Note: Removing a course deletes all the exams attached to it!</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `course_id`: ID of the course</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * If the course successfully deleted True is returned, otherwise False.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
        <span class="n">delete_query</span> <span class="o">=</span> <span class="s">&#39;DELETE FROM course WHERE course_id = ?&#39;</span>

        <span class="c"># Connect to the database</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c">#Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
            <span class="c">#Execute the statement to delete</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_id</span><span class="p">,)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">delete_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c">#Check that it has been deleted</span>
            <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">True</span>


    <span class="k">def</span> <span class="nf">remove_exam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exam_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Remove exam details from the database. An exam is specified by giving exam id. File attachments do not get deleted automatically as they are not part of the database.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `exam_id`: ID of the exam</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * If the exam successfully deleted True is returned, otherwise False.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
        <span class="n">delete_query</span> <span class="o">=</span> <span class="s">&#39;DELETE FROM exam WHERE exam_id = ?&#39;</span>

        <span class="c"># Connect to the database</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c">#Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
            <span class="c">#Execute the statement to delete</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">exam_id</span><span class="p">,)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">delete_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c">#Check that it has been deleted</span>
            <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">True</span>

    <span class="c"># Teacher related functions of database API</span>

    <span class="k">def</span> <span class="nf">create_teacher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">office</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">street_address</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">postal_code</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">city</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">phone</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                       <span class="n">email</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">other_info</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create new teacher entity to the database.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `first_name`: First name (cannot be blank)</span>
<span class="sd">        * `last_name`: Last name (cannot be blank)</span>
<span class="sd">        * `office`: Office information</span>
<span class="sd">        * `street_address`: Street address or P.O.Box</span>
<span class="sd">        * `postal_code`: Postal code</span>
<span class="sd">        * `city`: City</span>
<span class="sd">        * `phone`: Phone number</span>
<span class="sd">        * `email`: Email address</span>
<span class="sd">        * `other_info`: Other contact information</span>
<span class="sd">        * `modifier_id`: Creator or last modifier</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * ID of the new user or None, if there was an error creating new teacher.</span>

<span class="sd">        Raises exception ValueError if first_name or last_name were not given, or if email address was malformed.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Validate the parameters</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">first_name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">last_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;First and last name must be specified for a teacher&quot;</span><span class="p">)</span>

        <span class="c"># Validate the parameters</span>
        <span class="k">if</span> <span class="n">email</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;[^@]+@[^@]+\.[^@]+&quot;</span><span class="p">,</span> <span class="n">email</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Teacher&#39;s email address is malformed&quot;</span><span class="p">)</span>

        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement to create the row in archive table</span>
        <span class="n">sql_insert</span> <span class="o">=</span> <span class="s">&#39;INSERT INTO teacher (first_name, last_name, office, street_address, postal_code, city, phone, &#39;</span> \
                     <span class="s">&#39;email, other_info, modifier_id, last_modified) &#39;</span> \
                     <span class="s">&#39;VALUES (?,?,?,?,?,?,?,?,?,?,?)&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Check that the modifier_id is present in user table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Add the row to archive table by executing the statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">street_address</span><span class="p">,</span> <span class="n">postal_code</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">phone</span><span class="p">,</span>
                      <span class="n">email</span><span class="p">,</span> <span class="n">other_info</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_insert</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">lid</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span>

            <span class="c"># Return the last row&#39;s ID</span>
            <span class="k">return</span> <span class="n">lid</span>

    <span class="k">def</span> <span class="nf">edit_teacher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">office</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">street_address</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">postal_code</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">city</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                     <span class="n">phone</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">other_info</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update teacher details. The teacher is identified by the given teacher ID.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `teacher_id`: The ID of the teacher to be modified.</span>
<span class="sd">        * `first_name`: First name (cannot be blank)</span>
<span class="sd">        * `last_name`: Last name (cannot be blank)</span>
<span class="sd">        * `office`: Office information</span>
<span class="sd">        * `street_address`: Street address or P.O.Box</span>
<span class="sd">        * `postal_code`: Postal code</span>
<span class="sd">        * `city`: City</span>
<span class="sd">        * `phone`: Phone number</span>
<span class="sd">        * `email`: Email address</span>
<span class="sd">        * `other_info`: Other contact information</span>
<span class="sd">        * `modifier_id`: Creator or last modifier</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * ID of the updated message, if the user details were modified successfully or None, if not.</span>

<span class="sd">        Raises exception ExamDatabaseError if there was an error updating the teacher details.</span>
<span class="sd">        Raises exception ValueError if first_name or last_name were not given.</span>
<span class="sd">        ExamDatabaseErrorNotFound if modifier does not exist.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Validate the parameters</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">first_name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">last_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;First and last name must be specified for a teacher&quot;</span><span class="p">)</span>

        <span class="c"># Validate the parameters</span>
        <span class="k">if</span> <span class="n">email</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;[^@]+@[^@]+\.[^@]+&quot;</span><span class="p">,</span> <span class="n">email</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Teacher&#39;s email address is malformed&quot;</span><span class="p">)</span>

        <span class="c"># Create the SQL Statements</span>
        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the archive does exist</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&quot;SELECT teacher_id FROM teacher WHERE teacher_id = ?&quot;</span>

        <span class="n">sql_update</span> <span class="o">=</span> <span class="s">&#39;UPDATE teacher SET first_name = ?, last_name = ?, office = ?, street_address = ?, &#39;</span> \
                     <span class="s">&#39;postal_code = ?, city = ?, phone = ?, email = ?, other_info = ?, modifier_id = ? &#39;</span> \
                     <span class="s">&#39;WHERE teacher_id = ?&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute a query statement to check that the teacher id exists in the database, if not return None</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">teacher_id</span><span class="p">,)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c"># Only one value expected</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="c"># If the teacher row does not exist, return None</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Check that the given modifier_id exists in the user table</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

                <span class="c"># Execute the main update statement</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">street_address</span><span class="p">,</span> <span class="n">postal_code</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">phone</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span>
                          <span class="n">other_info</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_update</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>

                <span class="c"># Check to see that the database was successfully modified, otherwise return None</span>
                <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">None</span>

                <span class="c"># Return taecher id of the updated message</span>
                <span class="k">return</span> <span class="n">teacher_id</span>

    <span class="k">def</span> <span class="nf">browse_teachers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        List all the teachers in the database, or only the first teachers specified by the parameters limit and offset.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `course_id`: the ID of the course</span>
<span class="sd">        * `limit`: the maximum length of the list (-1 means no limit)</span>
<span class="sd">        * `offset`: skip the amount of offset exams from the beginning, offset being the first returned exam</span>
<span class="sd">        (zero means to start from the beginning)</span>
<span class="sd">        * `offset_represents_ids`: if false, the amount of rows specified by the `offset` parameter are skipped</span>
<span class="sd">        (e.g. for paging). If true, only the teachers are returned having teacher_id greater or equal than `offset`.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * A list of exams, if one or more archives were found, empty list otherwise. Each exam in the list is a</span>
<span class="sd">        dictionary containing the same structure as returned by _create_object.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_browse</span><span class="p">(</span><span class="s">&quot;teacher&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_teacher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get teacher details. The teacher is identified by the given teacher ID.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `teacher_id`: The ID of the teacher.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * `teacher_id`: The ID of the teacher to be modified.</span>
<span class="sd">        * `first_name`: First name</span>
<span class="sd">        * `last_name`: Last name</span>
<span class="sd">        * `office`: Office information</span>
<span class="sd">        * `street_address`: Street address or P.O.Box</span>
<span class="sd">        * `postal_code`: Postal code</span>
<span class="sd">        * `city`: City</span>
<span class="sd">        * `phone`: Phone number</span>
<span class="sd">        * `email`: Email address</span>
<span class="sd">        * `other_info`: Other contact information</span>
<span class="sd">        * `modifier_id`: Creator or last modifier</span>
<span class="sd">        * `last_modified`: Date when the teacher entity was last modified.</span>

<span class="sd">        If the teacher was not found with the given ID, None is returned.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="s">&quot;teacher&quot;</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_teacher_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Find teacher details by teacher name. A teacher is specified by giving its full name.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `teacher_id`: ID of the teacher</span>

<span class="sd">        OUTPUT is a dictionary containing the following keys:</span>

<span class="sd">        * `teacher_id`: The ID of the teacher to be modified.</span>
<span class="sd">        * `first_name`: First name</span>
<span class="sd">        * `last_name`: Last name</span>
<span class="sd">        * `office`: Office information</span>
<span class="sd">        * `street_address`: Street address or P.O.Box</span>
<span class="sd">        * `postal_code`: Postal code</span>
<span class="sd">        * `city`: City</span>
<span class="sd">        * `phone`: Phone number</span>
<span class="sd">        * `email`: Email address</span>
<span class="sd">        * `other_info`: Other contact information</span>
<span class="sd">        * `modifier_id`: Creator or last modifier</span>
<span class="sd">        * `last_modified`: Date when the teacher entity was last modified.</span>

<span class="sd">        If teacher was not found, None is returned.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the user does not yet exist</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from teacher WHERE first_name = ? AND last_name = ?&#39;</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute the SQL query statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_object</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">remove_teacher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Remove a teacher from the database.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `teacher_id`: ID of the teacher to be deleted.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * True, if a teacher with the given user_id was found, False otherwise.</span>

<span class="sd">        Returns true, if the delete succeeded, otherwise false if there was an error deleting the teacher from the database.</span>
<span class="sd">        &#39;&#39;&#39;</span>


        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
        <span class="n">delete_query</span> <span class="o">=</span> <span class="s">&#39;DELETE FROM teacher WHERE teacher_id = ?&#39;</span>

        <span class="c"># Connect to the database</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c">#Execute the statement to delete</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">teacher_id</span><span class="p">,)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">delete_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>

            <span class="c">#Check that it has been deleted</span>
            <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">True</span>


    <span class="c"># User handling functions of database API</span>
    <span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">user_type</span><span class="o">=</span><span class="s">&#39;basic&#39;</span><span class="p">,</span> <span class="n">archive_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create new user to database. The user_type can be one of the following:</span>

<span class="sd">        * &#39;basic&#39;: The user has only view access to archive specified by archive_id</span>
<span class="sd">        * &#39;admin&#39;: The user has read-write access to archive specified by archive_id</span>
<span class="sd">        * &#39;super&#39;: The user has read-write access to all the archives in the database.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `username`: Visible username.</span>
<span class="sd">        * `password`: Hashed password of the user.</span>
<span class="sd">        * `user_type`: User type identifies whether the user is superuser, admin or regular view-only user. The user_type must be one of the values &#39;super&#39;, &#39;admin&#39; or &#39;basic&#39;.</span>
<span class="sd">        * `archive_id`: The ID of an archive where the user has access to.</span>
<span class="sd">        * `modifier_id`: The creator or of the user or None if not specified.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * ID of the new user.</span>

<span class="sd">        Raises exception ExamDatabaseErrorExists, if user with the same username already exists, given archive or modifier does not exist.</span>
<span class="sd">        ExamDatabaseErrorNotFound if archive or modifier do not exist.</span>
<span class="sd">        Raises exception ValueError if the user_type was not one of the defined values.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Validation of user type</span>
        <span class="k">if</span> <span class="n">user_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;basic&#39;</span><span class="p">,</span> <span class="s">&#39;admin&#39;</span><span class="p">,</span> <span class="s">&#39;super&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;User type is not basic, admin or super&quot;</span><span class="p">)</span>

        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the user does not yet exist</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from user WHERE username = ?&#39;</span>

        <span class="c"># SQL Statement to create the row in archive table</span>
        <span class="n">sql_insert</span> <span class="o">=</span> <span class="s">&#39;INSERT INTO user (username, password, user_type, archive_id, modifier_id, last_modified) </span><span class="se">\</span>
<span class="s">        VALUES (?,?,?,?,?,?)&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Check that the given archive_id exists in the archive table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;archive&quot;</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Archive does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Check that modifier_id exists in the user table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

            <span class="c"># Execute the statement to find out the username does not exists yet</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">username</span><span class="p">,)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span><span class="s">&quot;The given username already exists&quot;</span><span class="p">)</span>

            <span class="c"># Add the row to archive table by executing the statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">user_type</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_insert</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">lid</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span>
            <span class="c"># Return the last row&#39;s ID</span>
            <span class="k">return</span> <span class="n">lid</span>

    <span class="k">def</span> <span class="nf">edit_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">user_type</span><span class="o">=</span><span class="s">&#39;basic&#39;</span><span class="p">,</span> <span class="n">archive_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update user details. The user is identified by the given user ID.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `user_id`: The ID of the user to be modified.</span>
<span class="sd">        * `username`: Visible username.</span>
<span class="sd">        * `password`: Hashed password of the user.</span>
<span class="sd">        * `user_type`: User type identifies whether the user in superuser, admin or regular view-only user. The user_type must be one of the values &#39;super&#39;, &#39;admin&#39; or &#39;basic&#39;.</span>
<span class="sd">        * `archive_id`: The ID of an archive where the user has access to.</span>
<span class="sd">        * `modifier_id`: The creator or of the user or None if not specified.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * True, if the user details were modified successfully or False, if not.</span>

<span class="sd">        Raises exception ExamDatabaseErrorExists, if user with the same username already exists. Raises exception ExamDatabaseError if there was an error creating new user.</span>
<span class="sd">        ExamDatabaseErrorNotFound if modifier does not exist.</span>
<span class="sd">        Raises exception ValueError if the user_type was not one of the defined values.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># Create the SQL Statements</span>
        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the user does exist</span>
        <span class="n">sql_query1</span> <span class="o">=</span> <span class="s">&quot;SELECT user_id FROM user WHERE user_id = ?&quot;</span>

        <span class="c"># SQL Statement for checking that another user does not yet exist with the same username</span>
        <span class="n">sql_query2</span> <span class="o">=</span> <span class="s">&#39;SELECT * from user WHERE user_id &lt;&gt; ? AND username = ?&#39;</span>

        <span class="c"># Validation of user type</span>
        <span class="k">if</span> <span class="n">user_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;basic&#39;</span><span class="p">,</span><span class="s">&#39;admin&#39;</span><span class="p">,</span><span class="s">&#39;super&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;User type is not basic, admin or super&quot;</span><span class="p">)</span>

        <span class="n">sql_update</span> <span class="o">=</span> <span class="s">&#39;UPDATE user SET user_type = ?, username = ?, password = ?, &#39;</span> \
                     <span class="s">&#39;modifier_id = ?, last_modified = ?, archive_id = ? &#39;</span> \
                     <span class="s">&#39;WHERE user_id = ?&#39;</span>

        <span class="c"># Get current timestamp and format it into ISO string.</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute a query statement to find out whether the user exists in the database</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query1</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c"># Only one value expected</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="c"># If the user does not exist, return None</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Check that the given modifier_id exists in the user table</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="c"># Execute the main update statement</span>
                    <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">user_type</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_update</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">IntegrityError</span><span class="p">:</span>
                    <span class="c"># Expect IntegrityError risen when new username already exists in the database</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span><span class="s">&quot;The given username already exists&quot;</span><span class="p">)</span>

                <span class="c"># Check to see that the database was successfully modified</span>
                <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">None</span>

                <span class="k">return</span> <span class="n">user_id</span>

    <span class="k">def</span> <span class="nf">browse_users</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        List all the users in the database, or only the first users specified by the parameters limit and offset.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `limit`: the maximum length of the list (-1 means no limit)</span>
<span class="sd">        * `offset`: skip the amount of offset users from the beginning, offset being the first returned user</span>
<span class="sd">        (zero means to start from the beginning)</span>
<span class="sd">        * `offset_represents_ids`: if false, the amount of rows specified by the `offset` parameter are skipped</span>
<span class="sd">        (e.g. for paging). If true, only the users are returned having user_id greater or equal than `offset`.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * A list of users, if one or more users were found, empty list otherwise. Each user in the list is a</span>
<span class="sd">        dictionary containing the same structure as returned by get_user.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_browse</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get user details. The user is identified by the given user ID.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `user_id`: The ID of the user.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * `username`: Visible username.</span>
<span class="sd">        * `password`: Hashed password of the user.</span>
<span class="sd">        * `user_type`: User type identifies whether the user in superuser, admin or regular view-only user. The user_type is one of values &#39;super&#39;, &#39;admin&#39; or &#39;basic&#39;.</span>
<span class="sd">        * `archive_id`: The ID of an archive where the user has access to.</span>
<span class="sd">        * `modifier_id`: The creator or of the user or None if not specified.</span>

<span class="sd">        If the user was not found with the given ID, None is returned.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_user_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Find user details by user name.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `user_name`: Visible username</span>

<span class="sd">        OUTPUT is a dictionary containing the following keys:</span>

<span class="sd">        * `user_id`: ID of the user.</span>
<span class="sd">        * `username`: Visible username.</span>
<span class="sd">        * `password`: Hashed password of the user.</span>
<span class="sd">        * `user_type`: User type identifies whether the user in superuser, admin or regular view-only user. The user_type is one of values &#39;super&#39;, &#39;admin&#39; or &#39;basic&#39;.</span>
<span class="sd">        * `archive_id`: The ID of an archive where the user has access to.</span>
<span class="sd">        * `modifier_id`: The creator or of the user or None if not specified.</span>

<span class="sd">        If user was not found, None is returned.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the user does not yet exist</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from user WHERE username = ?&#39;</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute the SQL query statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_object</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">authorize_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check if a user can be authorized with a given username and password.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `username`: Visible username.</span>
<span class="sd">        * `password`: Hashed password of the user.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * If the username and password were correct, user ID is returned, otherwise None.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement for checking that the user does not yet exist</span>
        <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT user_id from user WHERE username = ? AND password = ?&#39;</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute the SQL query statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;user_id&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">user_has_access</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check whether a user has access to a specified archive. The user is identified by the given user ID and archive by the given archive ID.</span>

<span class="sd">        INPUT:</span>
<span class="sd">        * `user_id`: The ID of the user.</span>
<span class="sd">        * `archive_id`: The ID of the archive.</span>
<span class="sd">        * `identification_needed`: Identification to the archive needed, true or false</span>

<span class="sd">        OUTPUT:</span>
<span class="sd">        * If the user is authorized to access the given archive, True is returned, otherwise False is returned. False is returned also, if the given user_id or archive_id does not exist. If the user is a superuser and an archive exists, True is always returned.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c"># SQL Statement for activating foreign keys</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>

        <span class="c"># SQL Statement fr checking that is the user an superuser</span>
        <span class="n">sql_query1</span> <span class="o">=</span> <span class="s">&#39;SELECT user_type FROM user WHERE user_id = ?&#39;</span>

        <span class="c"># Connect to the database and get a connection object</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c"># Execute the SQL query statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query1</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="c"># If user is an superuser, just continue</span>
            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;user_type&#39;</span><span class="p">]</span>  <span class="o">==</span> <span class="s">&#39;super&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="c"># If user is not an superuser, continue with identification</span>
            <span class="k">else</span><span class="p">:</span>
                 <span class="c"># SQL Statement for checking that is identification to the archive needed</span>
                <span class="n">sql_query2</span> <span class="o">=</span> <span class="s">&#39;SELECT identification_needed FROM archive WHERE archive_id = ?&#39;</span>

                <span class="c"># Connect to the database and get a connection object</span>
                <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
                <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
                    <span class="c"># Cursor and row initialization</span>
                    <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
                    <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
                    <span class="c"># Provide support for foreign keys</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

                    <span class="c"># Execute the SQL query statement</span>
                    <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_id</span><span class="p">,)</span>
                    <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query2</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

                    <span class="c"># If user has access, continue with True</span>
                    <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">False</span>

                    <span class="c"># If identification to the archive is needed, identify the user</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;identification_needed&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>

                        <span class="c"># SQL Statement for checking user&#39;s access to the archive</span>
                        <span class="n">sql_query3</span> <span class="o">=</span> <span class="s">&#39;SELECT user_id, archive_id FROM user WHERE user_id = ? AND archive_id = ?&#39;</span>

                        <span class="c"># Connect to the database and get a connection object</span>
                        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
                        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
                            <span class="c"># Cursor and row initialization</span>
                            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
                            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
                            <span class="c"># Provide support for foreign keys</span>
                            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

                            <span class="c"># Execute the SQL query statement</span>
                            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">)</span>
                            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query3</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
                            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

                            <span class="c"># If user has access, continue with True</span>
                            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                                <span class="k">return</span> <span class="bp">True</span>
                            <span class="c"># Else False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">return</span> <span class="bp">False</span>

                    <span class="c"># If identification is not needed, just continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">remove_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Remove user from the database.</span>

<span class="sd">        INPUT:</span>

<span class="sd">        * `user_id`: ID of the user to be deleted.</span>

<span class="sd">        OUTPUT:</span>

<span class="sd">        * True, if a user with the given user_id was removed, False otherwise.</span>

<span class="sd">        Returns true, if the delete succeeded, otherwise false if there was an error deleting the user from the database.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
        <span class="n">delete_query</span> <span class="o">=</span> <span class="s">&#39;DELETE FROM user WHERE user_id = ?&#39;</span>

        <span class="c"># Connect to the database</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
            <span class="c"># Cursor and row initialization</span>
            <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
            <span class="c"># Provide support for foreign keys</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>

            <span class="c">#Execute the statement to delete</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">delete_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>

            <span class="c">#Check that it has been deleted</span>
            <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">return</span> <span class="bp">True</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#exam_archive.ExamArchiveDatabase">ExamArchiveDatabase</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, db_path=None)</p>
    </div>
    

    
  
    <div class="desc"><p>db_path is the address of the path with respect to the calling script.
If db_path is None, DEFAULT_DB_PATH is used instead.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.__init__', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.__init__" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    db_path is the address of the path with respect to the calling script.</span>
<span class="sd">    If db_path is None, DEFAULT_DB_PATH is used instead.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">ExamArchiveDatabase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">db_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_path</span> <span class="o">=</span> <span class="n">db_path</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_path</span> <span class="o">=</span> <span class="n">DEFAULT_DB_PATH</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.authorize_user">
    <p>def <span class="ident">authorize_user</span>(</p><p>self, username, password)</p>
    </div>
    

    
  
    <div class="desc"><p>Check if a user can be authorized with a given username and password.</p>
<p>INPUT:</p>
<ul>
<li><code>username</code>: Visible username.</li>
<li><code>password</code>: Hashed password of the user.</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>If the username and password were correct, user ID is returned, otherwise None.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.authorize_user', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.authorize_user" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">authorize_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Check if a user can be authorized with a given username and password.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `username`: Visible username.</span>
<span class="sd">    * `password`: Hashed password of the user.</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * If the username and password were correct, user ID is returned, otherwise None.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># SQL Statement for activating foreign keys</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="c"># SQL Statement for checking that the user does not yet exist</span>
    <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT user_id from user WHERE username = ? AND password = ?&#39;</span>
    <span class="c"># Connect to the database and get a connection object</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c"># Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c"># Execute the SQL query statement</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;user_id&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.browse_archives">
    <p>def <span class="ident">browse_archives</span>(</p><p>self, limit=-1, offset=0, offset_represents_ids=False)</p>
    </div>
    

    
  
    <div class="desc"><p>List all the archives in the database, or only the first archives specified by the parameters limit and offset.</p>
<p>INPUT:</p>
<ul>
<li><code>limit</code>: the maximum length of the list (-1 means no limit)</li>
<li><code>offset</code>: skip the amount of offset archives from the beginning, offset being the first returned archive
(zero means to start from the beginning)</li>
<li><code>offset_represents_ids</code>: if false, the amount of rows specified by the <code>offset</code> parameter are skipped
(e.g. for paging). If true, only the archives are returned having archive_id greater or equal than <code>offset</code>.</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>A list of archives, if one or more archives were found, empty list otherwise. Each archive in the list is a
dictionary containing the same structure as returned by get_archive.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.browse_archives', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.browse_archives" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">browse_archives</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    List all the archives in the database, or only the first archives specified by the parameters limit and offset.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `limit`: the maximum length of the list (-1 means no limit)</span>
<span class="sd">    * `offset`: skip the amount of offset archives from the beginning, offset being the first returned archive</span>
<span class="sd">    (zero means to start from the beginning)</span>
<span class="sd">    * `offset_represents_ids`: if false, the amount of rows specified by the `offset` parameter are skipped</span>
<span class="sd">    (e.g. for paging). If true, only the archives are returned having archive_id greater or equal than `offset`.</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * A list of archives, if one or more archives were found, empty list otherwise. Each archive in the list is a</span>
<span class="sd">    dictionary containing the same structure as returned by get_archive.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_browse</span><span class="p">(</span><span class="s">&quot;archive&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.browse_courses">
    <p>def <span class="ident">browse_courses</span>(</p><p>self, archive_id, limit=-1, offset=0, offset_represents_ids=False)</p>
    </div>
    

    
  
    <div class="desc"><p>List all the course in an archive, or only the first courses specified by the parameters limit and offset.</p>
<p>INPUT:</p>
<ul>
<li><code>archive_id</code>: The ID of an archive</li>
<li><code>limit</code>: the maximum length of the list (-1 means no limit)</li>
<li><code>offset</code>: skip the amount of offset courses from the beginning, offset being the first returned course
(zero means to start from the beginning)</li>
<li><code>offset_represents_ids</code>: if false, the amount of rows specified by the <code>offset</code> parameter are skipped
(e.g. for paging). If true, only the courses are returned having course_id greater or equal than <code>offset</code>.</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>A list of courses, if one or more archives were found, empty list otherwise. Each course in the list is a
dictionary containing the same structure as returned by get_course.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.browse_courses', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.browse_courses" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">browse_courses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    List all the course in an archive, or only the first courses specified by the parameters limit and offset.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `archive_id`: The ID of an archive</span>
<span class="sd">    * `limit`: the maximum length of the list (-1 means no limit)</span>
<span class="sd">    * `offset`: skip the amount of offset courses from the beginning, offset being the first returned course</span>
<span class="sd">    (zero means to start from the beginning)</span>
<span class="sd">    * `offset_represents_ids`: if false, the amount of rows specified by the `offset` parameter are skipped</span>
<span class="sd">    (e.g. for paging). If true, only the courses are returned having course_id greater or equal than `offset`.</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * A list of courses, if one or more archives were found, empty list otherwise. Each course in the list is a</span>
<span class="sd">    dictionary containing the same structure as returned by get_course.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_browse</span><span class="p">(</span><span class="s">&quot;course&quot;</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.browse_exams">
    <p>def <span class="ident">browse_exams</span>(</p><p>self, course_id, limit=-1, offset=0, offset_represents_ids=False)</p>
    </div>
    

    
  
    <div class="desc"><p>List all the exams of a course, or only the first exams specified by the parameters limit and offset.</p>
<p>INPUT:</p>
<ul>
<li><code>course_id</code>: the ID of the course</li>
<li><code>limit</code>: the maximum length of the list (-1 means no limit)</li>
<li><code>offset</code>: skip the amount of offset exams from the beginning, offset being the first returned exam
(zero means to start from the beginning)</li>
<li><code>offset_represents_ids</code>: if false, the amount of rows specified by the <code>offset</code> parameter are skipped
(e.g. for paging). If true, only the exams are returned having exam_id greater or equal than <code>offset</code>.</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>A list of exams, if one or more archives were found, empty list otherwise. Each exam in the list is a
dictionary containing the same structure as returned by get_exam.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.browse_exams', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.browse_exams" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">browse_exams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">course_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    List all the exams of a course, or only the first exams specified by the parameters limit and offset.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `course_id`: the ID of the course</span>
<span class="sd">    * `limit`: the maximum length of the list (-1 means no limit)</span>
<span class="sd">    * `offset`: skip the amount of offset exams from the beginning, offset being the first returned exam</span>
<span class="sd">    (zero means to start from the beginning)</span>
<span class="sd">    * `offset_represents_ids`: if false, the amount of rows specified by the `offset` parameter are skipped</span>
<span class="sd">    (e.g. for paging). If true, only the exams are returned having exam_id greater or equal than `offset`.</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * A list of exams, if one or more archives were found, empty list otherwise. Each exam in the list is a</span>
<span class="sd">    dictionary containing the same structure as returned by get_exam.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_browse</span><span class="p">(</span><span class="s">&quot;exam&quot;</span><span class="p">,</span> <span class="n">course_id</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.browse_teachers">
    <p>def <span class="ident">browse_teachers</span>(</p><p>self, limit=-1, offset=0, offset_represents_ids=False)</p>
    </div>
    

    
  
    <div class="desc"><p>List all the teachers in the database, or only the first teachers specified by the parameters limit and offset.</p>
<p>INPUT:</p>
<ul>
<li><code>course_id</code>: the ID of the course</li>
<li><code>limit</code>: the maximum length of the list (-1 means no limit)</li>
<li><code>offset</code>: skip the amount of offset exams from the beginning, offset being the first returned exam
(zero means to start from the beginning)</li>
<li><code>offset_represents_ids</code>: if false, the amount of rows specified by the <code>offset</code> parameter are skipped
(e.g. for paging). If true, only the teachers are returned having teacher_id greater or equal than <code>offset</code>.</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>A list of exams, if one or more archives were found, empty list otherwise. Each exam in the list is a
dictionary containing the same structure as returned by _create_object.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.browse_teachers', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.browse_teachers" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">browse_teachers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    List all the teachers in the database, or only the first teachers specified by the parameters limit and offset.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `course_id`: the ID of the course</span>
<span class="sd">    * `limit`: the maximum length of the list (-1 means no limit)</span>
<span class="sd">    * `offset`: skip the amount of offset exams from the beginning, offset being the first returned exam</span>
<span class="sd">    (zero means to start from the beginning)</span>
<span class="sd">    * `offset_represents_ids`: if false, the amount of rows specified by the `offset` parameter are skipped</span>
<span class="sd">    (e.g. for paging). If true, only the teachers are returned having teacher_id greater or equal than `offset`.</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * A list of exams, if one or more archives were found, empty list otherwise. Each exam in the list is a</span>
<span class="sd">    dictionary containing the same structure as returned by _create_object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_browse</span><span class="p">(</span><span class="s">&quot;teacher&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.browse_users">
    <p>def <span class="ident">browse_users</span>(</p><p>self, limit=-1, offset=0, offset_represents_ids=False)</p>
    </div>
    

    
  
    <div class="desc"><p>List all the users in the database, or only the first users specified by the parameters limit and offset.</p>
<p>INPUT:</p>
<ul>
<li><code>limit</code>: the maximum length of the list (-1 means no limit)</li>
<li><code>offset</code>: skip the amount of offset users from the beginning, offset being the first returned user
(zero means to start from the beginning)</li>
<li><code>offset_represents_ids</code>: if false, the amount of rows specified by the <code>offset</code> parameter are skipped
(e.g. for paging). If true, only the users are returned having user_id greater or equal than <code>offset</code>.</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>A list of users, if one or more users were found, empty list otherwise. Each user in the list is a
dictionary containing the same structure as returned by get_user.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.browse_users', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.browse_users" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">browse_users</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    List all the users in the database, or only the first users specified by the parameters limit and offset.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `limit`: the maximum length of the list (-1 means no limit)</span>
<span class="sd">    * `offset`: skip the amount of offset users from the beginning, offset being the first returned user</span>
<span class="sd">    (zero means to start from the beginning)</span>
<span class="sd">    * `offset_represents_ids`: if false, the amount of rows specified by the `offset` parameter are skipped</span>
<span class="sd">    (e.g. for paging). If true, only the users are returned having user_id greater or equal than `offset`.</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * A list of users, if one or more users were found, empty list otherwise. Each user in the list is a</span>
<span class="sd">    dictionary containing the same structure as returned by get_user.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_browse</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">offset_represents_ids</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.clean">
    <p>def <span class="ident">clean</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Purge the database removing old values.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.clean', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.clean" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Purge the database removing old values.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.create_archive">
    <p>def <span class="ident">create_archive</span>(</p><p>self, archive_name, organisation_name, identification_needed=False, modifier_id=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Create new exam archive to database. An archive is specific to certain 
faculty or department, for example "Blanko" for Information Processing
Science faculty of Oulu University.</p>
<p>INPUT:</p>
<ul>
<li><code>archive_name</code>: The name of the archive to be created.</li>
<li><code>organisation_name</code>: The name of the organisation, such as faculty, department or school, owning the archive.</li>
<li><code>identification_needed</code>:  Whether authorization is required from basic users to view exams.</li>
<li><code>modifier_id</code>: The creator or last modifier of the archive or None if not specified.</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>ID of the new archive, if the archive was created successfully, None otherwise.</li>
</ul>
<p>Raises exception ExamDatabaseErrorExists, if the an archive already exists with the given name.
Raises exception ExamDatabaseErrorNotFound, if given modifier was not found.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.create_archive', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.create_archive" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">create_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_name</span><span class="p">,</span> <span class="n">organisation_name</span><span class="p">,</span> <span class="n">identification_needed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create new exam archive to database. An archive is specific to certain </span>
<span class="sd">    faculty or department, for example &quot;Blanko&quot; for Information Processing</span>
<span class="sd">    Science faculty of Oulu University.</span>
<span class="sd">    </span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `archive_name`: The name of the archive to be created.</span>
<span class="sd">    * `organisation_name`: The name of the organisation, such as faculty, department or school, owning the archive.</span>
<span class="sd">    * `identification_needed`:  Whether authorization is required from basic users to view exams.</span>
<span class="sd">    * `modifier_id`: The creator or last modifier of the archive or None if not specified.</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * ID of the new archive, if the archive was created successfully, None otherwise.</span>
<span class="sd">    Raises exception ExamDatabaseErrorExists, if the an archive already exists with the given name.</span>
<span class="sd">    Raises exception ExamDatabaseErrorNotFound, if given modifier was not found.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># SQL Statement for activating foreign keys</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="c"># SQL Statement for checking that the archive does not yet exist</span>
    <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from archive WHERE archive_name = ? AND organisation_name = ?&#39;</span>
    <span class="c"># SQL Statement to create the row in archive table</span>
    <span class="n">sql_insert</span> <span class="o">=</span> <span class="s">&#39;INSERT INTO archive (archive_name, organisation_name, identification_needed, modifier_id, last_modified) </span><span class="se">\</span>
<span class="s">    VALUES (?,?,?,?,?)&#39;</span>
    <span class="c"># Get current timestamp and format it into ISO string.</span>
    <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
    <span class="c"># Connect to the database and get a connection object</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c"># Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c"># Check that the modifier_id is present in user table</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>
        <span class="c"># Execute the statement to find out the archive does not yet exist</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_name</span><span class="p">,</span> <span class="n">organisation_name</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span>
                <span class="s">&quot;Archive already has an entry with the same organisation and archive name&quot;</span><span class="p">)</span>
        <span class="c"># Add the row to archive table by executing the statement</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_name</span><span class="p">,</span> <span class="n">organisation_name</span><span class="p">,</span> <span class="n">identification_needed</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_insert</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="n">lid</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span>
        <span class="c"># Return the last row&#39;s ID</span>
        <span class="k">return</span> <span class="n">lid</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.create_course">
    <p>def <span class="ident">create_course</span>(</p><p>self, archive_id, course_code, course_name, description, teacher_id, url, credit_points, language_id, modifier_id=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Create an course to the archive. Archive can include multiple courses under same name and other information,
but there can't be be two courses with same name and language.</p>
<p>INPUT:</p>
<ul>
<li><code>archive_id</code>: ID of the archive where the course belongs to.</li>
<li><code>course_code</code>: Code of the course, which is used to identify course for in curriculum.</li>
<li><code>course_name</code>: Textual name of the course to be created.</li>
<li><code>description</code>: Description of the course.</li>
<li><code>teacher_id</code>: ID of the teacher, lecturer or other responsible person of the course.</li>
<li><code>url</code>: Course home page URL.</li>
<li><code>credit_points</code>: Amount of credit points, that can be earned from the course.</li>
<li><code>language_id</code>: Language identifier of the language used in the course.</li>
<li><code>modifier_id</code>: The creator or last modifier of the course or None if not specified.</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>ID of the new course entity, if the course was created successfully, None otherwise.</li>
</ul>
<p>Raises exception ExamDatabaseErrorExists, if course with given course_name and language_id combination already exists.
Raises ExamDatabaseErrorNotFound if given archive, teacher, language or modifier were not found in the database.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.create_course', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.create_course" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">create_course</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">,</span> <span class="n">course_code</span><span class="p">,</span> <span class="n">course_name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">credit_points</span><span class="p">,</span>
                  <span class="n">language_id</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create an course to the archive. Archive can include multiple courses under same name and other information,</span>
<span class="sd">    but there can&#39;t be be two courses with same name and language.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    </span>
<span class="sd">    * `archive_id`: ID of the archive where the course belongs to.</span>
<span class="sd">    * `course_code`: Code of the course, which is used to identify course for in curriculum.</span>
<span class="sd">    * `course_name`: Textual name of the course to be created.</span>
<span class="sd">    * `description`: Description of the course.</span>
<span class="sd">    * `teacher_id`: ID of the teacher, lecturer or other responsible person of the course.</span>
<span class="sd">    * `url`: Course home page URL.</span>
<span class="sd">    * `credit_points`: Amount of credit points, that can be earned from the course.</span>
<span class="sd">    * `language_id`: Language identifier of the language used in the course.</span>
<span class="sd">    * `modifier_id`: The creator or last modifier of the course or None if not specified.</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * ID of the new course entity, if the course was created successfully, None otherwise.</span>
<span class="sd">    Raises exception ExamDatabaseErrorExists, if course with given course_name and language_id combination already exists.</span>
<span class="sd">    Raises ExamDatabaseErrorNotFound if given archive, teacher, language or modifier were not found in the database.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># SQL Statement for activating foreign keys</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="c"># SQL Statement for checking that the course does not yet exist</span>
    <span class="n">sql_course_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from course WHERE course_name = ? AND language_id = ?&#39;</span>
    <span class="c"># SQL Statement to create the row in archive table</span>
    <span class="n">sql_insert</span> <span class="o">=</span> <span class="s">&#39;INSERT INTO course (archive_id, course_code, course_name, description, teacher_id, url, &#39;</span> \
                 <span class="s">&#39;credit_points, language_id, modifier_id, last_modified) &#39;</span> \
                 <span class="s">&#39;VALUES (?,?,?,?,?,?,?,?,?,?)&#39;</span>
    <span class="c"># Get current timestamp and format it into ISO string.</span>
    <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
    <span class="c"># Connect to the database and get a connection object</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c"># Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c"># Check that the given user_id exists in the user table</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>
        <span class="c"># Check that the given teacher_id exists in the teacher table</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;teacher&quot;</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Teacher does not exist&quot;</span><span class="p">)</span>
        <span class="c"># Check that the given archive_id exists in the archive table</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;archive&quot;</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Archive does not exist&quot;</span><span class="p">)</span>
        <span class="c"># Check that the given language_id exists in the language table</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;language&quot;</span><span class="p">,</span> <span class="n">language_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Language does not exist&quot;</span><span class="p">)</span>
        <span class="c"># Execute the statement to find out the archive does not yet exist</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_name</span><span class="p">,</span> <span class="n">language_id</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_course_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span><span class="s">&quot;Course already exists with the same name and language&quot;</span><span class="p">)</span>
        <span class="c"># Add the row to archive table by executing the statement</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">archive_id</span><span class="p">,</span> <span class="n">course_code</span><span class="p">,</span> <span class="n">course_name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">credit_points</span><span class="p">,</span> <span class="n">language_id</span><span class="p">,</span>
            <span class="n">modifier_id</span><span class="p">,</span>
            <span class="n">last_modified</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_insert</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="n">lid</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span>
        <span class="c"># Return the last row&#39;s ID</span>
        <span class="k">return</span> <span class="n">lid</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.create_exam">
    <p>def <span class="ident">create_exam</span>(</p><p>self, course_id, examiner_id, date, file_attachment, language_id=&#39;fi&#39;, modifier_id=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Create an exam and attach it to the given course. A course can be specified by giving either course name or
course code.</p>
<p>INPUT:</p>
<ul>
<li><code>course_id</code>: The idenfier of the course, where the exam belongs to</li>
<li><code>examiner_id</code>: ID of the teacher, lecturer or other person responsible of overseeing the exam.</li>
<li><code>date</code>: Date of the exam given in format of YYYY-MM-DD.</li>
<li><code>file_attachment</code>: Identifier for the file attachment.</li>
<li><code>language_id</code>: Language identifier for the exam.</li>
<li><code>modifier_id</code>: The creator or last modifier of the exam or None if not specified.</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>ID of the new exam entity, if the exam was created successfully, None otherwise.</li>
</ul>
<p>Raises exception ExamDatabaseErrorExists, if the an exam already exists with the given date and course,
Raises exception ExamDatabaseErrorNotFound if course, examiner, language or modifier does not exist.
Raises exception ValueError if the date is not given in format of YYYY-MM-DD.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.create_exam', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.create_exam" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">create_exam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">course_id</span><span class="p">,</span> <span class="n">examiner_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">file_attachment</span><span class="p">,</span> <span class="n">language_id</span><span class="o">=</span><span class="s">&#39;fi&#39;</span><span class="p">,</span>
                <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create an exam and attach it to the given course. A course can be specified by giving either course name or</span>
<span class="sd">    course code.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `course_id`: The idenfier of the course, where the exam belongs to</span>
<span class="sd">    * `examiner_id`: ID of the teacher, lecturer or other person responsible of overseeing the exam.</span>
<span class="sd">    * `date`: Date of the exam given in format of YYYY-MM-DD.</span>
<span class="sd">    * `file_attachment`: Identifier for the file attachment.</span>
<span class="sd">    * `language_id`: Language identifier for the exam.</span>
<span class="sd">    * `modifier_id`: The creator or last modifier of the exam or None if not specified.</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * ID of the new exam entity, if the exam was created successfully, None otherwise.</span>
<span class="sd">    Raises exception ExamDatabaseErrorExists, if the an exam already exists with the given date and course,</span>
<span class="sd">    Raises exception ExamDatabaseErrorNotFound if course, examiner, language or modifier does not exist.</span>
<span class="sd">    Raises exception ValueError if the date is not given in format of YYYY-MM-DD.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># Check that the given date string is in valid date format</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="s">&#39;YYYY-MM-DD&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;YYYY-MM-DD&#39;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Date must be in format &quot;YYYY-MM-DD&quot;&#39;</span><span class="p">)</span>
    <span class="c"># SQL Statement for activating foreign keys</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="c"># SQL Statement for checking that the exam does not yet exist</span>
    <span class="n">sql_course_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from exam WHERE course_id = ? AND date = ?&#39;</span>
    <span class="c"># SQL Statement to create the row in archive table</span>
    <span class="n">sql_insert</span> <span class="o">=</span> <span class="s">&#39;INSERT INTO exam (course_id, examiner_id, date, file_attachment, language_id, &#39;</span> \
                 <span class="s">&#39;modifier_id, last_modified)&#39;</span> \
                 <span class="s">&#39;VALUES (?,?,?,?,?,?,?)&#39;</span>
    <span class="c"># Get current timestamp and format it into ISO string.</span>
    <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
    <span class="c"># Connect to the database and get a connection object</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c"># Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c"># Check that the given course_id exists in the course table</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;course&quot;</span><span class="p">,</span> <span class="n">course_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Course does not exist&quot;</span><span class="p">)</span>
        <span class="c"># Check that the given user_id exists in the user table</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>
        <span class="c"># Check that the given examiner_id exists in the teacher table</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;teacher&quot;</span><span class="p">,</span> <span class="n">examiner_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Examiner does not exist&quot;</span><span class="p">)</span>
        <span class="c"># Check that the given language_id exists in the language table</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;language&quot;</span><span class="p">,</span> <span class="n">language_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Language does not exist&quot;</span><span class="p">)</span>
        <span class="c"># Execute the statement to find out the archive does not yet exist</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_id</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_course_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span><span class="s">&quot;Exam already exists within the same course and date&quot;</span><span class="p">)</span>
        <span class="c"># Add the row to archive table by executing the statement</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_id</span><span class="p">,</span> <span class="n">examiner_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">file_attachment</span><span class="p">,</span> <span class="n">language_id</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_insert</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="n">lid</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span>
        <span class="c"># Return the last row&#39;s ID</span>
        <span class="k">return</span> <span class="n">lid</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.create_tables_from_schema">
    <p>def <span class="ident">create_tables_from_schema</span>(</p><p>self, schema=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Create programmatically the tables from a schema file.
schema contains the path to the .sql schema file. If it is None,<br />
DEFAULT_SCHEMA is used instead.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.create_tables_from_schema', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.create_tables_from_schema" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">create_tables_from_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create programmatically the tables from a schema file.</span>
<span class="sd">    schema contains the path to the .sql schema file. If it is None,  </span>
<span class="sd">    DEFAULT_SCHEMA is used instead. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">schema</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">DEFAULT_SCHEMA</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.create_teacher">
    <p>def <span class="ident">create_teacher</span>(</p><p>self, first_name, last_name, office=&#39;&#39;, street_address=&#39;&#39;, postal_code=&#39;&#39;, city=&#39;&#39;, phone=&#39;&#39;, email=&#39;&#39;, other_info=&#39;&#39;, modifier_id=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Create new teacher entity to the database.</p>
<p>INPUT:</p>
<ul>
<li><code>first_name</code>: First name (cannot be blank)</li>
<li><code>last_name</code>: Last name (cannot be blank)</li>
<li><code>office</code>: Office information</li>
<li><code>street_address</code>: Street address or P.O.Box</li>
<li><code>postal_code</code>: Postal code</li>
<li><code>city</code>: City</li>
<li><code>phone</code>: Phone number</li>
<li><code>email</code>: Email address</li>
<li><code>other_info</code>: Other contact information</li>
<li><code>modifier_id</code>: Creator or last modifier</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>ID of the new user or None, if there was an error creating new teacher.</li>
</ul>
<p>Raises exception ValueError if first_name or last_name were not given, or if email address was malformed.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.create_teacher', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.create_teacher" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">create_teacher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">office</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">street_address</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">postal_code</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">city</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">phone</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                   <span class="n">email</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">other_info</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create new teacher entity to the database.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `first_name`: First name (cannot be blank)</span>
<span class="sd">    * `last_name`: Last name (cannot be blank)</span>
<span class="sd">    * `office`: Office information</span>
<span class="sd">    * `street_address`: Street address or P.O.Box</span>
<span class="sd">    * `postal_code`: Postal code</span>
<span class="sd">    * `city`: City</span>
<span class="sd">    * `phone`: Phone number</span>
<span class="sd">    * `email`: Email address</span>
<span class="sd">    * `other_info`: Other contact information</span>
<span class="sd">    * `modifier_id`: Creator or last modifier</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * ID of the new user or None, if there was an error creating new teacher.</span>
<span class="sd">    Raises exception ValueError if first_name or last_name were not given, or if email address was malformed.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># Validate the parameters</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">first_name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">last_name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;First and last name must be specified for a teacher&quot;</span><span class="p">)</span>
    <span class="c"># Validate the parameters</span>
    <span class="k">if</span> <span class="n">email</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;[^@]+@[^@]+\.[^@]+&quot;</span><span class="p">,</span> <span class="n">email</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Teacher&#39;s email address is malformed&quot;</span><span class="p">)</span>
    <span class="c"># SQL Statement for activating foreign keys</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="c"># SQL Statement to create the row in archive table</span>
    <span class="n">sql_insert</span> <span class="o">=</span> <span class="s">&#39;INSERT INTO teacher (first_name, last_name, office, street_address, postal_code, city, phone, &#39;</span> \
                 <span class="s">&#39;email, other_info, modifier_id, last_modified) &#39;</span> \
                 <span class="s">&#39;VALUES (?,?,?,?,?,?,?,?,?,?,?)&#39;</span>
    <span class="c"># Get current timestamp and format it into ISO string.</span>
    <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
    <span class="c"># Connect to the database and get a connection object</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c"># Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c"># Check that the modifier_id is present in user table</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>
        <span class="c"># Add the row to archive table by executing the statement</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">street_address</span><span class="p">,</span> <span class="n">postal_code</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">phone</span><span class="p">,</span>
                  <span class="n">email</span><span class="p">,</span> <span class="n">other_info</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_insert</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="n">lid</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span>
        <span class="c"># Return the last row&#39;s ID</span>
        <span class="k">return</span> <span class="n">lid</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.create_user">
    <p>def <span class="ident">create_user</span>(</p><p>self, username, password, user_type=&#39;basic&#39;, archive_id=None, modifier_id=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Create new user to database. The user_type can be one of the following:</p>
<ul>
<li>'basic': The user has only view access to archive specified by archive_id</li>
<li>'admin': The user has read-write access to archive specified by archive_id</li>
<li>'super': The user has read-write access to all the archives in the database.</li>
</ul>
<p>INPUT:</p>
<ul>
<li><code>username</code>: Visible username.</li>
<li><code>password</code>: Hashed password of the user.</li>
<li><code>user_type</code>: User type identifies whether the user is superuser, admin or regular view-only user. The user_type must be one of the values 'super', 'admin' or 'basic'.</li>
<li><code>archive_id</code>: The ID of an archive where the user has access to.</li>
<li><code>modifier_id</code>: The creator or of the user or None if not specified.</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>ID of the new user.</li>
</ul>
<p>Raises exception ExamDatabaseErrorExists, if user with the same username already exists, given archive or modifier does not exist.
ExamDatabaseErrorNotFound if archive or modifier do not exist.
Raises exception ValueError if the user_type was not one of the defined values.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.create_user', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.create_user" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">user_type</span><span class="o">=</span><span class="s">&#39;basic&#39;</span><span class="p">,</span> <span class="n">archive_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create new user to database. The user_type can be one of the following:</span>
<span class="sd">    * &#39;basic&#39;: The user has only view access to archive specified by archive_id</span>
<span class="sd">    * &#39;admin&#39;: The user has read-write access to archive specified by archive_id</span>
<span class="sd">    * &#39;super&#39;: The user has read-write access to all the archives in the database.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `username`: Visible username.</span>
<span class="sd">    * `password`: Hashed password of the user.</span>
<span class="sd">    * `user_type`: User type identifies whether the user is superuser, admin or regular view-only user. The user_type must be one of the values &#39;super&#39;, &#39;admin&#39; or &#39;basic&#39;.</span>
<span class="sd">    * `archive_id`: The ID of an archive where the user has access to.</span>
<span class="sd">    * `modifier_id`: The creator or of the user or None if not specified.</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * ID of the new user.</span>
<span class="sd">    Raises exception ExamDatabaseErrorExists, if user with the same username already exists, given archive or modifier does not exist.</span>
<span class="sd">    ExamDatabaseErrorNotFound if archive or modifier do not exist.</span>
<span class="sd">    Raises exception ValueError if the user_type was not one of the defined values.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># Validation of user type</span>
    <span class="k">if</span> <span class="n">user_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;basic&#39;</span><span class="p">,</span> <span class="s">&#39;admin&#39;</span><span class="p">,</span> <span class="s">&#39;super&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;User type is not basic, admin or super&quot;</span><span class="p">)</span>
    <span class="c"># SQL Statement for activating foreign keys</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="c"># SQL Statement for checking that the user does not yet exist</span>
    <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from user WHERE username = ?&#39;</span>
    <span class="c"># SQL Statement to create the row in archive table</span>
    <span class="n">sql_insert</span> <span class="o">=</span> <span class="s">&#39;INSERT INTO user (username, password, user_type, archive_id, modifier_id, last_modified) </span><span class="se">\</span>
<span class="s">    VALUES (?,?,?,?,?,?)&#39;</span>
    <span class="c"># Get current timestamp and format it into ISO string.</span>
    <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
    <span class="c"># Connect to the database and get a connection object</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c"># Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c"># Check that the given archive_id exists in the archive table</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;archive&quot;</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Archive does not exist&quot;</span><span class="p">)</span>
        <span class="c"># Check that modifier_id exists in the user table</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>
        <span class="c"># Execute the statement to find out the username does not exists yet</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">username</span><span class="p">,)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span><span class="s">&quot;The given username already exists&quot;</span><span class="p">)</span>
        <span class="c"># Add the row to archive table by executing the statement</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">user_type</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_insert</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="n">lid</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">lastrowid</span>
        <span class="c"># Return the last row&#39;s ID</span>
        <span class="k">return</span> <span class="n">lid</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.edit_archive">
    <p>def <span class="ident">edit_archive</span>(</p><p>self, archive_id, archive_name, organisation_name, identification_needed=False, modifier_id=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Update an archive in the database. An archive can be specified by giving archive id.</p>
<p>INPUT:</p>
<ul>
<li><code>archive_id</code>: ID of the archive to be updated</li>
<li><code>archive_name</code>: The name of the archive to be edited.</li>
<li><code>organisation_name</code>: The name of the organisation, such as faculty, department or school, owning the archive.</li>
<li><code>identification_needed</code>:  Whether authorization is required from basic users to view archive.</li>
<li><code>modifier_id</code>: The creator or last modifier of the archive or None if not specified.</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>ID of the archive, if the archive was edited successfully and None if the archive did not exist or there was
an error updating the database.</li>
</ul>
<p>Raises exception ExamDatabaseErrorExists, if the an archive already exists with the given name.
Raises exception ExamDatabaseErrorNotFound, if given modifier does not exist.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.edit_archive', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.edit_archive" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">edit_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">,</span> <span class="n">archive_name</span><span class="p">,</span> <span class="n">organisation_name</span><span class="p">,</span> <span class="n">identification_needed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Update an archive in the database. An archive can be specified by giving archive id.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `archive_id`: ID of the archive to be updated</span>
<span class="sd">    * `archive_name`: The name of the archive to be edited.</span>
<span class="sd">    * `organisation_name`: The name of the organisation, such as faculty, department or school, owning the archive.</span>
<span class="sd">    * `identification_needed`:  Whether authorization is required from basic users to view archive.</span>
<span class="sd">    * `modifier_id`: The creator or last modifier of the archive or None if not specified.</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * ID of the archive, if the archive was edited successfully and None if the archive did not exist or there was</span>
<span class="sd">    an error updating the database.</span>
<span class="sd">    Raises exception ExamDatabaseErrorExists, if the an archive already exists with the given name.</span>
<span class="sd">    Raises exception ExamDatabaseErrorNotFound, if given modifier does not exist.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># Create the SQL Statements</span>
    <span class="c"># SQL Statement for activating foreign keys</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="c"># SQL Statement for checking that the archive does exist</span>
    <span class="n">sql_query1</span> <span class="o">=</span> <span class="s">&quot;SELECT archive_id FROM archive WHERE archive_id = ?&quot;</span>
    <span class="c"># SQL Statement for checking that another archive does not yet exist with the same name and organisation</span>
    <span class="n">sql_query2</span> <span class="o">=</span> <span class="s">&#39;SELECT * from archive WHERE archive_id &lt;&gt; ? AND archive_name = ? AND organisation_name = ?&#39;</span>
    <span class="n">sql_update</span> <span class="o">=</span> <span class="s">&#39;UPDATE archive SET archive_name = ?, organisation_name = ?, identification_needed = ?, &#39;</span> \
                 <span class="s">&#39;modifier_id = ?, last_modified = ? &#39;</span> \
                 <span class="s">&#39;WHERE archive_id = ?&#39;</span>
    <span class="c"># Get current timestamp and format it into ISO string.</span>
    <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
    <span class="c"># Connect to the database and get a connection object</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c"># Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c"># Execute a query statement to find out whether the archive exists in the database</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_id</span><span class="p">,</span> <span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query1</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="c"># Only one value expected</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="c"># If the archive does not exist, return None</span>
        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Execute a query statement to check that another archive does not yet exist with the same name and organisation</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_id</span><span class="p">,</span> <span class="n">archive_name</span><span class="p">,</span> <span class="n">organisation_name</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query2</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c"># Only one value expected</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
            <span class="c"># If the archive exists, raise an exception</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span>
                    <span class="s">&quot;Another archive already exists with the same archive and organisation name&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Check that the given modifier_id exists in the user table</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>
                <span class="c"># Execute the main update statement</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_name</span><span class="p">,</span> <span class="n">organisation_name</span><span class="p">,</span> <span class="n">identification_needed</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">,</span>
                          <span class="n">archive_id</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_update</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
                <span class="c"># Check to see that the database was successfully modified</span>
                <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">None</span>
                <span class="c"># Return message id with &#39;msg-&#39; in the beginning</span>
                <span class="k">return</span> <span class="n">archive_id</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.edit_course">
    <p>def <span class="ident">edit_course</span>(</p><p>self, course_id, course_code, course_name, description, teacher_id, url, credit_points, language_id, modifier_id=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Update an course in the archive identified by a course ID. Archive can include multiple courses under same name 
and other information, but there cannot be be two courses with same name and language.</p>
<p>INPUT:</p>
<ul>
<li><code>course_id</code>: ID of the course to be updated</li>
<li><code>course_code</code>: Code of the course, what is used to identify course for in curriculum.</li>
<li><code>course_name</code>: Textual name of the course to be created.</li>
<li><code>description</code>: Description of the course.</li>
<li><code>teacher_id</code>: Name of the teacher, lecturer or other responsible person of the course.</li>
<li><code>url</code>: Course home page URL.</li>
<li><code>credit_points</code>: Amount of credit points, that can be earned from the course.</li>
<li><code>language_id</code>: Language identifier of the language used in the course.</li>
<li><code>modifier_id</code>: The creator or last modifier of the course or None if not specified.</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>ID of the course, if the course was updated successfully and None if the course did not exist or there was
an error updating the database.</li>
</ul>
<p>Raises exception ExamDatabaseErrorExists, if course with given course_name and language_id combination already 
exists. Raises ExamDatabaseErrorNotFound, if given teacher, language or modifier does not exist.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.edit_course', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.edit_course" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">edit_course</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">course_id</span><span class="p">,</span> <span class="n">course_code</span><span class="p">,</span> <span class="n">course_name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">credit_points</span><span class="p">,</span> <span class="n">language_id</span><span class="p">,</span>
                <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Update an course in the archive identified by a course ID. Archive can include multiple courses under same name </span>
<span class="sd">    and other information, but there cannot be be two courses with same name and language.</span>
<span class="sd">    </span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `course_id`: ID of the course to be updated</span>
<span class="sd">    * `course_code`: Code of the course, what is used to identify course for in curriculum.</span>
<span class="sd">    * `course_name`: Textual name of the course to be created.</span>
<span class="sd">    * `description`: Description of the course.</span>
<span class="sd">    * `teacher_id`: Name of the teacher, lecturer or other responsible person of the course.</span>
<span class="sd">    * `url`: Course home page URL.</span>
<span class="sd">    * `credit_points`: Amount of credit points, that can be earned from the course.</span>
<span class="sd">    * `language_id`: Language identifier of the language used in the course.</span>
<span class="sd">    * `modifier_id`: The creator or last modifier of the course or None if not specified.</span>
<span class="sd">    </span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * ID of the course, if the course was updated successfully and None if the course did not exist or there was</span>
<span class="sd">    an error updating the database.</span>
<span class="sd">    </span>
<span class="sd">    Raises exception ExamDatabaseErrorExists, if course with given course_name and language_id combination already </span>
<span class="sd">    exists. Raises ExamDatabaseErrorNotFound, if given teacher, language or modifier does not exist.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># Create the SQL Statements</span>
    <span class="c"># SQL Statement for activating foreign keys</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="c"># SQL Statement for checking that the course does exist and also for fetching the archive_id</span>
    <span class="n">sql_query1</span> <span class="o">=</span> <span class="s">&quot;SELECT archive_id FROM course WHERE course_id = ?&quot;</span>
    <span class="c"># SQL Statement for checking that another course does not yet exist with the same name and language,</span>
    <span class="c"># within the same archive.</span>
    <span class="n">sql_query2</span> <span class="o">=</span> <span class="s">&#39;SELECT * from course WHERE course_id &lt;&gt; ? AND archive_id = ? AND course_name = ? AND &#39;</span> \
                 <span class="s">&#39;language_id = ?&#39;</span>
    <span class="n">sql_update</span> <span class="o">=</span> <span class="s">&#39;UPDATE course SET course_code = ?, course_name = ?, description = ?, &#39;</span> \
                 <span class="s">&#39;teacher_id = ?, url = ?, credit_points = ?, language_id = ?, modifier_id = ?, &#39;</span> \
                 <span class="s">&#39;last_modified = ? WHERE course_id = ?&#39;</span>
    <span class="c"># Get current timestamp and format it into ISO string.</span>
    <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
    <span class="c"># Connect to the database and get a connection object</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c"># Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c"># Execute a query statement to find out whether the course exists in the database</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_id</span><span class="p">,</span> <span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query1</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="c"># Only one value expected</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="c"># If the course does not exist, return None</span>
        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Get the course&#39;s archive id from the previous query response</span>
            <span class="n">archive_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;archive_id&#39;</span><span class="p">]</span>
            <span class="c"># Execute a query statement to check that another course does not yet exist with the same name and language</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_id</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">,</span> <span class="n">course_name</span><span class="p">,</span> <span class="n">language_id</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query2</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c"># Only one value expected</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
            <span class="c"># If the archive exists, raise an exception</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span>
                    <span class="s">&quot;Another course already exists with the same name and language combination&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Check that the given examiner_id exists in the teacher table</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;teacher&quot;</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Teacher does not exist&quot;</span><span class="p">)</span>
                <span class="c"># Check that the given modifier_id exists in the user table</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;language&quot;</span><span class="p">,</span> <span class="n">language_id</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Language does not exist&quot;</span><span class="p">)</span>
                <span class="c"># Check that the given modifier_id exists in the user table</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>
                <span class="c"># Execute the main update statement</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_code</span><span class="p">,</span> <span class="n">course_name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">credit_points</span><span class="p">,</span>
                          <span class="n">language_id</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">,</span> <span class="n">course_id</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_update</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
                <span class="c"># Check to see that the database was successfully modified</span>
                <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">None</span>
                <span class="c"># Everything succeeded * return the course id</span>
                <span class="k">return</span> <span class="n">course_id</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.edit_exam">
    <p>def <span class="ident">edit_exam</span>(</p><p>self, exam_id, course_id, examiner_id, date, file_attachment, language_id, modifier_id=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Update an exam in the archive.</p>
<p>INPUT:</p>
<ul>
<li><code>exam_id</code>: The ID of the exam to be updated</li>
<li><code>course_id</code>: The ID of the course where the exam belongs to</li>
<li><code>examiner_id</code>: ID of the teacher, lecturer or other person responsible of overseeing the exam.</li>
<li><code>date</code>: Date of the exam given in format of YYYY-MM-DD.</li>
<li><code>file_attachment</code>: Identifier for the file attachment.</li>
<li><code>language_id</code>: Language identifier for the exam.</li>
<li><code>modifier_id</code>: The creator or last modifier of the exam or None if not specified.</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>True, if the exam was created successfully, False otherwise.</li>
</ul>
<p>Raises exception ExamDatabaseErrorExists, if the an exam already exists with the given course, date and language.
Raises exception ValueError if the date was not given in format YYYY-MM-DD. Raises ExamDatabaseErrorNotFound if
course, modifier, language or examiner do not exist.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.edit_exam', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.edit_exam" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">edit_exam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exam_id</span><span class="p">,</span> <span class="n">course_id</span><span class="p">,</span> <span class="n">examiner_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">file_attachment</span><span class="p">,</span> <span class="n">language_id</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Update an exam in the archive.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `exam_id`: The ID of the exam to be updated</span>
<span class="sd">    * `course_id`: The ID of the course where the exam belongs to</span>
<span class="sd">    * `examiner_id`: ID of the teacher, lecturer or other person responsible of overseeing the exam.</span>
<span class="sd">    * `date`: Date of the exam given in format of YYYY-MM-DD.</span>
<span class="sd">    * `file_attachment`: Identifier for the file attachment.</span>
<span class="sd">    * `language_id`: Language identifier for the exam.</span>
<span class="sd">    * `modifier_id`: The creator or last modifier of the exam or None if not specified.</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * True, if the exam was created successfully, False otherwise.</span>
<span class="sd">    Raises exception ExamDatabaseErrorExists, if the an exam already exists with the given course, date and language.</span>
<span class="sd">    Raises exception ValueError if the date was not given in format YYYY-MM-DD. Raises ExamDatabaseErrorNotFound if</span>
<span class="sd">    course, modifier, language or examiner do not exist.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># Check that the given date string is in valid date format</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="s">&#39;YYYY-MM-DD&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;YYYY-MM-DD&#39;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Date must be in format &quot;YYYY-MM-DD&quot;&#39;</span><span class="p">)</span>
    <span class="c"># Create the SQL Statements</span>
    <span class="c"># SQL Statement for activating foreign keys</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="c"># SQL Statement for checking that the exam does exist</span>
    <span class="n">sql_query1</span> <span class="o">=</span> <span class="s">&quot;SELECT exam_id FROM exam WHERE exam_id = ?&quot;</span>
    <span class="c"># SQL Statement for checking that another exam does not yet exist with the same course, date and language.</span>
    <span class="n">sql_query2</span> <span class="o">=</span> <span class="s">&#39;SELECT * from exam WHERE exam_id &lt;&gt; ? AND course_id = ? AND date = ? AND language_id = ?&#39;</span>
    <span class="n">sql_update</span> <span class="o">=</span> <span class="s">&#39;UPDATE exam SET course_id = ?, examiner_id = ?, date = ?, file_attachment = ?, language_id = ?, &#39;</span> \
                 <span class="s">&#39;modifier_id = ?, last_modified = ? &#39;</span> \
                 <span class="s">&#39;WHERE exam_id = ?&#39;</span>
    <span class="c"># Get current timestamp and format it into ISO string.</span>
    <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
    <span class="c"># Connect to the database and get a connection object</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c"># Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c"># Execute a query statement to find out whether the exam exists in the database</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">exam_id</span><span class="p">,</span> <span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query1</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="c"># Only one value expected</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="c"># If the course does not exist, return None</span>
        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Execute a query statement to check that another exam does not yet exist within the same course</span>
            <span class="c"># and with the same language</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">exam_id</span><span class="p">,</span> <span class="n">course_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">language_id</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query2</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c"># Only one value expected</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
            <span class="c"># If the archive exists, raise an exception</span>
            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span>
                    <span class="s">&quot;Another exam already exists with the same course, date and language&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># Check that the given course_id exists in the course table</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;course&quot;</span><span class="p">,</span> <span class="n">course_id</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Course does not exist&quot;</span><span class="p">)</span>
                <span class="c"># Check that the given examiner_id exists in the teacher table</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;teacher&quot;</span><span class="p">,</span> <span class="n">examiner_id</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Examiner does not exist&quot;</span><span class="p">)</span>
                <span class="c"># Check that the given modifier_id exists in the user table</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;language&quot;</span><span class="p">,</span> <span class="n">language_id</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Language does not exist&quot;</span><span class="p">)</span>
                <span class="c"># Check that the given modifier_id exists in the user table</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>
                <span class="c"># Execute the main update statement</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_id</span><span class="p">,</span> <span class="n">examiner_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">file_attachment</span><span class="p">,</span> <span class="n">language_id</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span>
                          <span class="n">last_modified</span><span class="p">,</span> <span class="n">exam_id</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_update</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
                <span class="c"># Check to see that the database was successfully modified</span>
                <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">None</span>
                <span class="c"># Everything succeeded - return the exam id</span>
                <span class="k">return</span> <span class="n">exam_id</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.edit_exam_file">
    <p>def <span class="ident">edit_exam_file</span>(</p><p>self, exam_id, file_attachment, modifier_id=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Update an exam file attachment.</p>
<p>INPUT:</p>
<ul>
<li><code>exam_id</code>: The ID of the exam to be updated</li>
<li><code>file_attachment</code>: Identifier for the file attachment.</li>
<li><code>modifier_id</code>: The creator or last modifier of the exam or None if not specified.</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>True, if the exam was updated successfully, False otherwise.</li>
</ul>
<p>Raises ExamDatabaseErrorNotFound if course, modifier, language or examiner do not exist.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.edit_exam_file', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.edit_exam_file" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">edit_exam_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exam_id</span><span class="p">,</span> <span class="n">file_attachment</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Update an exam file attachment.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `exam_id`: The ID of the exam to be updated</span>
<span class="sd">    * `file_attachment`: Identifier for the file attachment.</span>
<span class="sd">    * `modifier_id`: The creator or last modifier of the exam or None if not specified.</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * True, if the exam was updated successfully, False otherwise.</span>
<span class="sd">    Raises ExamDatabaseErrorNotFound if course, modifier, language or examiner do not exist.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># Create the SQL Statements</span>
    <span class="c"># SQL Statement for activating foreign keys</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="c"># SQL Statement for checking that the exam does exist</span>
    <span class="n">sql_query1</span> <span class="o">=</span> <span class="s">&quot;SELECT exam_id FROM exam WHERE exam_id = ?&quot;</span>
    <span class="n">sql_update</span> <span class="o">=</span> <span class="s">&#39;UPDATE exam SET file_attachment = ?, &#39;</span> \
                 <span class="s">&#39;modifier_id = ?, last_modified = ? &#39;</span> \
                 <span class="s">&#39;WHERE exam_id = ?&#39;</span>
    <span class="c"># Get current timestamp and format it into ISO string.</span>
    <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
    <span class="c"># Connect to the database and get a connection object</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c"># Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c"># Execute a query statement to find out whether the exam exists in the database</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">exam_id</span><span class="p">,</span> <span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query1</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="c"># Only one value expected</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="c"># If the course does not exist, return None</span>
        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Check that the given modifier_id exists in the user table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>
            <span class="c"># Execute the main update statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">file_attachment</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">,</span> <span class="n">exam_id</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_update</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c"># Check to see that the database was successfully modified</span>
            <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="c"># Everything succeeded - return the exam id</span>
            <span class="k">return</span> <span class="n">exam_id</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.edit_teacher">
    <p>def <span class="ident">edit_teacher</span>(</p><p>self, teacher_id, first_name, last_name, office=&#39;&#39;, street_address=&#39;&#39;, postal_code=&#39;&#39;, city=&#39;&#39;, phone=&#39;&#39;, email=&#39;&#39;, other_info=&#39;&#39;, modifier_id=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Update teacher details. The teacher is identified by the given teacher ID.</p>
<p>INPUT:</p>
<ul>
<li><code>teacher_id</code>: The ID of the teacher to be modified.</li>
<li><code>first_name</code>: First name (cannot be blank)</li>
<li><code>last_name</code>: Last name (cannot be blank)</li>
<li><code>office</code>: Office information</li>
<li><code>street_address</code>: Street address or P.O.Box</li>
<li><code>postal_code</code>: Postal code</li>
<li><code>city</code>: City</li>
<li><code>phone</code>: Phone number</li>
<li><code>email</code>: Email address</li>
<li><code>other_info</code>: Other contact information</li>
<li><code>modifier_id</code>: Creator or last modifier</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>ID of the updated message, if the user details were modified successfully or None, if not.</li>
</ul>
<p>Raises exception ExamDatabaseError if there was an error updating the teacher details.
Raises exception ValueError if first_name or last_name were not given.
ExamDatabaseErrorNotFound if modifier does not exist.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.edit_teacher', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.edit_teacher" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">edit_teacher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">office</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">street_address</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">postal_code</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">city</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">phone</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">other_info</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Update teacher details. The teacher is identified by the given teacher ID.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `teacher_id`: The ID of the teacher to be modified.</span>
<span class="sd">    * `first_name`: First name (cannot be blank)</span>
<span class="sd">    * `last_name`: Last name (cannot be blank)</span>
<span class="sd">    * `office`: Office information</span>
<span class="sd">    * `street_address`: Street address or P.O.Box</span>
<span class="sd">    * `postal_code`: Postal code</span>
<span class="sd">    * `city`: City</span>
<span class="sd">    * `phone`: Phone number</span>
<span class="sd">    * `email`: Email address</span>
<span class="sd">    * `other_info`: Other contact information</span>
<span class="sd">    * `modifier_id`: Creator or last modifier</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * ID of the updated message, if the user details were modified successfully or None, if not.</span>
<span class="sd">    Raises exception ExamDatabaseError if there was an error updating the teacher details.</span>
<span class="sd">    Raises exception ValueError if first_name or last_name were not given.</span>
<span class="sd">    ExamDatabaseErrorNotFound if modifier does not exist.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># Validate the parameters</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">first_name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">last_name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;First and last name must be specified for a teacher&quot;</span><span class="p">)</span>
    <span class="c"># Validate the parameters</span>
    <span class="k">if</span> <span class="n">email</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&quot;[^@]+@[^@]+\.[^@]+&quot;</span><span class="p">,</span> <span class="n">email</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Teacher&#39;s email address is malformed&quot;</span><span class="p">)</span>
    <span class="c"># Create the SQL Statements</span>
    <span class="c"># SQL Statement for activating foreign keys</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="c"># SQL Statement for checking that the archive does exist</span>
    <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&quot;SELECT teacher_id FROM teacher WHERE teacher_id = ?&quot;</span>
    <span class="n">sql_update</span> <span class="o">=</span> <span class="s">&#39;UPDATE teacher SET first_name = ?, last_name = ?, office = ?, street_address = ?, &#39;</span> \
                 <span class="s">&#39;postal_code = ?, city = ?, phone = ?, email = ?, other_info = ?, modifier_id = ? &#39;</span> \
                 <span class="s">&#39;WHERE teacher_id = ?&#39;</span>
    <span class="c"># Get current timestamp and format it into ISO string.</span>
    <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
    <span class="c"># Connect to the database and get a connection object</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c"># Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c"># Execute a query statement to check that the teacher id exists in the database, if not return None</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">teacher_id</span><span class="p">,)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="c"># Only one value expected</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="c"># If the teacher row does not exist, return None</span>
        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Check that the given modifier_id exists in the user table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>
            <span class="c"># Execute the main update statement</span>
            <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">office</span><span class="p">,</span> <span class="n">street_address</span><span class="p">,</span> <span class="n">postal_code</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">phone</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span>
                      <span class="n">other_info</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">)</span>
            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_update</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="c"># Check to see that the database was successfully modified, otherwise return None</span>
            <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="c"># Return taecher id of the updated message</span>
            <span class="k">return</span> <span class="n">teacher_id</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.edit_user">
    <p>def <span class="ident">edit_user</span>(</p><p>self, user_id, username, password, user_type=&#39;basic&#39;, archive_id=None, modifier_id=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Update user details. The user is identified by the given user ID.</p>
<p>INPUT:</p>
<ul>
<li><code>user_id</code>: The ID of the user to be modified.</li>
<li><code>username</code>: Visible username.</li>
<li><code>password</code>: Hashed password of the user.</li>
<li><code>user_type</code>: User type identifies whether the user in superuser, admin or regular view-only user. The user_type must be one of the values 'super', 'admin' or 'basic'.</li>
<li><code>archive_id</code>: The ID of an archive where the user has access to.</li>
<li><code>modifier_id</code>: The creator or of the user or None if not specified.</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>True, if the user details were modified successfully or False, if not.</li>
</ul>
<p>Raises exception ExamDatabaseErrorExists, if user with the same username already exists. Raises exception ExamDatabaseError if there was an error creating new user.
ExamDatabaseErrorNotFound if modifier does not exist.
Raises exception ValueError if the user_type was not one of the defined values.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.edit_user', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.edit_user" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">edit_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">user_type</span><span class="o">=</span><span class="s">&#39;basic&#39;</span><span class="p">,</span> <span class="n">archive_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">modifier_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Update user details. The user is identified by the given user ID.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `user_id`: The ID of the user to be modified.</span>
<span class="sd">    * `username`: Visible username.</span>
<span class="sd">    * `password`: Hashed password of the user.</span>
<span class="sd">    * `user_type`: User type identifies whether the user in superuser, admin or regular view-only user. The user_type must be one of the values &#39;super&#39;, &#39;admin&#39; or &#39;basic&#39;.</span>
<span class="sd">    * `archive_id`: The ID of an archive where the user has access to.</span>
<span class="sd">    * `modifier_id`: The creator or of the user or None if not specified.</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * True, if the user details were modified successfully or False, if not.</span>
<span class="sd">    Raises exception ExamDatabaseErrorExists, if user with the same username already exists. Raises exception ExamDatabaseError if there was an error creating new user.</span>
<span class="sd">    ExamDatabaseErrorNotFound if modifier does not exist.</span>
<span class="sd">    Raises exception ValueError if the user_type was not one of the defined values.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># Create the SQL Statements</span>
    <span class="c"># SQL Statement for activating foreign keys</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="c"># SQL Statement for checking that the user does exist</span>
    <span class="n">sql_query1</span> <span class="o">=</span> <span class="s">&quot;SELECT user_id FROM user WHERE user_id = ?&quot;</span>
    <span class="c"># SQL Statement for checking that another user does not yet exist with the same username</span>
    <span class="n">sql_query2</span> <span class="o">=</span> <span class="s">&#39;SELECT * from user WHERE user_id &lt;&gt; ? AND username = ?&#39;</span>
    <span class="c"># Validation of user type</span>
    <span class="k">if</span> <span class="n">user_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;basic&#39;</span><span class="p">,</span><span class="s">&#39;admin&#39;</span><span class="p">,</span><span class="s">&#39;super&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;User type is not basic, admin or super&quot;</span><span class="p">)</span>
    <span class="n">sql_update</span> <span class="o">=</span> <span class="s">&#39;UPDATE user SET user_type = ?, username = ?, password = ?, &#39;</span> \
                 <span class="s">&#39;modifier_id = ?, last_modified = ?, archive_id = ? &#39;</span> \
                 <span class="s">&#39;WHERE user_id = ?&#39;</span>
    <span class="c"># Get current timestamp and format it into ISO string.</span>
    <span class="n">last_modified</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
    <span class="c"># Connect to the database and get a connection object</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c"># Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c"># Execute a query statement to find out whether the user exists in the database</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query1</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="c"># Only one value expected</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="c"># If the user does not exist, return None</span>
        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Check that the given modifier_id exists in the user table</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_valid_foreign_key</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="s">&quot;Modifier does not exist&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c"># Execute the main update statement</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">user_type</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">modifier_id</span><span class="p">,</span> <span class="n">last_modified</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_update</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">IntegrityError</span><span class="p">:</span>
                <span class="c"># Expect IntegrityError risen when new username already exists in the database</span>
                <span class="k">raise</span> <span class="n">ExamDatabaseErrorExists</span><span class="p">(</span><span class="s">&quot;The given username already exists&quot;</span><span class="p">)</span>
            <span class="c"># Check to see that the database was successfully modified</span>
            <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
            <span class="k">return</span> <span class="n">user_id</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.get_archive">
    <p>def <span class="ident">get_archive</span>(</p><p>self, archive_id)</p>
    </div>
    

    
  
    <div class="desc"><p>Get archive details from the database. An archive can be specified by giving archive id.</p>
<p>INPUT:</p>
<ul>
<li><code>archive_id</code>: ID of the archive</li>
</ul>
<p>OUTPUT is a dictionary containing the following keys:</p>
<ul>
<li><code>archive_name</code>: The name of the archive</li>
<li><code>organisation_name</code>: The name of the organisation, such as faculty, department or school, owning the archive.</li>
<li><code>identification_needed</code>:  Whether authorization is required from basic users to view exams.</li>
<li><code>modifier_id</code>: The creator or last modifier of the archive or None if not specified.</li>
<li><code>last_modified</code>: The date archive was last modified</li>
</ul>
<p>If archive was not found, None is returned.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.get_archive', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.get_archive" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">get_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get archive details from the database. An archive can be specified by giving archive id.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    </span>
<span class="sd">    * `archive_id`: ID of the archive</span>
<span class="sd">    OUTPUT is a dictionary containing the following keys:</span>
<span class="sd">    * `archive_name`: The name of the archive</span>
<span class="sd">    * `organisation_name`: The name of the organisation, such as faculty, department or school, owning the archive.</span>
<span class="sd">    * `identification_needed`:  Whether authorization is required from basic users to view exams.</span>
<span class="sd">    * `modifier_id`: The creator or last modifier of the archive or None if not specified.</span>
<span class="sd">    * `last_modified`: The date archive was last modified</span>
<span class="sd">    If archive was not found, None is returned.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="s">&quot;archive&quot;</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.get_archive_by_name">
    <p>def <span class="ident">get_archive_by_name</span>(</p><p>self, archive_name)</p>
    </div>
    

    
  
    <div class="desc"><p>Find an archive by name. An archive can be specified by giving the full name.</p>
<p>INPUT:</p>
<ul>
<li><code>archive_name</code>: Name of the archive.</li>
</ul>
<p>OUTPUT is a dictionary containing the following keys:</p>
<ul>
<li><code>archive_id</code>: The name of the archive</li>
<li><code>archive_name</code>: The name of the archive</li>
<li><code>organisation_name</code>: The name of the organisation, such as faculty, department or school, owning the archive.</li>
<li><code>identification_needed</code>:  Whether authorization is required from basic users to view exams.</li>
<li><code>modifier_id</code>: The creator or last modifier of the archive or None if not specified.</li>
<li><code>last_modified</code>: The date archive was last modified</li>
</ul>
<p>If archive was not found, None is returned.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.get_archive_by_name', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.get_archive_by_name" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">get_archive_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_name</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Find an archive by name. An archive can be specified by giving the full name.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `archive_name`: Name of the archive.</span>
<span class="sd">    OUTPUT is a dictionary containing the following keys:</span>
<span class="sd">    * `archive_id`: The name of the archive</span>
<span class="sd">    * `archive_name`: The name of the archive</span>
<span class="sd">    * `organisation_name`: The name of the organisation, such as faculty, department or school, owning the archive.</span>
<span class="sd">    * `identification_needed`:  Whether authorization is required from basic users to view exams.</span>
<span class="sd">    * `modifier_id`: The creator or last modifier of the archive or None if not specified.</span>
<span class="sd">    * `last_modified`: The date archive was last modified</span>
<span class="sd">    If archive was not found, None is returned.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># SQL Statement for activating foreign keys</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="c"># SQL Statement for checking that the user does not yet exist</span>
    <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from archive WHERE archive_name = ?&#39;</span>
    <span class="c"># Connect to the database and get a connection object</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c"># Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c"># Execute the SQL query statement</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_name</span><span class="p">,</span> <span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_object</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.get_course">
    <p>def <span class="ident">get_course</span>(</p><p>self, course_id)</p>
    </div>
    

    
  
    <div class="desc"><p>Get course details from the database. A course is specified by giving course id.</p>
<p>INPUT:</p>
<ul>
<li><code>course_id</code>: ID of the course</li>
</ul>
<p>OUTPUT is a dictionary containing the following keys:</p>
<ul>
<li><code>archive_id</code>: The ID of an archive where the course belongs to</li>
<li><code>course_code</code>: Code of course, which used to to identify course in curriculum</li>
<li><code>course_name</code>: Textual name of the course</li>
<li><code>description</code>: Description of course</li>
<li><code>teacher_id</code>: Responsible teacher of the course</li>
<li><code>url</code>: URL address to the course webpage</li>
<li><code>credit_points</code>: Number of total credit points earned from course</li>
<li><code>language_id</code>: Identifies language used in course</li>
<li><code>modifier_id</code>: Creator or last modifie</li>
<li><code>last_modified</code>: Last modified date.</li>
</ul>
<p>If course was not found, None is returned.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.get_course', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.get_course" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">get_course</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">course_id</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get course details from the database. A course is specified by giving course id.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    </span>
<span class="sd">    * `course_id`: ID of the course</span>
<span class="sd">    OUTPUT is a dictionary containing the following keys:</span>
<span class="sd">    * `archive_id`: The ID of an archive where the course belongs to</span>
<span class="sd">    * `course_code`: Code of course, which used to to identify course in curriculum</span>
<span class="sd">    * `course_name`: Textual name of the course</span>
<span class="sd">    * `description`: Description of course</span>
<span class="sd">    * `teacher_id`: Responsible teacher of the course</span>
<span class="sd">    * `url`: URL address to the course webpage</span>
<span class="sd">    * `credit_points`: Number of total credit points earned from course</span>
<span class="sd">    * `language_id`: Identifies language used in course</span>
<span class="sd">    * `modifier_id`: Creator or last modifie</span>
<span class="sd">    * `last_modified`: Last modified date.</span>
<span class="sd">    If course was not found, None is returned.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="s">&quot;course&quot;</span><span class="p">,</span> <span class="n">course_id</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.get_course_by_name">
    <p>def <span class="ident">get_course_by_name</span>(</p><p>self, course_name)</p>
    </div>
    

    
  
    <div class="desc"><p>Find course details by course name. A course is specified by giving its full name.</p>
<p>INPUT:</p>
<ul>
<li><code>course_id</code>: ID of the course</li>
</ul>
<p>OUTPUT is a dictionary containing the following keys:</p>
<ul>
<li><code>course_id</code>: The ID of the course</li>
<li><code>archive_id</code>: The ID of an archive where the course belongs to</li>
<li><code>course_code</code>: Code of course, which used to to identify course in curriculum</li>
<li><code>course_name</code>: Textual name of the course</li>
<li><code>description</code>: Description of course</li>
<li><code>teacher_id</code>: Responsible teacher of the course</li>
<li><code>url</code>: URL address to the course webpage</li>
<li><code>credit_points</code>: Number of total credit points earned from course</li>
<li><code>language_id</code>: Identifies language used in course</li>
<li><code>modifier_id</code>: Creator or last modifie</li>
<li><code>last_modified</code>: Last modified date.</li>
</ul>
<p>If course was not found, None is returned.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.get_course_by_name', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.get_course_by_name" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">get_course_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">course_name</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Find course details by course name. A course is specified by giving its full name.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `course_id`: ID of the course</span>
<span class="sd">    OUTPUT is a dictionary containing the following keys:</span>
<span class="sd">    * `course_id`: The ID of the course</span>
<span class="sd">    * `archive_id`: The ID of an archive where the course belongs to</span>
<span class="sd">    * `course_code`: Code of course, which used to to identify course in curriculum</span>
<span class="sd">    * `course_name`: Textual name of the course</span>
<span class="sd">    * `description`: Description of course</span>
<span class="sd">    * `teacher_id`: Responsible teacher of the course</span>
<span class="sd">    * `url`: URL address to the course webpage</span>
<span class="sd">    * `credit_points`: Number of total credit points earned from course</span>
<span class="sd">    * `language_id`: Identifies language used in course</span>
<span class="sd">    * `modifier_id`: Creator or last modifie</span>
<span class="sd">    * `last_modified`: Last modified date.</span>
<span class="sd">    If course was not found, None is returned.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># SQL Statement for activating foreign keys</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="c"># SQL Statement for checking that the user does not yet exist</span>
    <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from course WHERE course_name = ?&#39;</span>
    <span class="c"># Connect to the database and get a connection object</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c"># Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c"># Execute the SQL query statement</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_name</span><span class="p">,</span> <span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_object</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.get_exam">
    <p>def <span class="ident">get_exam</span>(</p><p>self, exam_id)</p>
    </div>
    

    
  
    <div class="desc"><p>Get exam details from the database. An exam is specified by giving exam id.</p>
<p>INPUT:</p>
<ul>
<li><code>exam_id</code>: ID of the exam</li>
</ul>
<p>OUTPUT is dictionary containing the following keys:</p>
<ul>
<li><code>course_id</code>: Course ID of the exam</li>
<li><code>examiner_id</code>: Responsible teacher of the exam</li>
<li><code>date</code>: Date of the exam</li>
<li><code>file_attachment</code>: File attachment id of the PDF file</li>
<li><code>language_id</code>: Language of the course</li>
<li><code>modifier_id</code>: Creator or last modifier</li>
<li><code>last_modified</code>: Last modified date</li>
</ul>
<p>If exam was not found, None is returned.</p>
<p>Raises exception ExamDatabaseError if there was an error accessing the database.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.get_exam', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.get_exam" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">get_exam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exam_id</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get exam details from the database. An exam is specified by giving exam id.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    </span>
<span class="sd">    * `exam_id`: ID of the exam</span>
<span class="sd">    OUTPUT is dictionary containing the following keys:</span>
<span class="sd">    * `course_id`: Course ID of the exam</span>
<span class="sd">    * `examiner_id`: Responsible teacher of the exam</span>
<span class="sd">    * `date`: Date of the exam</span>
<span class="sd">    * `file_attachment`: File attachment id of the PDF file</span>
<span class="sd">    * `language_id`: Language of the course</span>
<span class="sd">    * `modifier_id`: Creator or last modifier</span>
<span class="sd">    * `last_modified`: Last modified date</span>
<span class="sd">    If exam was not found, None is returned.</span>
<span class="sd">    Raises exception ExamDatabaseError if there was an error accessing the database.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="s">&quot;exam&quot;</span><span class="p">,</span> <span class="n">exam_id</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.get_teacher">
    <p>def <span class="ident">get_teacher</span>(</p><p>self, teacher_id)</p>
    </div>
    

    
  
    <div class="desc"><p>Get teacher details. The teacher is identified by the given teacher ID.</p>
<p>INPUT:</p>
<ul>
<li><code>teacher_id</code>: The ID of the teacher.</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li><code>teacher_id</code>: The ID of the teacher to be modified.</li>
<li><code>first_name</code>: First name</li>
<li><code>last_name</code>: Last name</li>
<li><code>office</code>: Office information</li>
<li><code>street_address</code>: Street address or P.O.Box</li>
<li><code>postal_code</code>: Postal code</li>
<li><code>city</code>: City</li>
<li><code>phone</code>: Phone number</li>
<li><code>email</code>: Email address</li>
<li><code>other_info</code>: Other contact information</li>
<li><code>modifier_id</code>: Creator or last modifier</li>
<li><code>last_modified</code>: Date when the teacher entity was last modified.</li>
</ul>
<p>If the teacher was not found with the given ID, None is returned.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.get_teacher', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.get_teacher" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">get_teacher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get teacher details. The teacher is identified by the given teacher ID.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `teacher_id`: The ID of the teacher.</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * `teacher_id`: The ID of the teacher to be modified.</span>
<span class="sd">    * `first_name`: First name</span>
<span class="sd">    * `last_name`: Last name</span>
<span class="sd">    * `office`: Office information</span>
<span class="sd">    * `street_address`: Street address or P.O.Box</span>
<span class="sd">    * `postal_code`: Postal code</span>
<span class="sd">    * `city`: City</span>
<span class="sd">    * `phone`: Phone number</span>
<span class="sd">    * `email`: Email address</span>
<span class="sd">    * `other_info`: Other contact information</span>
<span class="sd">    * `modifier_id`: Creator or last modifier</span>
<span class="sd">    * `last_modified`: Date when the teacher entity was last modified.</span>
<span class="sd">    If the teacher was not found with the given ID, None is returned.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="s">&quot;teacher&quot;</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.get_teacher_by_name">
    <p>def <span class="ident">get_teacher_by_name</span>(</p><p>self, first_name, last_name)</p>
    </div>
    

    
  
    <div class="desc"><p>Find teacher details by teacher name. A teacher is specified by giving its full name.</p>
<p>INPUT:</p>
<ul>
<li><code>teacher_id</code>: ID of the teacher</li>
</ul>
<p>OUTPUT is a dictionary containing the following keys:</p>
<ul>
<li><code>teacher_id</code>: The ID of the teacher to be modified.</li>
<li><code>first_name</code>: First name</li>
<li><code>last_name</code>: Last name</li>
<li><code>office</code>: Office information</li>
<li><code>street_address</code>: Street address or P.O.Box</li>
<li><code>postal_code</code>: Postal code</li>
<li><code>city</code>: City</li>
<li><code>phone</code>: Phone number</li>
<li><code>email</code>: Email address</li>
<li><code>other_info</code>: Other contact information</li>
<li><code>modifier_id</code>: Creator or last modifier</li>
<li><code>last_modified</code>: Date when the teacher entity was last modified.</li>
</ul>
<p>If teacher was not found, None is returned.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.get_teacher_by_name', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.get_teacher_by_name" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">get_teacher_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Find teacher details by teacher name. A teacher is specified by giving its full name.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `teacher_id`: ID of the teacher</span>
<span class="sd">    OUTPUT is a dictionary containing the following keys:</span>
<span class="sd">    * `teacher_id`: The ID of the teacher to be modified.</span>
<span class="sd">    * `first_name`: First name</span>
<span class="sd">    * `last_name`: Last name</span>
<span class="sd">    * `office`: Office information</span>
<span class="sd">    * `street_address`: Street address or P.O.Box</span>
<span class="sd">    * `postal_code`: Postal code</span>
<span class="sd">    * `city`: City</span>
<span class="sd">    * `phone`: Phone number</span>
<span class="sd">    * `email`: Email address</span>
<span class="sd">    * `other_info`: Other contact information</span>
<span class="sd">    * `modifier_id`: Creator or last modifier</span>
<span class="sd">    * `last_modified`: Date when the teacher entity was last modified.</span>
<span class="sd">    If teacher was not found, None is returned.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># SQL Statement for activating foreign keys</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="c"># SQL Statement for checking that the user does not yet exist</span>
    <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from teacher WHERE first_name = ? AND last_name = ?&#39;</span>
    <span class="c"># Connect to the database and get a connection object</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c"># Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c"># Execute the SQL query statement</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_object</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.get_user">
    <p>def <span class="ident">get_user</span>(</p><p>self, user_id)</p>
    </div>
    

    
  
    <div class="desc"><p>Get user details. The user is identified by the given user ID.</p>
<p>INPUT:</p>
<ul>
<li><code>user_id</code>: The ID of the user.</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li><code>username</code>: Visible username.</li>
<li><code>password</code>: Hashed password of the user.</li>
<li><code>user_type</code>: User type identifies whether the user in superuser, admin or regular view-only user. The user_type is one of values 'super', 'admin' or 'basic'.</li>
<li><code>archive_id</code>: The ID of an archive where the user has access to.</li>
<li><code>modifier_id</code>: The creator or of the user or None if not specified.</li>
</ul>
<p>If the user was not found with the given ID, None is returned.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.get_user', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.get_user" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get user details. The user is identified by the given user ID.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `user_id`: The ID of the user.</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * `username`: Visible username.</span>
<span class="sd">    * `password`: Hashed password of the user.</span>
<span class="sd">    * `user_type`: User type identifies whether the user in superuser, admin or regular view-only user. The user_type is one of values &#39;super&#39;, &#39;admin&#39; or &#39;basic&#39;.</span>
<span class="sd">    * `archive_id`: The ID of an archive where the user has access to.</span>
<span class="sd">    * `modifier_id`: The creator or of the user or None if not specified.</span>
<span class="sd">    If the user was not found with the given ID, None is returned.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.get_user_by_name">
    <p>def <span class="ident">get_user_by_name</span>(</p><p>self, username)</p>
    </div>
    

    
  
    <div class="desc"><p>Find user details by user name.</p>
<p>INPUT:</p>
<ul>
<li><code>user_name</code>: Visible username</li>
</ul>
<p>OUTPUT is a dictionary containing the following keys:</p>
<ul>
<li><code>user_id</code>: ID of the user.</li>
<li><code>username</code>: Visible username.</li>
<li><code>password</code>: Hashed password of the user.</li>
<li><code>user_type</code>: User type identifies whether the user in superuser, admin or regular view-only user. The user_type is one of values 'super', 'admin' or 'basic'.</li>
<li><code>archive_id</code>: The ID of an archive where the user has access to.</li>
<li><code>modifier_id</code>: The creator or of the user or None if not specified.</li>
</ul>
<p>If user was not found, None is returned.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.get_user_by_name', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.get_user_by_name" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">get_user_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Find user details by user name.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `user_name`: Visible username</span>
<span class="sd">    OUTPUT is a dictionary containing the following keys:</span>
<span class="sd">    * `user_id`: ID of the user.</span>
<span class="sd">    * `username`: Visible username.</span>
<span class="sd">    * `password`: Hashed password of the user.</span>
<span class="sd">    * `user_type`: User type identifies whether the user in superuser, admin or regular view-only user. The user_type is one of values &#39;super&#39;, &#39;admin&#39; or &#39;basic&#39;.</span>
<span class="sd">    * `archive_id`: The ID of an archive where the user has access to.</span>
<span class="sd">    * `modifier_id`: The creator or of the user or None if not specified.</span>
<span class="sd">    If user was not found, None is returned.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># SQL Statement for activating foreign keys</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="c"># SQL Statement for checking that the user does not yet exist</span>
    <span class="n">sql_query</span> <span class="o">=</span> <span class="s">&#39;SELECT * from user WHERE username = ?&#39;</span>
    <span class="c"># Connect to the database and get a connection object</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c"># Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c"># Execute the SQL query statement</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="p">)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_object</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.load_init_values">
    <p>def <span class="ident">load_init_values</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Populate the database with initial values.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.load_init_values', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.load_init_values" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">load_init_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Populate the database with initial values. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">create_tables_from_schema</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_table_values_from_dump</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.load_table_values_from_dump">
    <p>def <span class="ident">load_table_values_from_dump</span>(</p><p>self, dump=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Populate programmatically the tables from a dump file.
dump is the path to the .sql dump file. If it is None,<br />
DEFAULT_DATA_DUMP is used instead.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.load_table_values_from_dump', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.load_table_values_from_dump" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">load_table_values_from_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dump</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Populate programmatically the tables from a dump file.</span>
<span class="sd">    dump is the path to the .sql dump file. If it is None,  </span>
<span class="sd">    DEFAULT_DATA_DUMP is used instead.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dump</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">dump</span> <span class="o">=</span> <span class="n">DEFAULT_DATA_DUMP</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dump</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">executescript</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.remove_archive">
    <p>def <span class="ident">remove_archive</span>(</p><p>self, archive_id)</p>
    </div>
    

    
  
    <div class="desc"><p>Remove an archive from the database. An archive can be specified by giving archive id. Note: Removing an archive deletes all the courses and all the exams attached to it!</p>
<p>INPUT:</p>
<ul>
<li><code>archive_id</code>: ID of the archive to be removed</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>If the archive was successfully deleted True is returned, otherwise False.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.remove_archive', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.remove_archive" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">remove_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Remove an archive from the database. An archive can be specified by giving archive id. Note: Removing an archive deletes all the courses and all the exams attached to it!</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `archive_id`: ID of the archive to be removed</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * If the archive was successfully deleted True is returned, otherwise False.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="n">delete_query</span> <span class="o">=</span> <span class="s">&#39;DELETE FROM archive WHERE archive_id = ?&#39;</span>
    <span class="c"># Connect to the database</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c">#Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c">#Execute the statement to delete</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_id</span><span class="p">,)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">delete_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="c">#Check that it has been deleted</span>
        <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.remove_course">
    <p>def <span class="ident">remove_course</span>(</p><p>self, course_id)</p>
    </div>
    

    
  
    <div class="desc"><p>Remove a course from the database. A course is specified by giving course id. Note: Removing a course deletes all the exams attached to it!</p>
<p>INPUT:</p>
<ul>
<li><code>course_id</code>: ID of the course</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>If the course successfully deleted True is returned, otherwise False.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.remove_course', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.remove_course" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">remove_course</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">course_id</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Remove a course from the database. A course is specified by giving course id. Note: Removing a course deletes all the exams attached to it!</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `course_id`: ID of the course</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * If the course successfully deleted True is returned, otherwise False.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="n">delete_query</span> <span class="o">=</span> <span class="s">&#39;DELETE FROM course WHERE course_id = ?&#39;</span>
    <span class="c"># Connect to the database</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c">#Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c">#Execute the statement to delete</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">course_id</span><span class="p">,)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">delete_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="c">#Check that it has been deleted</span>
        <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.remove_exam">
    <p>def <span class="ident">remove_exam</span>(</p><p>self, exam_id)</p>
    </div>
    

    
  
    <div class="desc"><p>Remove exam details from the database. An exam is specified by giving exam id. File attachments do not get deleted automatically as they are not part of the database.</p>
<p>INPUT:</p>
<ul>
<li><code>exam_id</code>: ID of the exam</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>If the exam successfully deleted True is returned, otherwise False.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.remove_exam', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.remove_exam" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">remove_exam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exam_id</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Remove exam details from the database. An exam is specified by giving exam id. File attachments do not get deleted automatically as they are not part of the database.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `exam_id`: ID of the exam</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * If the exam successfully deleted True is returned, otherwise False.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="n">delete_query</span> <span class="o">=</span> <span class="s">&#39;DELETE FROM exam WHERE exam_id = ?&#39;</span>
    <span class="c"># Connect to the database</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c">#Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c">#Execute the statement to delete</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">exam_id</span><span class="p">,)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">delete_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="c">#Check that it has been deleted</span>
        <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.remove_teacher">
    <p>def <span class="ident">remove_teacher</span>(</p><p>self, teacher_id)</p>
    </div>
    

    
  
    <div class="desc"><p>Remove a teacher from the database.</p>
<p>INPUT:</p>
<ul>
<li><code>teacher_id</code>: ID of the teacher to be deleted.</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>True, if a teacher with the given user_id was found, False otherwise.</li>
</ul>
<p>Returns true, if the delete succeeded, otherwise false if there was an error deleting the teacher from the database.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.remove_teacher', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.remove_teacher" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">remove_teacher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">teacher_id</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Remove a teacher from the database.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `teacher_id`: ID of the teacher to be deleted.</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * True, if a teacher with the given user_id was found, False otherwise.</span>
<span class="sd">    Returns true, if the delete succeeded, otherwise false if there was an error deleting the teacher from the database.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="n">delete_query</span> <span class="o">=</span> <span class="s">&#39;DELETE FROM teacher WHERE teacher_id = ?&#39;</span>
    <span class="c"># Connect to the database</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c"># Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c">#Execute the statement to delete</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">teacher_id</span><span class="p">,)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">delete_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="c">#Check that it has been deleted</span>
        <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.remove_user">
    <p>def <span class="ident">remove_user</span>(</p><p>self, user_id)</p>
    </div>
    

    
  
    <div class="desc"><p>Remove user from the database.</p>
<p>INPUT:</p>
<ul>
<li><code>user_id</code>: ID of the user to be deleted.</li>
</ul>
<p>OUTPUT:</p>
<ul>
<li>True, if a user with the given user_id was removed, False otherwise.</li>
</ul>
<p>Returns true, if the delete succeeded, otherwise false if there was an error deleting the user from the database.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.remove_user', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.remove_user" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">remove_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Remove user from the database.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `user_id`: ID of the user to be deleted.</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * True, if a user with the given user_id was removed, False otherwise.</span>
<span class="sd">    Returns true, if the delete succeeded, otherwise false if there was an error deleting the user from the database.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="n">delete_query</span> <span class="o">=</span> <span class="s">&#39;DELETE FROM user WHERE user_id = ?&#39;</span>
    <span class="c"># Connect to the database</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c"># Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c">#Execute the statement to delete</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">delete_query</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="c">#Check that it has been deleted</span>
        <span class="k">if</span> <span class="n">cur</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="exam_archive.ExamArchiveDatabase.user_has_access">
    <p>def <span class="ident">user_has_access</span>(</p><p>self, user_id, archive_id)</p>
    </div>
    

    
  
    <div class="desc"><p>Check whether a user has access to a specified archive. The user is identified by the given user ID and archive by the given archive ID.</p>
<p>INPUT:
<em> <code>user_id</code>: The ID of the user.
</em> <code>archive_id</code>: The ID of the archive.
* <code>identification_needed</code>: Identification to the archive needed, true or false</p>
<p>OUTPUT:
* If the user is authorized to access the given archive, True is returned, otherwise False is returned. False is returned also, if the given user_id or archive_id does not exist. If the user is a superuser and an archive exists, True is always returned.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamArchiveDatabase.user_has_access', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamArchiveDatabase.user_has_access" class="source">
    <div class="codehilite"><pre><span class="k">def</span> <span class="nf">user_has_access</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Check whether a user has access to a specified archive. The user is identified by the given user ID and archive by the given archive ID.</span>
<span class="sd">    INPUT:</span>
<span class="sd">    * `user_id`: The ID of the user.</span>
<span class="sd">    * `archive_id`: The ID of the archive.</span>
<span class="sd">    * `identification_needed`: Identification to the archive needed, true or false</span>
<span class="sd">    OUTPUT:</span>
<span class="sd">    * If the user is authorized to access the given archive, True is returned, otherwise False is returned. False is returned also, if the given user_id or archive_id does not exist. If the user is a superuser and an archive exists, True is always returned.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># SQL Statement for activating foreign keys</span>
    <span class="n">keys_on</span> <span class="o">=</span> <span class="s">&#39;PRAGMA foreign_keys = ON&#39;</span>
    <span class="c"># SQL Statement fr checking that is the user an superuser</span>
    <span class="n">sql_query1</span> <span class="o">=</span> <span class="s">&#39;SELECT user_type FROM user WHERE user_id = ?&#39;</span>
    <span class="c"># Connect to the database and get a connection object</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
        <span class="c"># Cursor and row initialization</span>
        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c"># Provide support for foreign keys</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
        <span class="c"># Execute the SQL query statement</span>
        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,)</span>
        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query1</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="c"># If user is an superuser, just continue</span>
        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;user_type&#39;</span><span class="p">]</span>  <span class="o">==</span> <span class="s">&#39;super&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="c"># If user is not an superuser, continue with identification</span>
        <span class="k">else</span><span class="p">:</span>
             <span class="c"># SQL Statement for checking that is identification to the archive needed</span>
            <span class="n">sql_query2</span> <span class="o">=</span> <span class="s">&#39;SELECT identification_needed FROM archive WHERE archive_id = ?&#39;</span>
            <span class="c"># Connect to the database and get a connection object</span>
            <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
                <span class="c"># Cursor and row initialization</span>
                <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
                <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
                <span class="c"># Provide support for foreign keys</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
                <span class="c"># Execute the SQL query statement</span>
                <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">archive_id</span><span class="p">,)</span>
                <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query2</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
                <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                <span class="c"># If user has access, continue with True</span>
                <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">False</span>
                <span class="c"># If identification to the archive is needed, identify the user</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;identification_needed&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="c"># SQL Statement for checking user&#39;s access to the archive</span>
                    <span class="n">sql_query3</span> <span class="o">=</span> <span class="s">&#39;SELECT user_id, archive_id FROM user WHERE user_id = ? AND archive_id = ?&#39;</span>
                    <span class="c"># Connect to the database and get a connection object</span>
                    <span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
                    <span class="k">with</span> <span class="n">con</span><span class="p">:</span>
                        <span class="c"># Cursor and row initialization</span>
                        <span class="n">con</span><span class="o">.</span><span class="n">row_factory</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Row</span>
                        <span class="n">cur</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
                        <span class="c"># Provide support for foreign keys</span>
                        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">keys_on</span><span class="p">)</span>
                        <span class="c"># Execute the SQL query statement</span>
                        <span class="n">pvalue</span> <span class="o">=</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">archive_id</span><span class="p">)</span>
                        <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query3</span><span class="p">,</span> <span class="n">pvalue</span><span class="p">)</span>
                        <span class="n">row</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
                        <span class="c"># If user has access, continue with True</span>
                        <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="k">return</span> <span class="bp">True</span>
                        <span class="c"># Else False</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">return</span> <span class="bp">False</span>
                <span class="c"># If identification is not needed, just continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">True</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="exam_archive.ExamDatabaseError" class="name">class <span class="ident">ExamDatabaseError</span></p>
      
  
    <div class="desc"><p>Exception for general exam archive database error.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamDatabaseError', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamDatabaseError" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">ExamDatabaseError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Exception for general exam archive database error.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">pass</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#exam_archive.ExamDatabaseError">ExamDatabaseError</a></li>
          <li>exceptions.Exception</li>
          <li>exceptions.BaseException</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="exam_archive.ExamDatabaseError.args" class="name">var <span class="ident">args</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="exam_archive.ExamDatabaseError.message" class="name">var <span class="ident">message</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="exam_archive.ExamDatabaseErrorExists" class="name">class <span class="ident">ExamDatabaseErrorExists</span></p>
      
  
    <div class="desc"><p>Exception for an error, when an entity already exists in the database.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamDatabaseErrorExists', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamDatabaseErrorExists" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">ExamDatabaseErrorExists</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Exception for an error, when an entity already exists in the database.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">pass</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#exam_archive.ExamDatabaseErrorExists">ExamDatabaseErrorExists</a></li>
          <li>exceptions.Exception</li>
          <li>exceptions.BaseException</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="exam_archive.ExamDatabaseErrorExists.args" class="name">var <span class="ident">args</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="exam_archive.ExamDatabaseErrorExists.message" class="name">var <span class="ident">message</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="exam_archive.ExamDatabaseErrorNotFound" class="name">class <span class="ident">ExamDatabaseErrorNotFound</span></p>
      
  
    <div class="desc"><p>Exception for an error, when a given entity was not found from the database.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-exam_archive.ExamDatabaseErrorNotFound', this);">Show source &equiv;</a></p>
  <div id="source-exam_archive.ExamDatabaseErrorNotFound" class="source">
    <div class="codehilite"><pre><span class="k">class</span> <span class="nc">ExamDatabaseErrorNotFound</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Exception for an error, when a given entity was not found from the database.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">pass</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#exam_archive.ExamDatabaseErrorNotFound">ExamDatabaseErrorNotFound</a></li>
          <li>exceptions.Exception</li>
          <li>exceptions.BaseException</li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Class variables</h3>
            <div class="item">
            <p id="exam_archive.ExamDatabaseErrorNotFound.args" class="name">var <span class="ident">args</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="exam_archive.ExamDatabaseErrorNotFound.message" class="name">var <span class="ident">message</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.1</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>